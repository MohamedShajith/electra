[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Vehicle Accident Report",
  "enabled": 1,
  "modified": "2022-10-28 13:32:48.516399",
  "name": "Vehicle Accident Report-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Vehicle Accident Report', {\n\trefresh(frm) {\n        frm.add_custom_button(__(\"Print\"), function () {\n                if(frm.doc.parent_company){\n                    var letter_head = frm.doc.parent_company\n                }\n                else{\n                    var letter_head = frm.doc.company\n                } \n                var f_name = frm.doc.name\n                var print_format =\"Vehicle Accident Report\";\n                 window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                    + \"doctype=\" + encodeURIComponent(\"Vehicle Accident Report\")\n                    + \"&name=\" + encodeURIComponent(f_name)\n                    + \"&trigger_print=1\"\n                    + \"&format=\" + print_format\n                    + \"&no_letterhead=0\"\n                    + \"&letterhead=\" + encodeURIComponent(letter_head) \n                   ));\n            \n\n            });\n\t},\n\tdate(frm){\n\t    frm.set_value('designation',frm.doc.designation)\n\t    \n\t},\n\tname1(frm){\n\t    var regex = /[^A-Za-z\\s]/g;\n\t\tif (regex.test(frm.doc.name1) === true) {\n\t\t\tfrappe.msgprint(__(\"Only Alphabets are allowed.\"));\n\t\t\tfrappe.validated = false;\n\t\t}\n\t},\n\tto(frm){\n\t    if(frm.doc.to > frappe.datetime.now_date()){\n\t        frappe.msgprint(__(\"Future date is not allowed.\"));\n\t\t\tfrappe.validated = false;\n\t    }\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2022-10-26 12:09:49.636135",
  "name": "Employee-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Employee', {\n    date_of_joining(frm){\n        frm.trigger(\"doj_calculation\")\n    },\n    onload(frm){\n       frm.trigger(\"hide_sales_person\") \n    },\n    refresh(frm){\n        frm.trigger(\"hide_sales_person\") \n    },\n    first_name(frm){\n        var first_name = frm.doc.first_name;\n        var arr = first_name.split(\" \");\n        for (var i = 0; i < arr.length; i++) {\n            arr[i] = arr[i].charAt(0).toUpperCase() + arr[i].slice(1).toLowerCase();\n        }\n        var str2 = arr.join(\" \");\n        frm.set_value('first_name',str2)\n    },\n    last_name(frm){\n\t\tvar last_name = frm.doc.last_name;\n        var arr = last_name.split(\" \");\n        for (var i = 0; i < arr.length; i++) {\n            arr[i] = arr[i].charAt(0).toUpperCase() + arr[i].slice(1).toLowerCase();\n        }\n        var str2 = arr.join(\" \");\n        frm.set_value('last_name',str2)\n    },\n    hide_sales_person(frm){\n        var designation = frm.doc.designation;\n        if (designation.match(\"Sales\")) {\n             frm.set_df_property(\"sales_person\",\"hidden\",false)\n  // do something\n}\n        if(frm.doc.designation == \"Sales Executive\"){\n         frm.set_df_property(\"sales_person\",\"hidden\",false)\n        }\n        else{\n            hide_field(['sales_person'])\n        }\n    },\n    \n    sales_person(frm){\n\t    frappe.call({\n\t\t\t\t\tmethod: 'electra.custom.create_sales_person',\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'name': frm.doc.name,\n\t\t\t\t\t\t'department':frm.doc.department,\n\t\t\t\t\t\t'employee':frm.doc.employee_name\n\t\t\t\t\t},\n\n\t\t\t\t\tcallback(r) {\n\t\t\t\t\t    console.log(\"hi\")\n\t\t\t\t\t    \n\t\t\t\t\t}\n\t\t\t\t})\n    },\n    validate(frm){\n        frm.trigger(\"age_calculation\")\n        if(!frm.doc.__islocal){\n        frappe.call({\n    \t\tmethod: \"electra.custom.gratuity_calc\",\n    \t\targs: {\n    \t\t\temployee: frm.doc.employee_number,\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t //   console.log(r)\n    \t\t\t    frm.set_value('gratuity',r.message)\n    \t\t\t}\n    \t\t}\n    \t\t\n\t\t\t});\n\t\t\n\t\t\t\n        }\n        var gross_salary = frm.doc.basic + frm.doc.hra + frm.doc._other_allowance;\n        var ctc = gross_salary + frm.doc.gratuity + frm.doc.leave_salary + frm.doc.air_ticket_allowance + frm.doc.qid_cost + frm.doc.mobile_allowance + frm.doc.medical_renewal + frm.doc.accommodation + frm.doc.transportation\n        var per_hour_cost = ( ctc / (30*8) )\n        frm.set_value(\"gross_salary\",gross_salary)\n        frm.set_value(\"ctc\",ctc)\n        frm.set_value(\"per_hour_cost\",per_hour_cost)\n        \n        \n    },\n    work_location(frm){\n        frappe.call({\n    \t\tmethod: \"frappe.client.get\",\n    \t\targs: {\n    \t\t\tdoctype: \"Work Location\",\n    \t\t\tfilters: {\n    \t\t\t\t\"work_location\": frm.doc.work_location\n    \t\t\t},\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    frm.set_value('holiday_list',r.message.holiday_list)\n    \t\t\t}\n    \t\t}\n\t\t\t});\n    },\n    doj_calculation:function(frm){\n        var date = frm.doc.date_of_joining\n        var prob = frappe.datetime.add_days(date, 91)\n        frm.set_value('probation_end_date',prob)\n        // frm.set_value('employment_type','Probation')\n    },\n\tdate_of_birth:function(frm){\n    \t frm.trigger(\"age_calculation\")\n\t},\n\tage_calculation:function(frm){\n\t    var dob = frm.doc.date_of_birth;  \n    \t var birthDate = new Date(dob);\n    \t var difference=Date.now() - birthDate.getTime(); \n    \t var  ageDate = new Date(difference); \n    \t var calculatedAge = Math.abs(ageDate.getUTCFullYear() - 1970);\n    \t frm.set_value(\"age\",calculatedAge)\n    \t if (calculatedAge < 18){\n    \t     frappe.msgprint(\"Employee lesser than age 18 will not be allowed\")\n    \t     frappe.validated = false;\n    \t }\n    \t \n},\n\ngrade(frm){\n    frappe.call({\n    \t\tmethod: \"frappe.client.get\",\n    \t\targs: {\n    \t\t\tdoctype: \"Employee Grade\",\n    \t\t\tfilters: {\n    \t\t\t\tname: frm.doc.grade,\n    \t\t\t},\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    frm.set_value('visa_cost_',r.message.visa_cost)\n    \t\t\t}\n    \t\t}\n\t\t\t});\n},\n\nrevised(frm){\n    frm.add_child(\"salary_revised\", {\n        'basic': frm.doc.basic,\n\t\t'hra':frm.doc.hra,\n\t\t'other_allowance':frm.doc._other_allowance,\n\t\t'gross_salary':frm.doc.gross_salary,\n\t\t'gratuity':frm.doc.gratuity,\n\t\t'leave_salary':frm.doc.leave_salary,\n\t\t'air_ticket_allowance':frm.doc.air_ticket_allowance_,\n\t\t'qid_cost':frm.doc.qid_cost,\n\t\t'mobile_allowance':frm.doc.mobile_allowance,\n\t\t'medical_allowance':frm.doc.medical_allowance_,\n\t\t'accommodation':frm.doc.accommodation,\n\t\t'transportation':frm.doc.transportation,\n\t\t'ctc':frm.doc.ctc,\n\t\t'per_hour_cost':frm.doc.per_hour_cost,\n\t\t'salary__mode':frm.doc.salary_mode,\n\t\t'bank_name':frm.doc.bank_name,\n\t\t'account_name':frm.doc.account_name,\n\t\t'bank_ac_no':frm.doc.bank_ac_no,\n\t\t'iban_pay_card_no':frm.doc.iban_pay_card_no,\n\t\t'payroll_cost_center':frm.doc.payroll_cost_center,\n\t\t'visa_cost':frm.doc.visa_cost_\n\t\t})\n\t\t\n\t\tfrm.refresh_field('salary_revised')\n\t\tfrm.set_value('basic','')\n\t\tfrm.set_value('hra','')\n\t\tfrm.set_value('_other_allowance','')\n\t\tfrm.set_value('gross_salary','')\n\t\tfrm.set_value('gratuity','')\n\t\tfrm.set_value('leave_salary','')\n\t\tfrm.set_value('air_ticket_allowance_','')\n\t\tfrm.set_value('qid_cost','')\n\t\tfrm.set_value('mobile_allowance','')\n\t\tfrm.set_value('medical_allowance_','')\n\t\tfrm.set_value('accommodation','')\n\t\tfrm.set_value('transportation','')\n\t\tfrm.set_value('ctc','')\n\t\tfrm.set_value('per_hour_cost','')\n\t\tfrm.set_value('salary_mode','')\n\t\tfrm.set_value('bank_name','')\n\t\tfrm.set_value('account_name','')\n\t\tfrm.set_value('bank_ac_no','')\n\t\tfrm.set_value('iban_pay_card_no','')\n\t\tfrm.set_value('payroll_cost_center','')\n\t\tfrm.set_value('visa_cost_','')\n\t\t\n\t\t\n}\n\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Interim Appraisal Form",
  "enabled": 1,
  "modified": "2021-08-18 13:46:11.789025",
  "name": "Interim Appraisal Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Interim Appraisal Form', {\n// \trefresh(frm) {\n\t\t\n// \t}\nemp_id(frm){\n    console.log(\"hiiiii\")\n}\n})\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Staff Skill Mapping Form",
  "enabled": 1,
  "modified": "2022-10-28 15:49:18.561058",
  "name": "Staff Skill Mapping Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Staff Skill Mapping Form', {\n    onload(frm){\n        if(frm.doc.__islocal){\n            frm.set_value('date_of_evaluation',new Date())\n        }\n    },\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Staff Skill Mapping Form\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Staff Skill Mapping Form\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\t\n\t emp_id(frm){\n        console.log(frm.doc.emp_id);\n    \n    },\n    company(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n    validate(frm){\n        var total = 0\n        var row = 0\n        $.each(frm.doc.table_14,function(i,d){\n            if(d.rating){\n            total += d.rating\n            row = d.idx\n            }\n        })\n        frm.set_value('total_score',total/row)\n    }\n});\t\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Vehicle Maintenance Check List",
  "enabled": 1,
  "modified": "2022-10-31 09:00:17.440405",
  "name": "VEHICLE MAINTENANCE CHECK LIST-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Vehicle Maintenance Check List', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Vehicle Maintenance Check List\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Vehicle Maintenance Check List\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\t\n\tcompany(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n// \t\tfrappe.call({\n// \t\t\tmethod: \"frappe.client.get_value\",\n// \t\t\targs: {\n// \t\t\t\tdoctype: \"Company\",\n// \t\t\t\tfilters: {\"name\": frm.doc.company},\n// \t\t\t\tfieldname: \"cost_center\"\n// \t\t\t},\n// \t\t\tcallback: function(r){\n// \t\t\t\tif(r.message){\n// \t\t\t\t\t$.each(frm.doc.accounts || [], function(i, jvd) {\n// \t\t\t\t\t\tfrappe.model.set_value(jvd.doctype, jvd.name, \"cost_center\", r.message.cost_center);\n// \t\t\t\t\t});\n// \t\t\t\t}\n// \t\t\t}\n// \t\t});\n\n// \t\terpnext.accounts.dimensions.update_dimension(frm, frm.doctype);\n// \t},\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Vehicle Possession and Surrender Form",
  "enabled": 1,
  "modified": "2022-11-14 16:49:50.621110",
  "name": "Vehicle Possession and Surrender Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Vehicle Possession and Surrender Form', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Vehicle Possession Form\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Vehicle Possession Form\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        \n\n        });\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n\tvalidate(frm){\n\t    frm.trigger(\"future_date_validate\")\n\t},\n\tpossession_date(frm){\n\t    frm.trigger(\"future_date_validate\")\n\t},\n\tsurrender_date(frm){\n\t    frm.trigger(\"future_date_validate\")\n\t},\n\tfuture_date_validate:function(frm){\n\t\tvar today = new Date()\n\t\tconsole.log(today)\n\t\ttoday.setDate(today.getDate());\n\t\tvar dd = today.getDate();\n        var mm = today.getMonth() + 1; \n        var yyyy = today.getFullYear();\n        if(dd<10) \n            {\n                dd='0'+dd;\n            } \n            \n        if(mm<10) \n            {\n                mm='0'+mm;\n            } \n        today = yyyy+'-'+mm+'-'+dd;\n\t\tconsole.log(frm.doc.possession_date)\n\t\tif (frm.doc.possession_date > today){\n\t\t    frappe.msgprint(\"Future Date not Allowed in Date of Possession\")\n\t\t    frappe.validated = false;\n\t\t}\n\t\tif (frm.doc.surrender_date > today){\n\t\t    frappe.msgprint(\"Future Date not Allowed in Date of Surrender\")\n\t\t    frappe.validated = false;\n\t\t}\n\t}\n\t\n\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Vehicle Log",
  "enabled": 1,
  "modified": "2021-08-28 09:05:50.805406",
  "name": "Vehicle Log-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Vehicle Log', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\t\tvalidate(frm){\n\t    frm.trigger(\"future_date_validate\")\n\t},\n\taccident_date(frm){\n\t    frm.trigger(\"future_date_validate\")\n\t},\n\tfuture_date_validate:function(frm){\n\t\tvar today = new Date()\n\t\tconsole.log(today)\n\t\ttoday.setDate(today.getDate());\n\t\tvar dd = today.getDate();\n        var mm = today.getMonth() + 1; \n        var yyyy = today.getFullYear();\n        if(dd<10) \n            {\n                dd='0'+dd;\n            } \n            \n        if(mm<10) \n            {\n                mm='0'+mm;\n            } \n        today = yyyy+'-'+mm+'-'+dd;\n\t\tconsole.log(typeof today)\n\t\tconsole.log(frm.doc.accident_date)\n\t\tif (frm.doc.accident_date > today){\n\t\t    frappe.msgprint(\"Future Date not Allowed in Date of Accident\")\n\t\t    frappe.validated = false;\n\t\t}\n\t}\n\n\t\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Rejoining Form",
  "enabled": 1,
  "modified": "2022-11-11 12:38:30.123591",
  "name": "Employee Re Joining Report-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Rejoining Form', {\n    refresh(frm){\n        \n    },\n    onload(frm){\n        console.log(\"Vanakkam\")\n    },\n    re_join(frm){\n\t      frm.set_value('re_joining_date',frm.doc.re_join)\n\t},\n\temp_no(frm){\n        console.log(frm.doc.emp_no);\n\t},\n\t\n\t\tend(frm){ \n\t\t    frm.trigger(\"total_leave_in_days\")\n\t},\n\t  \n\t   start(frm){\n\t      frm.trigger(\"date_validation\")\n\t      \n\t  },\n\t  \n\t  end(frm){\n\t      frm.trigger(\"date_validate\")\n\t      \n\t  },\n\t\n\t   date_validate:function(frm){\n\t    if(frm.doc.end < frm.doc.start){\n\t        frappe.msgprint(__(\"End date cannot be less than Start Date\"));\n\t\t\tfrappe.validated = false;\n\t    }\n\t},\n\t\n\tdate_validation:function(frm){\n\t    if(frm.doc.end < frm.doc.start){\n\t        frappe.msgprint(__(\"Start date cannot be greater than End Date\"));\n\t\t\tfrappe.validated = false;\n\t    }\n\t},\n\t\n\t reporting_date(frm){\n\t      frm.trigger(\"report_validation\")\n\t      \n\t  },\n\t  \n\t  \n\t \n\t\n\t\n\treport_validation:function(frm){\n\t    if(frm.doc.re_join < frm.doc.reporting_date){\n\t        frappe.msgprint(__(\"Reporting date cannot be greater than Re-Join Date\"));\n\t\t\tfrappe.validated = false;\n\t    }\n\t},\n\t\n\trejoin_validation:function(frm){\n\t    if(frm.doc.re_join < frm.doc.reporting_date){\n\t        frappe.msgprint(__(\"Re-Join date cannot be lesser than Reporting Date\"));\n\t\t\tfrappe.validated = false;\n\t    }\n\t},\n\t\n\t\n\t\n\t\n\t    total_leave_in_days:function(frm){\n\t     if(frm.doc.start && frm.doc.end){\n\t         var end = frappe.datetime.obj_to_str(frm.doc.end);\n\t         var start = frappe.datetime.obj_to_str(frm.doc.start);\n\t         var datediff = frappe.datetime.get_day_diff(end,start);\n\t         frm.set_value(\"total_leave_in_days\",datediff);\n\t     }\n\t    },\n\t    \n\t    \n    \tre_joining_date(frm){\n    \t    frm.trigger(\"late_joining_in_days\")\n    \t},\n    \treporting_date(frm){\n    \t    frm.trigger(\"late_joining_in_days\")\n    \t},\n\t    \n\t    late_joining_in_days:function(frm){\n\t    if(frm.doc.reporting_date && frm.doc.re_join){      \n\t        var rejoin = frappe.datetime.obj_to_str(frm.doc.re_join);\n\t        var report = frappe.datetime.obj_to_str(frm.doc.reporting_date);\n\t        var difference = frappe.datetime.get_day_diff(report,rejoin);\n\t        if(difference >=0){\n\t            frm.set_value(\"late_joining_in_days\",difference);\n\t        }\n\t        else{\n\t            frm.set_value(\"late_joining_in_days\",0);\n\t        }\n\t    }\n\t    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Staff Permission Tardy Absent Form",
  "enabled": 1,
  "modified": "2022-10-26 14:21:24.347759",
  "name": "Staff Permission Tardy Absent Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Staff Permission Tardy Absent Form', {\n\trefresh(frm) {\n\t\t\n\t},\n\t\n// \tvalidate(frm){\n// \t    frm.trigger(\"date_validation\")\n\n// \t  },\n\t to_date(frm){\n\t      frm.trigger(\"date_validate\")\n\t      frm.trigger(\"datediffer\")\n\t      \n\t  },\n\t  \n\t  from_date(frm){\n\t      frm.trigger(\"date_validation\")\n\t      frm.trigger(\"datediffer\")\n\t      \n\t  },\n\t \n\t   date_validate:function(frm){\n\t    if(frm.doc.to_date < frm.doc.from_date){\n\t        frappe.msgprint(__(\"To date cannot be less than From Date\"));\n\t\t\tfrappe.validated = false;\n\t    }\n\t},\n\t\n\t\n\tdate_validation:function(frm){\n\t    if(frm.doc.to_date < frm.doc.from_date){\n\t        frappe.msgprint(__(\"From date cannot be greater than To Date\"));\n\t\t\tfrappe.validated = false;\n\t    }\n\t},\n\n     datediffer:function(frm){\n\t     if(frm.doc.from_date && frm.doc.to_date){\n\t         var to = frappe.datetime.obj_to_str(frm.doc.to_date);\n\t         var from = frappe.datetime.obj_to_str(frm.doc.from_date);\n\t         var datediff = frappe.datetime.get_day_diff(to,from);\n\t         frm.set_value(\"days\",datediff+1);\n\t     }\n\t    }\n\t    \n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Vacating Accommodation Declaration",
  "enabled": 1,
  "modified": "2022-10-31 12:37:58.446130",
  "name": "Self Declaration Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Employee Vacating Accommodation Declaration', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Employee Vacating Accommodation Declaration\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Employee Vacating Accommodation Declaration\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n\tonload(frm){\n\t    frm.set_value('dec_date',new Date())\n\t},\n// \tonload(frm){\n// \t    frm.trigger(\"get_today_date\");\n\t    \n// \t},\n// \tget_today_date:function(frm){\n// \t    var today = frm.doc.transaction_date\n// \t\tconsole.log(today)\n// \t\tvar dd = today.getDate();\n// \t\tvar mm = today.getMonth() + 1; \n// \t\tvar yyyy = today.getFullYear();\n// \t\tif(dd<10)\n// \t\t{\n// \t\t    dd='0'+dd;\n\t\t    \n// \t\t}\n// \t\tif(mm<10)\n// \t\t{\n// \t\t    mm='0'+mm;\n\t\t    \n// \t\t} \n// \t\ttoday = dd+'-'+mm+'-'+yyyy;\n// \t\tfrm.set_value('dated',today)\n\t    \n// \t},\n})\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Visa Approval Monitor",
  "enabled": 1,
  "modified": "2021-08-28 10:33:16.331125",
  "name": "Visa Approval Monitor-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Visa Approval Monitor', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\tvisa_application_no(frm){\n\t    console.log(frm.doc.visa_application_no);\n\t},\n\t\tused_visa(frm){\n\t\t    if(frm.doc.allocated_number){\n\t    var balance = frm.doc.allocated_number - parseInt(frm.doc.used_visa)\n\t    frm.set_value(\"balance\",balance);\n\t    if(balance == 0){\n\t        frm.set_value('availability_status','Completed')\n\t    }\n\t    else if(balance > 0){\n\t        frm.set_value('availability_status','Available')\n\t    }\n\t\t    }\n\t},\n\tallocated_number(frm){\n\t\t    if(frm.doc.allocated_number){\n\t    var balance = frm.doc.allocated_number - parseInt(frm.doc.used_visa)\n\t    frm.set_value(\"balance\",balance);\n\t    if(balance == 0){\n\t        frm.set_value('availability_status','Completed')\n\t    }\n\t    else if(balance > 0){\n\t        frm.set_value('availability_status','Available')\n\t    }\n\t\t    }\n\t\t    \n\t},\n\tvisa_status(frm){\n\t    if(frm.doc.visa_status == 'Invalid'){\n\t        frm.set_value('availability_status','Invalid')\n\t    }\n\t},\n\t\n\t\n\t\n\t\n\t\tvalidate(frm){\n\t    frm.trigger(\"future_date_validate\")\n\t},\n\tvisa_expiry_date(frm){\n\t    frm.trigger(\"future_date_validate\")\n\t},\n\tfuture_date_validate:function(frm){\n\t\tvar today = new Date()\n\t\tconsole.log(today)\n\t\ttoday.setDate(today.getDate());\n\t\tvar dd = today.getDate();\n        var mm = today.getMonth() + 1; \n        var yyyy = today.getFullYear();\n        if(dd<10) \n            {\n                dd='0'+dd;\n            } \n            \n        if(mm<10)\n            {\n                mm='0'+mm;\n            } \n        today = yyyy+'-'+mm+'-'+dd;\n\t\tconsole.log(frm.doc.visa_expiry_date)\n\t\tif (frm.doc.visa_expiry_date < today){\n\t\t    frappe.msgprint(\"Future Date only allowed for visa expiry date\")\n\t\t    \t    frappe.validated = false;\n\t\t}\n\t}\n\t\n});\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Salary and Benefit Form",
  "enabled": 1,
  "modified": "2022-11-14 16:33:05.309145",
  "name": "Appraisal Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Salary and Benefit Form', {\n    refresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Salary and Benifits\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Salary and Benefit Form\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\tonload(frm) {\n\t\tfrm.set_value('request_date',new Date())\n\t},\n\t\n\temp_id(frm){\n        console.log(frm.doc.emp_id);\n    \n    },\n    basic_salary(frm){\n        frm.trigger('salary_calc')\n    },\n    basic_salary(frm){\n        frm.trigger('salary_calc')\n    },\n    accomodation_allow(frm){\n        frm.trigger('salary_calc')\n    },\n    transport_allow(frm){\n        frm.trigger('salary_calc')\n    },\n    other_allow(frm){\n        var total = frm.doc.basic_salary + frm.doc.accomodation_allow + frm.doc.transport_allow + frm.doc.other_allow\n        frm.set_value('total_new',total)\n    },\n    \n\t validate(frm){\n\t    frm.trigger(\"add_salary\")\n        var total = 0\n        $.each(frm.doc.appraisal_rating,function(i,d){\n            if(d.rating){\n            total += d.rating\n            }\n        })\n        console.log(total)\n        frm.set_value('total_score',total)\n\t },\n\n\t other_allowances(frm){\n\t\t    if(frm.doc.basic_salary){\n\t    var balance = frm.doc.basic_salary - frm.doc.Other_allowances\n\t    console(balance)\n\t    frm.set_value(\"balance\",balance);\n\t\t    }\n\t \n},\ncompany(frm){\n\t    if (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t}\n});\n\nfrappe.ui.form.on('Current Salary Table', {\n\tother_allowances(frm,cdt,cdn) {\n\t\tvar child = locals[cdt][cdn]\n\t    if(child.basic_salary && child.other_allowances){\n\t    var total = parseInt(child.basic_salary) + parseInt(child.other_allowances)\n\t    child.total_salary = total\n\t    frappe.model.set_value(cdt,cdn,\"total_salary\",total)\n\t}\n\tfrm.refresh_field('current_salary_table')\n\t}\n})\n\nfrappe.ui.form.on('Revised Salary Table', {\n    other_allowances(frm,cdt,cdn) {\n\t\tvar child = locals[cdt][cdn]\n\t    if(child.basic_salary && child.other_allowances){\n\t    var total = parseInt(child.basic_salary) + parseInt(child.other_allowances)\n\t    child.total_salary = total\n\t    frappe.model.set_value(cdt,cdn,\"total_salary\",total)\n\t  \t}\n\tfrm.refresh_field('revised_salary_table')\n\t},\n\t\n    \n\t\n    \n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Staff Disciplinary Action Form",
  "enabled": 1,
  "modified": "2022-10-31 08:40:07.553148",
  "name": "Staff Disciplinary Action Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Staff Disciplinary Action Form', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Disciplinary Action\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Staff Disciplinary Action Form\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\tvalidate(frm){\n\t    frm.trigger(\"future_date_validate\")\n\t},\n\tdate_of_incident(frm){\n\t    frm.trigger(\"future_date_validate\")\n\t},\n\tdate(frm){\n\t    frm.trigger(\"future_date_validate\")\n\t},\n\tcompany(frm){\n\t    if (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n\t\n\tfuture_date_validate:function(frm){\n\t\tvar today = new Date()\n\t\tconsole.log(today)\n\t\ttoday.setDate(today.getDate());\n\t\tvar dd = today.getDate();\n        var mm = today.getMonth() + 1; \n        var yyyy = today.getFullYear();\n        if(dd<10) \n            {\n                dd='0'+dd;\n            } \n            \n        if(mm<10) \n            {\n                mm='0'+mm;\n            } \n        today = yyyy+'-'+mm+'-'+dd;\n\t\tconsole.log(typeof today)\n\t\tconsole.log(frm.doc.date_of_incident)\n\t\tif (frm.doc.date_of_incident > today){\n\t\t    frappe.msgprint(\"Future Date not Allowed in date of incident\")\n\t\t    frappe.validated = false;\n\t\t}\n\t\tif (frm.doc.date > today){\n\t\t    frappe.msgprint(\"Future Date not Allowed in  date of evaluation\")\n\t\t    frappe.validated = false;\n\t\t}\n\n\t},\n\t\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Business Card",
  "enabled": 1,
  "modified": "2022-10-31 09:55:58.958581",
  "name": "Business Card Requitision Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Business Card', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Business  Card Test\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Business Card\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\tcompany__division(frm) {\n\t\tif (frm.doc.company__division == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company__division == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company__division == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company__division == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company__division == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company__division == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company__division == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company__division == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company__division == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company__division == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company__division == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company__division == \"MEP DIVISION - ELECTRA\" || frm.doc.company__division == \"STEEL DIVISION - ELECTRA\" || frm.doc.company__division == \"TRADING DIVISION - ELECTRA\" || frm.doc.company__division == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company__division == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n\tonload(frm){\n\t    if(frm.doc.__islocal){\n\t        frm.set_value('date',new Date())\n\t    }\n\t},\n// \tonload(frm){\n// \t    frm.trigger(\"get_today_date\");\n// \t    },\n// \t    get_today_date:function(frm){\n// \t        var today = new Date()\n// \t\t\tconsole.log(today)\n// \t\t\tvar dd = today.getDate();\n// \t\t\tvar mm = today.getMonth() + 1; \n// \t\t\tvar yyyy = today.getFullYear();\n// \t\t\tif(dd<10)\n// \t\t\t{\n// \t\t\t    dd='0'+dd;\n// \t\t\t} \n\t\t\t\t\t\n// \t\t\tif(mm<10)\n// \t\t\t{\n// \t\t\t    mm='0'+mm;\n\t\t\t    \n// \t\t\t} \n// \t\t\ttoday = dd+'-'+mm+'-'+yyyy;\n// \t\t\tfrm.set_value('date',today)\n\t\t\t\t\n// \t\t\t},\n\t\t\t\n// \t\t\t end(frm){\n// \t      frm.trigger(\"date_validate\")\n\t      \n// \t  },\n\t\n// \t   date_validate:function(frm){\n// \t    if(frm.doc.end < frm.doc.start){\n// \t        frappe.msgprint(__(\"End date cannot be less than Start Date\"));\n// \t\t\tfrappe.validated = false;\n// \t    }\n// \t},\n\t\t\t\n\t\t\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Accommodation Material",
  "enabled": 1,
  "modified": "2022-11-14 17:34:18.272366",
  "name": "Staff Accommodation Material Request Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Accommodation Material', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company__division\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Staff Accommodation Material\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Accommodation Material\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        \n\n        });\n\t},\n\tcompany__division(frm) {\n\t\tif (frm.doc.company__division == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company__division == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company__division == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company__division == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company__division == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company__division == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company__division == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company__division == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company__division == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company__division == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company__division == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company__division == \"MEP DIVISION - ELECTRA\" || frm.doc.company__division == \"STEEL DIVISION - ELECTRA\" || frm.doc.company__division == \"TRADING DIVISION - ELECTRA\" || frm.doc.company__division == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company__division == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n\tonload(frm){\n\t    frm.trigger(\"get_today_date\");\n\t    \n\t},\n\tget_today_date:function(frm){\n\t    var today = new Date()\n\t\tconsole.log(today)\n\t\tvar dd = today.getDate();\n\t\tvar mm = today.getMonth() + 1; \n\t\tvar yyyy = today.getFullYear();\n\t\tif(dd<10)\n\t\t{\n\t\t    dd='0'+dd;\n\t\t} \n\t\t\t\t\t\n\t\tif(mm<10)\n\t\t{\n\t\t    mm='0'+mm;\n\t\t\t    \n\t\t} \n\t\ttoday =dd+'-'+mm+'-'+yyyy;\n\t\tfrm.set_value('date',today)\n\t    \n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Mobile Tariff Change",
  "enabled": 1,
  "modified": "2022-10-31 12:36:07.951941",
  "name": "Company Mobile Tariff Change Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Mobile Tariff Change', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Mobile Tariff Change\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Mobile Tariff Change\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n\tonload(frm){\n\t    if(frm.doc.__islocal){\n\t        frm.set_value('date',new Date())\n\t    }\n\t}\n// onload(frm){\n// \t    frm.trigger(\"get_today_date\");\n// \t    },\n// \t    get_today_date:function(frm){\n// \t        var today = new Date()\n// \t\t\tconsole.log(today)\n// \t\t\tvar dd = today.getDate();\n// \t\t\tvar mm = today.getMonth() + 1; \n// \t\t\tvar yyyy = today.getFullYear();\n// \t\t\tif(dd<10)\n// \t\t\t{\n// \t\t\t    dd='0'+dd;\n// \t\t\t} \n\t\t\t\t\t\n// \t\t\tif(mm<10)\n// \t\t\t{\n// \t\t\t    mm='0'+mm;\n\t\t\t    \n// \t\t\t} \n// \t\t\ttoday = dd+'-'+mm+'-'+yyyy;\n// \t\t\tfrm.set_value('date',today)\n\t\t\t\t\n// \t\t\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "HR Request",
  "enabled": 1,
  "modified": "2022-10-28 13:51:40.461995",
  "name": "HR Request Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('HR Request', {\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"HR Request\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"HR Request\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        \n\n        });\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n\tonload(frm){\n\t    frm.set_value('requested_date',new Date())\n\t    if(!frm.doc.table_34){\n\t    frappe.call({\n\t        method:'frappe.client.get_list',\n\t        args:{\n\t            'doctype':'Request Type'\n\t        },\n\t        callback(r){\n\t            $.each(r.message,function(i,v){\n\t                frm.add_child('table_34',{\n\t                    'request_type':v.name\n\t                })\n\t                frm.refresh_field('table_34')\n\t            })\n\t        }\n\t    })\n\t}\n\t}\n\t\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Leave Application",
  "enabled": 1,
  "modified": "2022-11-11 13:25:38.715709",
  "name": "Leave Application-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Leave Application', {\n    refresh(frm){\n        frm.add_custom_button(__('Rejoining Form'),function(){\n\t        frappe.db.get_value('Rejoining Form', { 'emp_no': frm.doc.employee }, 'name')\n\t\t\t.then(r => {\n\t\t\t\tif (r.message && Object.entries(r.message).length === 0) {\n\t\t\t\t\tfrappe.route_options = { 'emp_no': frm.doc.employee, 'leave_application': frm.doc.name }\n\t\t\t\t\tfrappe.set_route('Form', 'Rejoining Form', 'new')\n\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tfrappe.set_route('Form', 'Rejoining Form', r.message.name)\n\t\t\t\t}\n\t\t\t})\n\t    });\n        frm.trigger('get_leave_details')\n        \n        frm.add_custom_button(__(\"Exit Checklist\"), function () {\n            frappe.route_options = {\n\t\t\t\t\t\"employee\": frm.doc.employee,\n\t\t\t\t};\n            frappe.set_route('Form','Exit Checklist','new-exit-check-list-1');\n    },\n    );\n    },\n    \n   \n    \n    \n    validate(frm){\n        \n        // frm.trigger('get_leave_details')\n        frm.trigger('role_permission')\n    },\n    \n    from(frm){\n    frm.trigger('from_date_validation')\n    },\n    \n    to(frm){\n    frm.trigger('to_date_validation')\n    },\n    \n\tget_leave_details(frm) {\n\t   if(!frm.doc.__islocal){\n\t    frappe.call({\n\t        method :\"electra.custom.get_leave_details\",\n\t        args:{\n\t            name : frm.doc.name,\n\t            from_date : frm.doc.from_date,\n\t            to_date : frm.doc.to_date,\n\t            leave : frm.doc.total_leave_days\n\t        },\n\t        callback(r){\n\t            console.log(r.message)\n\t        frm.fields_dict.leave_details1.$wrapper.empty().append(\"<h5><b>Leave Details</b><h5><table class='table table-bordered'>\"+r.message+\"</table>\")      \n\t        }\n\t    })\n}\n\t},\n\t\n\t\tfrom_date_validation:function(frm){\n\t    if(frm.doc.to < frm.doc.from){\n\t        frappe.msgprint(__(\"FROM date cannot be greater than TO Date\"));\n\t\t\tfrappe.validated = false;\n\t    }\n\t},\n\t\n\t\n\t\tto_date_validation:function(frm){\n\t    if(frm.doc.to < frm.doc.from){\n\t        frappe.msgprint(__(\"TO date cannot be lesser than FROM Date\"));\n\t\t\tfrappe.validated = false;\n\t    }\n\t\t},\n\t\t\n\t\trole_permission:function(frm){\n\t\t    console.log(frappe.user.has_role('HOD'))\n\t\t    if(frappe.user.has_role(\"HOD\")){\n\t\t        frm.set_value(\"hod\",true)\n\t\t        \n\t\t    }\n\t\t    if(!frappe.user.has_role(\"HOD\")){\n\t\t        frm.set_value(\"hod\",false)\n\t\t    }\n\t\t}\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Grievance",
  "enabled": 1,
  "modified": "2022-10-31 10:24:44.898158",
  "name": "Employee Grievance Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Grievance', {\n    onload(frm){\n        frm.set_value('date',new Date())\n    },\n\trefresh(frm) {\n\t\tfrm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Employee Grievance\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Grievance\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n})\n// \tvalidate(frm){\n// \t    frm.trigger(\"future_date_validate\")\n// \t},\n\t\n\t\n// \tdate_and(frm){\n// \t    frm.trigger(\"future_date_validate\")\n// \t},\n\t\n// \t\tfuture_date_validate:function(frm){\n// \t    if(frm.doc.\tdate_and > frappe.datetime.now_date()){\n// \t        frappe.msgprint(__(\"Future date is not allowed.\"));\n// \t\t\tfrappe.validated = false;\n// \t    }\n// \t},\n// \t\tonload(frm){\n// \t    frm.trigger(\"get_today_date\");\n// \t    },\n// \t    get_today_date:function(frm){\n// \t        var today = new Date()\n// \t\t\tconsole.log(today)\n// \t\t\tvar dd = today.getDate();\n// \t\t\tvar mm = today.getMonth() + 1; \n// \t\t\tvar yyyy = today.getFullYear();\n// \t\t\tif(dd<10)\n// \t\t\t{\n// \t\t\t    dd='0'+dd;\n// \t\t\t} \n\t\t\t\t\t\n// \t\t\tif(mm<10)\n// \t\t\t{\n// \t\t\t    mm='0'+mm;\n\t\t\t    \n// \t\t\t} \n// \t\t\ttoday = dd+'-'+mm+'-'+yyyy;\n// \t\t\tfrm.set_value('date',today)\n\t\t\t\t\n// \t\t\t},\n// })\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Offer",
  "enabled": 1,
  "modified": "2022-10-20 15:08:26.546876",
  "name": "Job Offer-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Offer', {\n    onload(frm){\n        if (frm.doc.__islocal) {\n        frm.set_value('offer_date',new Date())\n        }\n    },\n\tjob_applicant(frm) {\n\t\tfrm.add_custom_button(__(\"Create Employee\"), function() {\n\t      frappe.db.get_value('Job Offer',{'name': frm.doc.job_applicant },'name')\n\t    .then(r => {\n\t         console.log(r.message)\n        if(r.message && Object.entries(r.message).length === 0){\n            console.log('hello')\n             frappe.route_options = {'job_applicant':frm.doc.job_applicant,'applicant_name': frm.doc.applicant_name}\n            frappe.set_route('Form','Job Offer','new-employee-1')\n            \n        }\n\t    \n\t    \n\t    else{\n          frappe.set_route('Form','Job Offer',r.message.name)\n          console.log(\"hiii\")\n        }\n\t    })    \n\t    \t\n         });\n},\n\n    allowance(frm){\n\t\t    if(frm.doc.basic_salary_qar && frm.doc.allowance){\n\t\t        var gross = frm.doc.basic_salary_qar + parseInt(frm.doc.allowance)\n\t\t        frm.set_value(\"gross_salary_\",gross);\n\t\t    }\n\t\t},\n\t\t\n\tbasic_salary_qar(frm){\n\t\t    if(frm.doc.basic_salary_qar && frm.doc.allowance){\n\t\t        var gross = frm.doc.basic_salary_qar + parseInt(frm.doc.allowance)\n\t\t        frm.set_value(\"gross_salary_\",gross);\n\t\t    }\n\t\t}\n\t\n// \tallowance(frm){\n// \t    if(frm.doc.allowance && basic_salary_qar){\n// \t        var gross = frm.doc.basic_salary_qar + frm.doc.allowance\n// \t        frm.set_value(\"gross_salary_\",gross);\n// \t    }\n// \t},\n\t\n\t\t\n// \tbasic_salary_qar(frm){\n// \t    if(frm.doc.allowance && basic_salary_qar){\n// \t        var gross = frm.doc.basic_salary_qar + frm.doc.allowance\n// \t        frm.set_value(\"gross_salary_\",gross);\n// \t    }\n// \t}\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 1,
  "modified": "2021-11-16 14:41:40.424207",
  "name": "Lead-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Lead', {\n\trefresh(frm) {\n\t\t\n\t},\n\t\n\tvalidate(frm){\n\t    $.each(frm.doc.lead_contact1,function(i,d){\n\t        var company= d.company\n\t        var c = 0\n\t        $.each(frm.doc.lead_contact1,function(i,v){\n\t            \n\t            if(company == v.company){\n\t                if (c != 1){\n\t                c = 1\n\t                \n\t            }\n\t            else{\n\t                frappe.throw('Company '+ company + ' entered multipe times')\n\t            }\n\t            }\n\t         \n\t        })\n\t    })\n\t},\n\torganization_name(frm){\n\t\tif(frm.doc.organization_name){\n\t\t\tfrm.set_value('company_name',frm.doc.organization_name)\n\t\t}\n\t}\n})\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2022-01-04 09:47:52.078863",
  "name": "Customer-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Customer', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\t\n\tcustomer_name(frm){\n\t    console.log(frm.doc.customer_name)\n\t},\n\t\n\tvalidate(frm){\n\t    $.each(frm.doc.customer_table,function(i,d){\n\t        var company= d.company\n\t        var s = 0\n\t        $.each(frm.doc.customer_table,function(i,v){\n\t            \n\t            if(company == v.company){\n\t                if (s != 1){\n\t                s = 1\n\t                \n\t            }\n\t            else{\n\t                console.log(\"ujsu\")\n\t                frappe.throw('Company '+ company + ' entered multiple times')\n\t            }\n\t            }\n\t         \n\t        })\n\t    })\n\t}\n})\n\n\n\t",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Staffing Plan",
  "enabled": 1,
  "modified": "2021-09-21 10:00:03.954558",
  "name": "Staffing Plan-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Staffing Plan', {\n\trefresh(frm) {\n\t\t// your code here\n\t}\n})\n\n\nfrappe.ui.form.on('Manpower Plan', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\tdesignation(frm,cdt,cdn) {\n\t\tvar child = locals[cdt][cdn]\n\t\tconsole.log(child.designation)\n\t    if(child.designation){\n\t    frappe.db.count('Employee')\n    .then(count => {\n        console.log(count)\n        child.available_manpower = count\n        frm.refresh_field('manpower_')\n    })\n\t}\n\tfrm.refresh_field('manpower_')\n\t}\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Manpower plan Tool",
  "enabled": 0,
  "modified": "2021-11-01 10:10:40.679446",
  "name": "Manpower plan Tool-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Manpower plan Tool', {\n\trefresh(frm) {\n\t\tfrm.disable_save();\n\t},\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Opening",
  "enabled": 1,
  "modified": "2022-10-20 15:18:34.868997",
  "name": "Job Opening-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Opening', {\n\trefresh(frm) {\n\t\thide_field(\"job_title\")\n\t},\n\t\n\tvalidate(frm){\n\t    frm.trigger(\"designation\")\n\t},\n\t\n\tdesignation:function(frm){\n\t    if(frm.doc.designation){\n\t        var s=frm.doc.designation\n\t          frm.set_value(\"job_title\",s)\n\t    }\n\t},\n\tsetup: function(frm){\n\t    frm.set_query(\"company\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\t\"is_group\":1,\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Material Request",
  "enabled": 1,
  "modified": "2022-08-23 17:27:58.422729",
  "name": "Material Request-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Material Request', {\n    \n\trefresh(frm) {\n\t\tif(frm.doc.company){\n\t\tfrm.trigger(\"set_series\")\n\t\tfrm.trigger(\"set_warehouse\")\n\t    }\n\t},\n\t\n\tset_warehouse(frm){\n\t    console.log('ki')\n\t    if(frm.doc.company){\n\t        var emp_basic = frappe.db.get_value('Warehouse', {'company':frm.doc.company,'default_for_stock_transfer':1}, 'name')\n\t        .then(r => {\n\t            console.log(r)\n\t            frm.set_value('set_warehouse',r.message.name)\n          })\n\t   } \n\t   frm.trigger(\"set_series\")\n\n\t    \n\t},\n\t\n\t  \n        \n\n\tonload(frm){\n\t    if(frm.doc.docstatus == 1){\n\t    frm.add_custom_button(__(\"Print\"), function () {\n                        if(frm.doc.parent_company){\n                            var letter_head = frm.doc.parent_company\n                        }\n                        else{\n                            var letter_head = frm.doc.company\n                        } \n                        var f_name = frm.doc.name\n                        var print_format =\"Material Request\";\n                         window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                            + \"doctype=\" + encodeURIComponent(\"Material Request\")\n                            + \"&name=\" + encodeURIComponent(f_name)\n                            + \"&trigger_print=1\"\n                            + \"&format=\" + print_format\n                            + \"&no_letterhead=0\"\n                            + \"&letterhead=\" + encodeURIComponent(letter_head) \n                           ));\n                    \n        \n                    });\n                \n\t    }\n\t    if(frm.doc.docstatus != 1){\n\t    frm.set_value(\"requester_name\",frappe.session.user)\n\t    }\n\t    frm.trigger('set_warehouse')\n\t    \n\t},\n\tset_series(frm){\n\t    frappe.call({\n    \t\tmethod: \"electra.utils.get_series\",\n    \t\targs: {\n    \t\t\tcompany: frm.doc.company,\n    \t\t\tdoctype: frm.doc.doctype\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    frm.set_value('naming_series',r.message)\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t}\n})\n\nfrappe.ui.form.on('Material Request Item', {\n\titem_code(frm,cdt,cdn) {\n\t    var child = locals[cdt][cdn]\n\t    if(child.item_code){\n\t  frappe.call({\n\t        method: 'electra.custom.stock_popup',\n\t        args:{\n\t            'item_code':child.item_code\n\t        },\n\t        callback(d){\n\t           if (d.message){\n\t              frm.get_field(\"item_html\").$wrapper.html(d.message);\n\t           }\n\t       }\n\t    })\n\t    \n\t    }\n\t},\n\t\titems_remove(frm){\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Order",
  "enabled": 1,
  "modified": "2022-11-17 08:27:07.116808",
  "name": "Purchase Order-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Purchase Order', {\n    before_save(frm){\n        frappe.db.get_value('Supplier',frm.doc.supplier,'approved_supplier')\n        .then(r => {\n            var value = r.message.approved_supplier\n            if(value == 0){\n                frappe.msgprint(\"Not an approved supplier\")\n                frm.set_value('supplier',\"\")\n            }\n        })\n    },\n    parent_company(frm) {\n        console.log(\"hi\")\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\n\t},\n    validate(frm){\n        $.each(frm.doc.items,function(i,v){\n\t       //  console.log(v.qty)\n              v.price_list_rate = v.qty\n              console.log(v.price_list_rate)\n              \n            })\n            frm.refresh_field('items')\n            \n\t    frappe.call({\n\t        method :\"electra.utils.get_evaluation_date\",\n\t        args: {\n\t            \"supplier\":frm.doc.supplier\n    \t\t\t\t },\n\t        callback(r){\n\t            if(r.message){\n\t                if(r.message < frm.doc.transaction_date){\n\t                    frappe.msgprint(__(\"Re-evaluation is required for this supplier\"));\n\t                }\n\t                }\n\t            }\n\t    })\n\t},\n\trefresh(frm) {\n\t    if(frm.doc.company){\n\t\tfrm.trigger(\"set_series\")\n\t    }\n\t     if(frm.doc.docstatus == 1){\n\t    frm.add_custom_button(__(\"Print PO\"), function () {\n                if(frm.doc.parent_company){\n                    var letter_head = frm.doc.parent_company\n                }\n                else{\n                    var letter_head = frm.doc.company\n                } \n                var f_name = frm.doc.name\n                console.log(letter_head)\n                var print_format =\"Purchase Order Test\";\n                 window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                    + \"doctype=\" + encodeURIComponent(\"Purchase Order\")\n                    + \"&name=\" + encodeURIComponent(f_name)\n                    + \"&trigger_print=1\"\n                    + \"&format=\" + print_format\n                    + \"&no_letterhead=0\"\n                    + \"&letterhead=\" + encodeURIComponent(letter_head) \n                   ));\n            \n\n            });\n//             var input = 'input[data-fieldname=\"item_code\"][data-doctype=\"Previous PO\"]';\n// \t\tvar isFocus = false;\n// \t\tfrm.fields_dict.previous_purchase_order.wrapper.on('click', input, function (e) {\n// \t\t\tif (!isFocus) {\n// \t\t\t\tconst item_code = e.currentTarget.value;\n// \t\t\t\tfrappe.call({\n// \t\t\t\t\tmethod: 'electra.custom.previous_po_html',\n// \t\t\t\t\targs: {\n// \t\t\t\t\t\t'item_code': item_code,\n// \t\t\t\t\t},\n// \t\t\t\t\tcallback(d) {\n// \t\t\t\t\t    console.log(d.message)\n// \t\t\t\t\t\tif (d.message) {\n// \t\t\t\t\t\t\tfrm.get_field(\"previous_po\").$wrapper.html(d.message);\n// \t\t\t\t\t\t}\n// \t\t\t\t\t}\n// \t\t\t\t})\n// \t\t\t}\n// \t\t\tisFocus = false;\n// \t\t})\n\t   \n// \t\tfrm.add_custom_button(__('Logistics Request'), function(){\n\t\n// \t    var lg = frappe.model.make_new_doc_and_get_name('Logistics Request');\n//         lg = locals['Logistics Request'][lg];\n//         lg.order_no = frm.doc.name\n//         lg.logistic_type = \"Import\"\n//         lg.po_so = \"Purchase Order\"\n//         frappe.set_route(\"Form\",\"Logistics Request\",lg.name)\n\t\t    \n// \t    })\n\t     }\n\t},\n\tfetch(frm){\n\t    frappe.call({\n\t        method: 'electra.custom.get_stock_balance',\n\t        args:{\n\t            'item_table':frm.doc.items\n\t        },\n\t        callback(d){\n\t            frm.clear_table('stock_availability')\n\t            if (d.message){\n\t                $.each(d.message,function(i,v){\n\t                    frm.add_child('stock_availability',{\n\t                        'item_code':v[0],\n\t                        'item_name':v[1],\n\t                        'warehouse':v[2],\n\t                        'qty':v[3],\n\t                        'uom':v[4],\n\t                        'value':v[5]\n\t                    })\n\t                    frm.refresh_field('stock_availability')\n\t                })\n\t            }\n\t       }\n\t    })\n\t    frappe.call({\n\t        method: 'electra.custom.set_previous_po',\n\t        args:{\n\t            'item_table':frm.doc.items\n\t        },\n\t        callback(d){\n\t            frm.clear_table('previous_purchase_order')\n\t            if (d.message){\n\t                $.each(d.message,function(i,v){\n\t                    frm.add_child('previous_purchase_order',{\n\t                        'item_code':v[0],\n\t                        'item_name':v[1],\n\t                        'qty':v[2]\n\t                    })\n\t                    frm.refresh_field('previous_purchase_order')\n\t                })\n\t            }\n\t       }\n\t    })\n       \n\t    \n\t    frappe.call({\n\t        method: 'electra.custom.get_out_qty',\n\t        args:{\n\t            'item_table':frm.doc.items\n\t        },\n\t        callback(d){\n\t            frm.clear_table('stock_out_qty')\n\t            if (d.message){\n\t                $.each(d.message,function(i,v){\n\t                    frm.add_child('stock_out_qty',{\n\t                        'item_code':v[0],\n\t                        'warehouse':v[1],\n\t                        'qty':v[2],\n\t                        'date':v[3],\n\t                        'out_type':v[4]\n\t                    })\n\t                    frm.refresh_field('stock_out_qty')\n\t                })\n\t            }\n\t       }\n\t    })\n\t},\n\tcompany(frm){\n\t    if(frm.doc.company){\n\t    frm.trigger(\"set_series\")\n\t    }\n\t},\n\tset_series(frm){\n\t    frappe.call({\n    \t\tmethod: \"electra.utils.get_series\",\n    \t\targs: {\n    \t\t\tcompany: frm.doc.company,\n    \t\t\tdoctype: frm.doc.doctype\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    frm.set_value('naming_series',r.message)\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t}\n});\nfrappe.ui.form.on('Purchase Order Item', {\n\titem_code(frm,cdt,cdn) {\n\t    var child = locals[cdt][cdn]\n\t    \n\t    if(child.item_code){\n            frm.trigger('fetch')\n\t            frappe.call({\n\t\t\t\t\tmethod: 'electra.custom.previous_po_html',\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'item_code': child.item_code,\n\t\t\t\t\t},\n\t\t\t\t\tcallback(d) {\n\t\t\t\t\t    console.log(d.message)\n\t\t\t\t// \t\tif (d.message) {\n\t\t\t\t// \t\t\tfrm.get_field(\"previous_po\").$wrapper.html(d.message);\n\t\t\t\t// \t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t    }\n\t},\n\titems_remove(frm){\n\t    frm.trigger('fetch')\n\t}\n})\n\n\n\n\nfrappe.ui.form.on('Previous PO', {\n\tshow(frm,cdt,cdn) {\n\t    var child = locals[cdt][cdn]\n        frappe.call({\n\t\t\tmethod: 'electra.custom.previous_po_html',\n\t\t\targs: {\n\t\t\t\t'item_code': child.item_code,\n\t\t\t},\n\t\t\tcallback(d) {\n\t\t\t    console.log(d.message)\n\t\t\t\tif (d.message) {\n\t\t\t\t\tfrm.get_field(\"previous_po\").$wrapper.html(d.message);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity",
  "enabled": 1,
  "modified": "2022-11-16 07:57:19.668641",
  "name": "Opportunity-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Opportunity', {\n    converted_by(frm){\n        frappe.call({\n            method: \"electra.utils.get_user_details\",\n            args:{\n                \"user\": frm.doc.converted_by\n            },\n            callback:function(d){\n                console.log(d)\n                if(d.message){\n                // frm.set_value(\"user_id\",frm.doc.converted_by)\n                frm.set_value(\"user_name\",d.message.employee_name)\n                frm.set_value(\"converted_by_designation_\",d.message.designation)\n                frm.set_value(\"converted_by_mobile\",d.message.cell_number)\n                }\n                }\n        })\n    },\n    prepared_by(frm){\n        frappe.call({\n            method: \"electra.utils.get_user_details\",\n            args:{\n                \"user\": frm.doc.prepared_by\n            },\n            callback:function(d){\n                console.log(d)\n                if(d.message){\n                // frm.set_value(\"user_id\",frm.doc.user_id)\n                frm.set_value(\"user_name\",d.message.employee_name)\n                frm.set_value(\"prepared_by_designation\",d.message.designation)\n                frm.set_value(\"prepared_by_mobile\",d.message.cell_number)\n                }\n                }\n        })\n    },\n    setup(frm){\n        frm.set_query('prepared_by',function(doc){\n            return{\n                query:\"electra.utils.get_company_users\",\n                filters:{\n                    'company':frm.doc.company\n                }\n            }\n        })        \n    },\n//     setup(frm){\n//         frm.set_query('converted_by', function(doc) {\n// \t\t\treturn {\n// \t\t\t\tquery: \"electra.utils.get_company_users\",\n// \t\t\t\tfilters: {\n// \t\t\t\t\t'company': frm.doc.company\n// \t\t\t\t}\n// \t\t\t};\n// \t\t});\n//     },\n\n    onload(frm){\n        frm.trigger(\"get_credit_limit\")\n        frm.get_field(\"items_html\").$wrapper.html();\n        \n        \n      \n    },\n    party_name(frm){\n        frm.trigger(\"get_credit_limit\")\n    },\n    opportunity_from(frm){\n        frm.trigger(\"get_credit_limit\")\n    },\n    get_credit_limit(frm){\n        $(frm.fields_dict.credit_limit.wrapper).empty();\n        if(frm.doc.opportunity_from == 'Customer' && frm.doc.party_name && frm.doc.company){\n             \n            frappe.call({\n\t        method: 'electra.utils.fetch_credit_limit',\n\t        args:{\n\t            \"company\" : frm.doc.company,\n\t            \"customer\" : frm.doc.party_name\n\t        },\n\t        callback(d){\n\t           if (d.message){\n\t            $(frm.fields_dict.credit_limit.wrapper).append(d.message);\n\n\t           }\n\t       }\n\t    })\n        }\n    },\n    refresh(frm){\n    //     frm.add_custom_button(__(\"Stock Details\"), function () {\n    //         var item_details_list = []\n    //         var item_details = {}\n    //         $.each(frm.doc.items, function (i, d) {\n    //             item_details = {}\n    //             item_details['item_code'] = d.item_code\n    //             item_details['item_name'] = d.item_name\n    //             item_details['qty'] = d.qty\n    //             item_details['rate'] = d.rate\n    //             item_details_list.push(item_details)\n    //         })\n    //         frappe.call({\n\t\t  //  \tmethod: \"electra.utils.get_stock_details\",\n\t\t\t //   args: {\n\t\t\t //   \t\"company\": frm.doc.company,\n\t\t\t\t//     \"item_details\": item_details_list\n\t\t  //  \t},\n\t\t  //  \tcallback (r) {\n\t\t  //  \t\tif (r.message) {\n\t\t  //  \t\t    console.log(r.message)\n\t\t\t //           let d = new frappe.ui.Dialog({\n    //                         size:\"extra-large\",\n    //                         title: 'Stock Details',\n    //                         fields: [\n    //                             {\n    //                                 label: 'Stock Details',\n    //                                 fieldname: 'stock_details',\n    //                                 fieldtype: 'HTML'\n    //                             },\n    //                         ],\n                                    \n    //                     });\n    //                     d.fields_dict.stock_details.$wrapper.html(r.message);\n    //                     d.show();\t\n\t\t  //  \t\t}\n\t\t  //  \t}\n\t\t  //  });\n                \n    //     });\n\t\tif(frm.doc.__islocal){\n\t\t  // frm.set_value('converted_by',frappe.session.user)\n\t\t   frm.set_value('prepared_by',frappe.session.user)\n\t\t   frm.set_value('contact_by',frappe.session.user)\n\t\t    \n\t\t}\n\t\telse{\n\t\t    frm.add_custom_button(__('Cost Estimation'),\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tfrappe.model.open_mapped_doc({\n\t\t\tmethod: \"electra.custom.make_cost_estimation\",\n\t\t\tfrm: cur_frm\n\t\t})\n\t\t\t\t\t}, __('Create'));\n\t\t}\n\t\t\n    },\n\tvalidate(frm) {\n\t\t// your code here\n\t\t\n\t},\n\tfetch(frm){\n\t   \n\t    frappe.call({\n\t        method: 'electra.custom.get_stock_balance',\n\t        args:{\n\t            'item_table':frm.doc.items\n\t        },\n\t        callback(d){\n\t            frm.clear_table('stock_availability')\n\t            if (d.message){\n\t                $.each(d.message,function(i,v){\n\t                    frm.add_child('stock_availability',{\n\t                        'item_code':v[0],\n\t                        'item_name':v[1],\n\t                        'warehouse':v[2],\n\t                        'qty':v[3],\n\t                        'uom':v[4],\n\t                        'value':v[5]\n\t                    })\n\t                    frm.refresh_field('stock_availability')\n\t                })\n\t            }\n\t       }\n\t    })\n\t    \n\t     frappe.call({\n\t        method: 'electra.custom.get_previous_po',\n\t        args:{\n\t            'item_table':frm.doc.items\n\t        },\n\t        callback(d){\n\t            frm.clear_table('previous_po')\n\t            if (d.message){\n\t                $.each(d.message,function(i,v){\n\t                    frm.add_child('previous_po',{\n\t                        'item_code':v[0],\n\t                        'item_name':v[1],\n\t                        'supplier':v[2],\n\t                        'qty':v[3],\n\t                        'po_date':v[4],\n\t                        'amount':v[5],\n\t                        'purchase_order':v[6]\n\t                    })\n\t                    frm.refresh_field('previous_po')\n\t                })\n\t            }\n\t       }\n\t    })\n\t    \n\t    frappe.call({\n\t        method: 'electra.custom.get_under_so',\n\t        args:{\n\t            'item_table':frm.doc.items\n\t        },\n\t        callback(d){\n\t            frm.clear_table('pending_sales_order')\n\t            if (d.message){\n\t                $.each(d.message,function(i,v){\n\t                    frm.add_child('pending_sales_order',{\n\t                        'item_code':v[0],\n\t                        'item_name':v[1],\n\t                        'qty':v[2],\n\t                        'date':v[3]\n\t                    })\n\t                    frm.refresh_field('pending_sales_order')\n\t                })\n\t            }\n\t       }\n\t    })\n\t},\n\tonload(frm){\n\t    \n\t    var current_date =  frappe.datetime.nowdate()\n    \tvar next_week=frappe.datetime.add_days(current_date,7);\n    \tconsole.log(next_week)\n    \tfrm.set_value('expected_closing',next_week)\n\t\n\t}\n\t\n})\n\nfrappe.ui.form.on('Opportunity Item', {\n    item_code(frm,cdt,cdn) {\n\t    var child = locals[cdt][cdn]\n\t    if(child.item_code){\n\t  frm.trigger('fetch')\n\t   frappe.call({\n\t        method: 'electra.custom.stock_popup',\n\t        args:{\n\t            'item_code':child.item_code\n\t        },\n\t        callback(d){\n\t           if (d.message){\n\t              frm.get_field(\"items_html\").$wrapper.html(d.message);\n\t           }\n\t       }\n\t    })\n\t  \n\t    \n\t    }\n\t},\n\titems_remove(frm){\n\t    frm.trigger('fetch')\n\t},\n\n\t\t\n// \t} \n\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Follow UP",
  "enabled": 1,
  "modified": "2021-11-16 14:51:03.996496",
  "name": "Sales Followup-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Follow UP', {\n\trefresh(frm){\n\t\thide_field(['status']);\n\t\tif(frm.doc.follow_up_for==\"Lead\"){\n\t\t    frappe.call({\n\t\t\t\tmethod: 'frappe.client.get',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Lead',\n\t\t\t\t\t'filters': { 'name': frm.doc.lead_customer },\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t    if(r.message.status == 'Converted'){\n\t\t\t\t\t        $(frm.fields_dict.customer_info.wrapper).append(\"<div class='fa fa-info'> <b>Customer has been already created against this Lead, You can either follow against this document or create a new followup with customer under 'Follow up for' Menu.<b></div>\");\n\t\t\t\t\t    }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t    unhide_field(['status']);\n\t\t}\n\t\t\n\t\tif(frm.doc.__islocal){\n\t\t    frm.set_value('next_contact_by',frappe.session.user)\n\t\t    frm.set_value('account_manager',frappe.session.user)\n\t\t}\n\t\t\n\t},\n\tonload(frm){\n\t    if(frm.doc.follow_up_for==\"Lead\"){\n\t    frm.set_query('lead_customer', function(doc) {\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\t\"status\": [\"!=\",'Converted']\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t    }\n\t},\n\tlead_customer(frm){\n\t    if(frm.doc.follow_up_for==\"Lead\"){\n\t          frappe.call({\n\t\t\t\tmethod: 'frappe.client.get',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Lead',\n\t\t\t\t\t'filters': { 'name': frm.doc.lead_customer },\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t    frm.set_value(\"status\",r.message.status)\n\t\t\t\t\t    frm.set_value(\"organization_name\",r.message.company_name)\n\t\t\t\t\t    frm.set_value(\"person_name\",r.message.lead_name)\n\t\t\t\t\t    frm.set_value(\"email_address\",r.message.email_id)\n\t\t\t\t\t    frm.set_value(\"industry\",r.message.industry)\n\t\t\t\t\t    frm.set_value(\"territory\",r.message.territory)\n\t\t\t\t\t    frm.set_value(\"market_segment\",r.message.market_segment)\n\t\t\t\t\t    frm.set_value(\"account_manager\",r.message.lead_owner)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\tunhide_field(['status']);\n\t    }\n\t    if(frm.doc.follow_up_for==\"Customer\"){\n\t          frappe.call({\n\t\t\t\tmethod: 'frappe.client.get',\n\t\t\t\targs: {\n\t\t\t\t\t'doctype': 'Customer',\n\t\t\t\t\t'filters': { 'name': frm.doc.lead_customer },\n\t\t\t\t},\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t    frm.set_value(\"organization_name\",r.message.customer_name)\n\t\t\t\t\t    frm.set_value(\"email_address\",r.message.email_id)\n\t\t\t\t\t    frm.set_value(\"industry\",r.message.industry)\n\t\t\t\t\t    frm.set_value(\"territory\",r.message.territory)\n\t\t\t\t\t    frm.set_value(\"market_segment\",r.message.market_segment)\n\t\t\t\t\t    frm.set_value(\"account_manager\",r.message.account_manager)\n\t\t\t\t\t    frm.set_value(\"billing_currency\",r.message.default_currency)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t    }\n\t},\n\t\n\tfollow_up_for(frm){\n\t    if(frm.doc.follow_up_for==\"Lead\"){\n\t          frm.set_df_property('lead_customer', \"label\", frm.doc.follow_up_for )\n\t    }\n\t    \n\t    if(frm.doc.follow_up_for==\"Customer\"){\n\t          hide_field(['status']);\n\t          frm.set_df_property('lead_customer', \"label\", frm.doc.follow_up_for )\n\t    }\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2022-11-16 12:19:49.739982",
  "name": "Quotation-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Quotation', {\n    before_cancel(frm){\n        let dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Cancellation Remarks'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Cancellation Remarks',\n\t\t\t\t\tfieldtype: 'Small Text',\n\t\t\t\t\tfieldname: 'remarks',\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __('Add'),\n\t\t\tprimary_action: () => {\n\t\t\t\tlet values = dialog.get_values();\n\t\t\t\tif (values) {\n\t\t\t\t\tvar remarks = values['remarks']\n\t\t\t\t\tfrm.set_value('remarks',remarks)\n\t\t\t\t}\n\t\t\t\tdialog.hide();\n\t\t\t},\n\t\t});\n\t\tdialog.show();\n    },\n     \n\tcurrency(frm){\n    \t$.each(frm.doc.scope_of_work, function (i, d) {\n    \t\tfrappe.call({\n    \t\tmethod: 'erpnext.setup.utils.get_exchange_rate',\n    \t\targs: {\n    \t\t\tfrom_currency: frm.doc.currency,\n    \t\t\tto_currency: \"QAR\"\n    \t\t},\n    \t\tcallback: function(r) {\n    \t\t\tif (r.message) {\n    \t\t\t\td.unit_price = (d.unit_price_company_currency / r.message)\n    \t\t\t\td.total_bidding_price = d.unit_price * d.qty\n    \t\t\t}\n    \t\t}\n    \t});\n    \t\tfrm.refresh_field('scope_of_work')\n\t\t\t})\n\t},\n\tprint: function (frm) {\n\t\tfrm.add_custom_button(__(\"Trading\"), function () {\n\t\t\tif (frm.doc.parent_company) {\n\t\t\t\tvar letter_head = frm.doc.parent_company\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar letter_head = frm.doc.company\n\t\t\t}\n\t\t\tvar f_name = frm.doc.name\n\t\t\tvar print_format = \"Quotation Test\";\n\t\t\twindow.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n\t\t\t\t+ \"doctype=\" + encodeURIComponent(\"Quotation\")\n\t\t\t\t+ \"&name=\" + encodeURIComponent(f_name)\n\t\t\t\t+ \"&trigger_print=1\"\n\t\t\t\t+ \"&format=\" + print_format\n\t\t\t\t+ \"&no_letterhead=0\"\n\t\t\t\t+ \"&letterhead=\" + encodeURIComponent(letter_head)\n\t\t\t));\n\n\n\t\t}, __(\"Print Quotation for\"));\n\n\t\tfrm.add_custom_button(__(\"Projects\"), function () {\n\t\t\tif (frm.doc.parent_company) {\n\t\t\t\tvar letter_head = frm.doc.parent_company\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar letter_head = frm.doc.company\n\t\t\t}\n\t\t\tvar f_name = frm.doc.name\n\t\t\tvar print_format = \"Project Quotation\";\n\t\t\twindow.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n\t\t\t\t+ \"doctype=\" + encodeURIComponent(\"Quotation\")\n\t\t\t\t+ \"&name=\" + encodeURIComponent(f_name)\n\t\t\t\t+ \"&trigger_print=1\"\n\t\t\t\t+ \"&format=\" + print_format\n\t\t\t\t+ \"&no_letterhead=0\"\n\t\t\t\t+ \"&letterhead=\" + encodeURIComponent(letter_head)\n\t\t\t));\n\n\n\t\t}, __(\"Print Quotation for\"));\n\n\t},\n\n\tconverted_by(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: \"electra.utils.get_user_details\",\n\t\t\targs: {\n\t\t\t\t\"user\": frm.doc.converted_by\n\t\t\t},\n\t\t\tcallback: function (d) {\n\t\t\t\tif (d.message) {\n\t\t\t\t\tfrm.set_value(\"user_id\", frm.doc.user_id)\n\t\t\t\t\tfrm.set_value(\"converted_by_username\", d.message.employee_name)\n\t\t\t\t\tfrm.set_value(\"converted_by_designation\", d.message.designation)\n\t\t\t\t\tfrm.set_value(\"converted_by_mobile\", d.message.cell_number)\n\t\t\t\t}\n\t\t\t},\n\t\t})\n\t},\n\n\tuser_id(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: \"electra.utils.get_user_details\",\n\t\t\targs: {\n\t\t\t\t\"user\": frm.doc.user_id\n\t\t\t},\n\t\t\tcallback: function (d) {\n\t\t\t\tif (d.message) {\n\t\t\t\t\tfrm.set_value(\"user_id\", frm.doc.user_id)\n\t\t\t\t\t// \tfrm.set_value(\"user_name\", d.message.employee_name)\n\t\t\t\t\tfrm.set_value(\"designation\", d.message.designation)\n\t\t\t\t\tfrm.set_value(\"mobile_number\", d.message.cell_number)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\n\tcreate(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: 'electra.custom.create_address',\n\t\t\targs: {\n\t\t\t\t'name': frm.doc.party_name,\n\t\t\t\t'address_1': frm.doc.address_line_1,\n\t\t\t\t'address_2': frm.doc.address_line_2,\n\t\t\t\t'city': frm.doc.city\n\t\t\t},\n\n\t\t\tcallback(r) {\n\t\t\t\tfrm.set_value('customer_address', frm.doc.party_name + \"-Billing\")\n\t\t\t}\n\n\t\t})\n\t\t// \t\tfrm.set_query( 'address',() => {\n\t\t//     \t    return {\n\t\t//     \t        filters :{'plant':frm.doc.plant,\n\t\t//     \t        'subcontractor_id' : frm.doc.sub_contractor,\n\t\t//     \t        }\n\t\t//     \t    }\n\t\t//     \t})\n\t},\n\n\tcontact_creation(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: 'electra.custom.create_contact',\n\t\t\targs: {\n\t\t\t\t'name': frm.doc.contact_person_name,\n\t\t\t\t'email': frm.doc.contact_person_email,\n\t\t\t\t'designation': frm.doc._person_designation,\n\t\t\t\t'customer_name': frm.doc.party_name\n\t\t\t},\n\n\t\t\tcallback(r) {\n\t\t\t\tfrm.set_value('contact_person', frm.doc.contact_person_name + \"-\" + frm.doc.party_name)\n\t\t\t}\n\t\t})\n\t},\n\t\n\trefresh(frm) {\n\t   // frm.trigger(\"calculate\")\n\t\tfrm.set_value(\"address_title\", frm.doc.party_name)\n\t\t// frm.trigger(\"print\")\n// \t\tfrm.trigger(\"get_credit_limit\")\n\t\tvar input = 'input[data-fieldname=\"item_code\"][data-doctype=\"Quotation Item\"]';\n\t\tvar isFocus = false;\n\t\tfrm.fields_dict.items.grid.wrapper.on('click', input, function (e) {\n\t\t\tif (!isFocus) {\n\t\t\t\tconst item_code = e.currentTarget.value;\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'electra.custom.stock_popup',\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'item_code': item_code,\n\t\t\t\t// \t\t'company':frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tcallback(d) {\n\t\t\t\t\t    console.log(d.message)\n\t\t\t\t\t\tif (d.message) {\n\t\t\t\t\t\t\tfrm.get_field(\"items_html\").$wrapper.html(d.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t\tisFocus = false;\n\t\t});\n\n\t\tfrm.trigger(\"set_prepared_by\")\n\t\tif (frm.doc.company) {\n\t\t\tfrm.trigger(\"set_series\")\n\t\t}\n\t\t\n// \t\tMargin Details\n        if (frappe.user.has_role(\"HOD\")) {\n\t\t\tfrm.add_custom_button(__(\"Margin Details\"), function () {\n\t\t\t    \n\t\t\tvar item_details_list = []\n\t\t\tvar item_details = {}\n\t\t\t$.each(frm.doc.items, function (i, d) {\n\t\t\t\titem_details = {}\n\t\t\t\titem_details['item_code'] = d.item_code\n\t\t\t\titem_details['item_name'] = d.item_name\n\t\t\t\titem_details['description'] = d.description\n\t\t\t\titem_details['qty'] = d.qty\n\t\t\t\titem_details['rate'] = d.rate\n\t\t\t\titem_details['valuation_rate'] = d.valuation_rate\n\t\t\t\titem_details['base_amount'] = d.base_amount\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t// item_details['special_cost'] = d.special_cost\n\t\t\t\t// item_details['internal_cost'] = d.internal_cost\n\t\t\t\titem_details_list.push(item_details)\n\t\t\t})\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"electra.utils.get_item_margin\",\n\t\t\t\targs: {\n\t\t\t\t\t'name': frm.doc.name,\n\t\t\t\t\t'item_details': item_details_list,\n\t\t\t\t\t\"company\": frm.doc.company,\n// \t\t\t\t\t\"exchange_rate\": frm.doc.conversion_rate,\n// \t\t\t\t\t\"currency\": frm.doc.currency,\n// \t\t\t\t\t'user': frappe.session.user,\n// \t\t\t\t\t// 'role':frappe.user.has_role\n\n\t\t\t\t},\n\t\t\t\tcallback(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tconsole.log(r.message)\n\t\t\t\t\t\tlet d = new frappe.ui.Dialog({\n\t\t\t\t\t\t\tsize: \"extra-large\",\n\t\t\t\t\t\t\ttitle: 'Margin',\n\t\t\t\t\t\t\tfields: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlabel: 'Margin',\n\t\t\t\t\t\t\t\t\tfieldname: 'margin',\n\t\t\t\t\t\t\t\t\tfieldtype: 'HTML'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\n\t\t\t\t\t\t});\n\t\t\t\t\t\td.fields_dict.margin.$wrapper.html(r.message);\n\t\t\t\t\t\td.show();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t})\n\n\t\t});\n\t\t}\n\t\t\t\n\t\t//Buttuon Creati\n\t\t\n        frm.add_custom_button(__(\"Stock Details\"), function () {\n            var item_details_list = []\n            var item_details = {}\n            $.each(frm.doc.items, function (i, d) {\n                item_details = {}\n                item_details['item_code'] = d.item_code\n                item_details['item_name'] = d.item_name\n                item_details['qty'] = d.qty\n                item_details['rate'] = d.rate\n                item_details_list.push(item_details)\n            })\n            frappe.call({\n\t\t    \tmethod: \"electra.utils.getstock_detail\",\n\t\t\t    args: {\n\t\t\t    \t\"company\": frm.doc.company,\n\t\t\t\t    \"item_details\": item_details_list\n\t\t    \t},\n\t\t    \tcallback (r) {\n\t\t    \t\tif (r.message) {\n\t\t    \t\t    console.log(r.message)\n\t\t\t            let d = new frappe.ui.Dialog({\n                            size:\"extra-large\",\n                            title: 'Stock Details',\n                            fields: [\n                                {\n                                    label: 'Stock Details',\n                                    fieldname: 'stock_details',\n                                    fieldtype: 'HTML'\n                                },\n                            ],\n                                    \n                        });\n                        d.fields_dict.stock_details.$wrapper.html(r.message);\n                        d.show();\t\n\t\t    \t\t}\n\t\t    \t}\n\t\t    });\n\t\t    frappe.call({\n\t\t    \tmethod: \"electra.utils.getstock_detail\",\n\t\t\t    args: {\n\t\t\t    \t\"company\": frm.doc.company,\n\t\t\t\t    \"item_details\": item_details_list\n\t\t    \t},\n\t\t    \tcallback (r) {\n\t\t    \t\tif (r.message) {\n\t\t    \t\t    console.log(r.message)\n\t\t    \t\t}\n\t\t    \t}\n\t\t    });\n                \n        });\n        \n\n\t},\n\t\n    // stock_details(frm){\n    //     console.log(\"hi\")\n    //      $.each(frm.doc.items, function (i, d) {\n    //             var item_details_list = []\n    //             var item_details = {}\n    //             item_details['item_code'] = d.item_code\n    //             item_details['item_name'] = d.item_name\n    //             item_details['description'] = d.description\n    //             item_details['qty'] = d.qty\n    //             item_details['rate'] = d.rate\n    //             item_details['special_cost'] = d.special_cost\n    //             item_details_list.push(item_details)\n    //         })\n    //      frappe.call({\n\t\t  //  \tmethod: \"electra.utils.get_stock_details\",\n\t\t\t //   args: {\n\t\t\t //   \t\"company\": frm.doc.company,\n\t\t\t\t//     // \"item_details\": item_details_list\n\t\t  //  \t},\n\t\t  //  \tcallback (r) {\n\t\t  //  \t\tif (r.message) {\n\t\t  //  \t\t    console.log(r.message)\n\t\t\t //   \t\tfrm.get_field(\"stock\").$wrapper.html(r.message)\n\t\t  //  \t\t}\n\t\t  //  \t}\n\t\t  //  });\n    \n    // },\t\n\n\tcompany(frm) {\n\t\tif (frm.doc.company) {\n\t\t\tfrm.trigger(\"set_series\")\n\t\t}\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t\t// \t\tif (frm.doc.company == \"Electra\"){\n\t\t// \t\t    frm.set_value('letter_head',\"Electra\")\n\t\t// \t\t}\n\n\t},\n\tset_series(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: \"electra.utils.get_series\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\tdoctype: frm.doc.doctype\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r) {\n\t\t\t\t\tfrm.set_value('naming_series', r.message)\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tcreate_contact(frm) {\n\t\tlet d = new frappe.ui.Dialog({\n\t\t\ttitle: 'Enter details',\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Name',\n\t\t\t\t\tfieldname: 'name',\n\t\t\t\t\tfieldtype: 'Data'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Email ID',\n\t\t\t\t\tfieldname: 'email_id',\n\t\t\t\t\tfieldtype: 'Data'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Contact Number',\n\t\t\t\t\tfieldname: 'contact_number',\n\t\t\t\t\tfieldtype: 'Int'\n\t\t\t\t},\n\t\t\t\t// {\n\t\t\t\t//     label: 'Quotation To',\n\t\t\t\t//     fieldname: 'quotation_to',\n\t\t\t\t//     fieldtype: 'Link',\n\t\t\t\t//     options:'Doctype',\n\t\t\t\t//     default:'Customer'\n\t\t\t\t// },\n\t\t\t\t// {\n\t\t\t\t//     label: 'Link Name',\n\t\t\t\t//     fieldname: 'link_name',\n\t\t\t\t//     fieldtype: 'Dynamic Link',\n\t\t\t\t//     options:'link_doctype'\n\t\t\t\t// }\n\t\t\t],\n\t\t\tprimary_action_label: 'Submit',\n\t\t\tprimary_action(values) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: 'electra.custom.create_contact',\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'name': values.name,\n\t\t\t\t\t\t'email': values.email_id,\n\t\t\t\t\t\t'contact_no': values.contact_number,\n\t\t\t\t\t\t'customer_name': frm.doc.party_name,\n\t\t\t\t\t\t'doc_name': frm.doc.name\n\n\t\t\t\t\t},\n\n\t\t\t\t\tcallback(r) {\n\t\t\t\t\t\tfrm.set_value(\"contact_person_name\", values.name)\n\t\t\t\t\t\tfrm.set_value(\"email_id\", values.email_id)\n\t\t\t\t\t\tfrm.set_value(\"contact_number\", values.contact_number)\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t\td.hide();\n\t\t\t}\n\t\t});\n\n\t\td.show();\n\n\t},\n\tsetup(frm) {\n\t\tfrm.trigger(\"set_prepared_by\")\n\t},\n\n\tset_prepared_by(frm) {\n\t\tif (frm.doc.__islocal) {\n\t\t\tif (frm.doc.opportunity) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Opportunity\",\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\"name\": frm.doc.opportunity\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfields: ['converted_by', 'prepared_by']\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tfrm.set_value(\"converted_by\", r.message.converted_by)\n\t\t\t\t\t\tfrm.set_value('user_id', r.message.prepared_by)\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"electra.utils.get_user_details\",\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\"user\": r.message.converted_by,\n\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcallback: function (d) {\n\t\t\t\t\t\t\t\tif (d.message) {\n\t\t\t\t\t\t\t\t\t// \n\t\t\t\t\t\t\t\t\tfrm.set_value(\"converted_by_designation\", d.message.designation)\n\t\t\t\t\t\t\t\t\tfrm.set_value(\"converted_by_mobile\", d.message.cell_number)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"electra.utils.get_user_details\",\n\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\"user\": r.message.prepared_by,\n\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcallback: function (d) {\n\t\t\t\t\t\t\t\tif (d.message) {\n\t\t\t\t\t\t\t\t\tfrm.set_value(\"user_name\", d.message.employee_name)\n\t\t\t\t\t\t\t\t\tfrm.set_value(\"designation\", d.message.designation)\n\t\t\t\t\t\t\t\t\tfrm.set_value(\"mobile_number\", d.message.cell_number)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\n\t\t\t\t\t\t})\n\n\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfrm.set_value(\"user_id\", frappe.session.user)\n\t\t\t}\n\t\t}\n\t},\n\tparty_name(frm) {\n\t\tfrm.trigger(\"get_credit_limit\")\n\t\n\t},\n\tquotation_to(frm) {\n\t\tfrm.trigger(\"get_credit_limit\")\n\t},\n\tget_credit_limit(frm) {\n\t\t$(frm.fields_dict.credit_limit.wrapper).empty();\n\t\tif (frm.doc.quotation_to == 'Customer' && frm.doc.party_name) {\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'electra.utils.fetch_credit_limit',\n\t\t\t\targs: {\n\t\t\t\t\t\"company\": frm.doc.company,\n\t\t\t\t\t\"customer\": frm.doc.party_name\n\t\t\t\t},\n\t\t\t\tcallback(d) {\n\t\t\t\t    console.log(d)\n\t\t\t\t\tif (d.message) {\n\t\t\t\t\t\t$(frm.fields_dict.credit_limit.wrapper).append(d.message);\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\tdiscount_amount(frm) {\n\t\tfrm.trigger(\"calculate_discount_percent\")\n\t},\n\tcalculate_discount_percent(frm) {\n\t\tif (frm.doc.discount_amount) {\n\t\t\tvar additional_discount_percentage = (frm.doc.discount_amount / frm.doc.total) * 100\n\t\t\tfrm.set_value(\"percent_of_discounted_amount\", additional_discount_percentage)\n\t\t}\n\t},\n\tvalidate(frm) {\n\t    if(frm.doc.__islocal){\n\t        if(frm.doc.amended_from){\n\t        if(frm.doc.cost_estimation){\n    \t        frappe.call({\n        \t\t\tmethod: \"frappe.client.get\",\n        \t\t\targs: {\n        \t\t\t\tdoctype: \"Cost Estimation\",\n        \t\t\t\tfilters: {\n        \t\t\t\t\t\"amended_from\": frm.doc.cost_estimation\n        \t\t\t\t},\n        \t\t\t\tfields: ['name']\n        \t\t\t},\n        \t\t\tcallback: function (r) {\n        \t\t\t    if(r.message.name){\n        \t\t\t        console.log(r.message.name)\n        \t\t\t        frm.set_value('cost_estimation',r.message.name)\n        \t\t\t    }\n        \t\t\t    else{\n        \t\t\t        var ad\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t}\n        \t    })\n\t        }\n\t    }\n\t    }\n\t    \n\t    $.each(frm.doc.items, function (i, d) {\n    \t\tfrappe.call({\n        \t\tmethod: 'electra.custom.product_bundle',\n        \t\targs: {\n        \t\t\titem_code : d.item_code\n        \t\t},\n        \t\tcallback(r){\n        \t\t    frm.clear_table(\"packed_items\")\n        \t\t    $.each(r.message ,function(i,j){\n    \t\t            frm.add_child('packed_items', {\n\t\t\t\t\t\t\t\t'item_code': j.item_code,\n\t\t\t\t\t\t\t\t'description': j.description,\n\t\t\t\t\t\t\t\t'qty': d.qty * j.qty,\n\t\t\t\t\t\t\t\t'parent_item': d.item_code\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\n        \t\t    })\n        \t\t    frm.refresh_field('packed_items')\n\t\t\t\t\t\n        \t\t}\n        \t})\n        })\n\t\t\n\t    if (!frm.doc.__islocal) {\n\t     if(frm.doc.order_type == \"Project\"){\n\t        frappe.call({\n    \t        method: 'electra.custom.get_default_warehouse',\n    \t        args:{\n    \t            'company':frm.doc.company\n    \t        },\n    \t        callback(d) {\n    \t            if(d.message){\n    \t                var whouse = d.message\n    \t                $.each(frm.doc.items, function (i, d) {\n\t\t\t\t\t\t\td.warehouse = whouse\n    \t                })\n    \t            }\n    \t        }\n    \t    })\n\t    }\n\t    }\n\t   // frm.trigger(\"stop_save\")\n\t    var total_bidding_price =0\n    \tvar amount=0\n    \t$.each(frm.doc.scope_of_work, function (i, d) {\n        \tif (d.total_bidding_price) {\n    \t\t\ttotal_bidding_price += d.total_bidding_price\n        \t}\n\t\t\tfrm.set_value('total_bidding_price', total_bidding_price)\n    \t}),\n       \n\t\tfrm.trigger(\"calculate_discount_percent\")\n\t\tif (frm.doc.transaction_date && frm.doc.valid_till) {\n\t\t\tvar end = frappe.datetime.obj_to_str(frm.doc.valid_till);\n\t\t\tvar start = frappe.datetime.obj_to_str(frm.doc.transaction_date);\n\t\t\tvar datediff = frappe.datetime.get_day_diff(end, start);\n\t\t\tfrm.set_value(\"days\", datediff);\n\t\t}\n\t\tif (frm.doc.party_name) {\n\t\t\tfrm.set_value('title', frm.doc.party_name)\n\t\t}\n\n\t},\n\n\tonload(frm) {\n\t    if(frm.doc.__islocal){\n\t        if(frm.doc.docstatus == 0 && !frm.doc.amended_from){\n    \t        frm.set_value(\"converted_by\", frappe.session.user)\n    \t        frm.trigger(\"set_prepared_by\")\n    \t    }\n\t    }\n\t    \n\t    \n\t\tvar date = frm.doc.transaction_date\n\t\tif (frm.doc.docstatus == 0) {\n\t\t\tfrm.set_value('valid_till', frappe.datetime.add_days(date, 7))\n\t\t}\n\n\t\tfrm.trigger(\"print\")\n\t\t\n\t\tfrm.get_field(\"items_html\").$wrapper.html();\n\t\tif (frm.doc.__islocal) {\n\t\t\tif (frm.doc.cost_estimation) {\n\t\t\t\tfrm.set_value(\"order_type\", \"Project\")\n\t\t\t\tfrm.set_value(\"selling_price_list\", \"Cost Estimation\")\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Cost Estimation\",\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\"name\": frm.doc.cost_estimation\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfields: [\"*\"]\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (r) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\tfrm.clear_table(\"scope_of_work\")\n\t\t\t\t\t\t\t$.each(r.message.master_scope_of_work, function (i, d) {\n\t\t\t\t\t\t\t\tfrm.add_child(\"scope_of_work\", {\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\n\t\t\t\t\t\t\t\t\t'msow_desc': d.msow_desc,\n\t\t\t\t\t\t\t\t\t'total_cost': d.total_cost,\n\t\t\t\t\t\t\t\t\t'total_overheads': d.total_overheads,\n\t\t\t\t\t\t\t\t\t'total_business_promotion': d.total_business_promotion,\n\t\t\t\t\t\t\t\t\t'total_bidding_price': d.total_bidding_price,\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\n\t\t\t\t\t\t\t\t\t'unit': d.unit,\n\t\t\t\t\t\t\t\t\t'unit_price': d.unit_price,\n\t\t\t\t\t\t\t\t\t'unit_price_company_currency': d.unit_price,\n\t\t\t\t\t\t\t\t\t'bidding_price_company_currency': d.total_bidding_price,\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t$.each(r.message.design_calculation, function (i, c) {\n\t\t\t\t\t\t\t\tfrm.add_child('design', {\n\t\t\t\t\t\t\t\t\t'msow': c.msow,\n\t\t\t\t\t\t\t\t\t'ssow': c.ssow,\n\t\t\t\t\t\t\t\t\t'item_group': c.item_group,\n\t\t\t\t\t\t\t\t\t'item': c.item,\n\t\t\t\t\t\t\t\t\t'item_name': c.item_name,\n\t\t\t\t\t\t\t\t\t'description': c.description,\n\t\t\t\t\t\t\t\t\t'unit': c.unit,\n\t\t\t\t\t\t\t\t\t'qty': c.qty,\n\t\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount': c.amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tfrm.refresh_field('design')\n\n\t\t\t\t\t\t\t$.each(r.message.materials, function (i, c) {\n\t\t\t\t\t\t\t\tfrm.add_child('materials', {\n\t\t\t\t\t\t\t\t\t'msow': c.msow,\n\t\t\t\t\t\t\t\t\t'ssow': c.ssow,\n\t\t\t\t\t\t\t\t\t'item_group': c.item_group,\n\t\t\t\t\t\t\t\t\t'item': c.item,\n\t\t\t\t\t\t\t\t\t'item_name': c.item_name,\n\t\t\t\t\t\t\t\t\t'description': c.description,\n\t\t\t\t\t\t\t\t\t'unit': c.unit,\n\t\t\t\t\t\t\t\t\t'qty': c.qty,\n\t\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount': c.amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tfrm.refresh_field('materials')\n\n\t\t\t\t\t\t\t$.each(r.message.mep_materials, function (i, c) {\n\t\t\t\t\t\t\t\tfrm.add_child('materials', {\n\t\t\t\t\t\t\t\t\t'msow': c.msow,\n\t\t\t\t\t\t\t\t\t'ssow': c.ssow,\n\t\t\t\t\t\t\t\t\t'item_group': c.item_group,\n\t\t\t\t\t\t\t\t\t'item': c.item,\n\t\t\t\t\t\t\t\t\t'item_name': c.item_name,\n\t\t\t\t\t\t\t\t\t'description': c.description,\n\t\t\t\t\t\t\t\t\t'unit': c.unit,\n\t\t\t\t\t\t\t\t\t'qty': c.qty,\n\t\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount': c.amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tfrm.refresh_field('materials')\n\n\t\t\t\t\t\t\t$.each(r.message.finishing_work, function (i, c) {\n\t\t\t\t\t\t\t\tfrm.add_child('finishing_work', {\n\t\t\t\t\t\t\t\t\t'msow': c.msow,\n\t\t\t\t\t\t\t\t\t'ssow': c.ssow,\n\t\t\t\t\t\t\t\t\t'item_group': c.item_group,\n\t\t\t\t\t\t\t\t\t'item': c.item,\n\t\t\t\t\t\t\t\t\t'item_name': c.item_name,\n\t\t\t\t\t\t\t\t\t'description': c.description,\n\t\t\t\t\t\t\t\t\t'unit': c.unit,\n\t\t\t\t\t\t\t\t\t'qty': c.qty,\n\t\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount': c.amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tfrm.refresh_field('finishing_work')\n\n\t\t\t\t\t\t\t$.each(r.message.bolts_accessories, function (i, c) {\n\t\t\t\t\t\t\t\tfrm.add_child('accessories', {\n\t\t\t\t\t\t\t\t\t'msow': c.msow,\n\t\t\t\t\t\t\t\t\t'ssow': c.ssow,\n\t\t\t\t\t\t\t\t\t'item_group': c.item_group,\n\t\t\t\t\t\t\t\t\t'item': c.item,\n\t\t\t\t\t\t\t\t\t'item_name': c.item_name,\n\t\t\t\t\t\t\t\t\t'description': c.description,\n\t\t\t\t\t\t\t\t\t'unit': c.unit,\n\t\t\t\t\t\t\t\t\t'qty': c.qty,\n\t\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount': c.amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tfrm.refresh_field('accessories')\n\n\t\t\t\t\t\t\t$.each(r.message.installation, function (i, c) {\n\t\t\t\t\t\t\t\tfrm.add_child('installation', {\n\t\t\t\t\t\t\t\t\t'msow': c.msow,\n\t\t\t\t\t\t\t\t\t'ssow': c.ssow,\n\t\t\t\t\t\t\t\t\t'item_group': c.item_group,\n\t\t\t\t\t\t\t\t\t'item': c.item,\n\t\t\t\t\t\t\t\t\t'item_name': c.item_name,\n\t\t\t\t\t\t\t\t\t'description': c.description,\n\t\t\t\t\t\t\t\t\t'unit': c.unit,\n\t\t\t\t\t\t\t\t\t'qty': c.qty,\n\t\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount': c.amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tfrm.refresh_field('installation')\n\n\t\t\t\t\t\t\t$.each(r.message.manpower, function (i, c) {\n\t\t\t\t\t\t\t\tfrm.add_child('manpower', {\n\t\t\t\t\t\t\t\t\t'msow': c.msow,\n\t\t\t\t\t\t\t\t\t'ssow': c.ssow,\n\t\t\t\t\t\t\t\t\t'worker': c.worker,\n\t\t\t\t\t\t\t\t\t'total_workers': c.total_workers,\n\t\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\n\t\t\t\t\t\t\t\t\t'working_hours': c.working_hours,\n\t\t\t\t\t\t\t\t\t'days': c.days,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount': c.amount_with_overheads\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tfrm.refresh_field('manpower')\n\n\t\t\t\t\t\t\t$.each(r.message.heavy_equipments, function (i, c) {\n\t\t\t\t\t\t\t\tfrm.add_child('heavy_equipments', {\n\t\t\t\t\t\t\t\t\t'msow': c.msow,\n\t\t\t\t\t\t\t\t\t'ssow': c.ssow,\n\t\t\t\t\t\t\t\t\t'item_group': c.item_group,\n\t\t\t\t\t\t\t\t\t'item': c.item,\n\t\t\t\t\t\t\t\t\t'item_name': c.item_name,\n\t\t\t\t\t\t\t\t\t'description': c.description,\n\t\t\t\t\t\t\t\t\t'unit': c.unit,\n\t\t\t\t\t\t\t\t\t'qty': c.qty,\n\t\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount': c.amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tfrm.refresh_field('heavy_equipments')\n\n\t\t\t\t\t\t\t$.each(r.message.manpower_subcontract, function (i, c) {\n\t\t\t\t\t\t\t\tfrm.add_child('others', {\n\t\t\t\t\t\t\t\t\t'msow': c.msow,\n\t\t\t\t\t\t\t\t\t'ssow': c.ssow,\n\t\t\t\t\t\t\t\t\t'item_group': c.item_group,\n\t\t\t\t\t\t\t\t\t'item': c.item,\n\t\t\t\t\t\t\t\t\t'item_name': c.item_name,\n\t\t\t\t\t\t\t\t\t'description': c.description,\n\t\t\t\t\t\t\t\t\t'unit': c.unit,\n\t\t\t\t\t\t\t\t\t'qty': c.qty,\n\t\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount': c.amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tfrm.refresh_field('others')\n\n\t\t\t\t\t\t\tfrm.clear_table(\"items\")\n\t\t\t\t\t\t\tfrm.clear_table(\"quotation_work_title_item\")\n\n\t\t\t\t\t\t\tvar qty = 0\n\t\t\t\t\t\t\tvar amount = 0\n\t\t\t\t\t\t\t$.each(r.message.design_calculation, function (i, d) {\n\t\t\t\t\t\t\t\tqty += d.qty\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\n\t\t\t\t\t\t\t\tvar desc = ''\n\t\t\t\t\t\t\t\tif (d.description) {\n\t\t\t\t\t\t\t\t\tdesc = d.description\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdesc = d.item\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\n\t\t\t\t\t\t\t\t\t'work_title': 'DESIGN',\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\n\t\t\t\t\t\t\t\t\t'description': desc,\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tif (qty > 0) {\n\t\t\t\t\t\t\t\tfrm.add_child(\"quotation_work_title_item\", {\n\t\t\t\t\t\t\t\t\t'item_name': 'DESIGN',\n\t\t\t\t\t\t\t\t\t'quantity': qty,\n\t\t\t\t\t\t\t\t\t'amount': amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('quotation_work_title_item')\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar qty = 0\n\t\t\t\t\t\t\tvar amount = 0\n\t\t\t\t\t\t\t$.each(r.message.materials, function (i, d) {\n\t\t\t\t\t\t\t\tqty += d.qty\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\n\t\t\t\t\t\t\t\tvar desc = ''\n\t\t\t\t\t\t\t\tif (d.description) {\n\t\t\t\t\t\t\t\t\tdesc = d.description\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdesc = d.item\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\n\t\t\t\t\t\t\t\t\t'work_title': 'MATERIALS',\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\n\t\t\t\t\t\t\t\t\t'description': desc,\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\n\t\t\t\t\t\t\t})\n\n\n\t\t\t\t\t\t\tif (qty > 0) {\n\t\t\t\t\t\t\t\tfrm.add_child(\"quotation_work_title_item\", {\n\t\t\t\t\t\t\t\t\t'item_name': 'MATERIALS',\n\t\t\t\t\t\t\t\t\t'quantity': qty,\n\t\t\t\t\t\t\t\t\t'amount': amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('quotation_work_title_item')\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar qty = 0\n\t\t\t\t\t\t\tvar amount = 0\n\t\t\t\t\t\t\t$.each(r.message.finishing_work, function (i, d) {\n\t\t\t\t\t\t\t\tqty += d.qty\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\n\t\t\t\t\t\t\t\tvar desc = ''\n\t\t\t\t\t\t\t\tif (d.description) {\n\t\t\t\t\t\t\t\t\tdesc = d.description\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdesc = d.item\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\n\t\t\t\t\t\t\t\t\t'work_title': 'FINISHING WORK',\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\n\t\t\t\t\t\t\t\t\t'description': desc,\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tif (qty > 0) {\n\t\t\t\t\t\t\t\tfrm.add_child(\"quotation_work_title_item\", {\n\t\t\t\t\t\t\t\t\t'item_name': 'FINISHING WORK',\n\t\t\t\t\t\t\t\t\t'quantity': qty,\n\t\t\t\t\t\t\t\t\t'amount': amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('quotation_work_title_item')\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar qty = 0\n\t\t\t\t\t\t\tvar amount = 0\n\t\t\t\t\t\t\t$.each(r.message.bolts_accessories, function (i, d) {\n\t\t\t\t\t\t\t\tqty += d.qty\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\n\t\t\t\t\t\t\t\tvar desc = ''\n\t\t\t\t\t\t\t\tif (d.description) {\n\t\t\t\t\t\t\t\t\tdesc = d.description\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdesc = d.item\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\n\t\t\t\t\t\t\t\t\t'work_title': 'ACCESSORIES',\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\n\t\t\t\t\t\t\t\t\t'description': desc,\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tif (qty > 0) {\n\t\t\t\t\t\t\t\tfrm.add_child(\"quotation_work_title_item\", {\n\t\t\t\t\t\t\t\t\t'item_name': 'ACCESSORIES',\n\t\t\t\t\t\t\t\t\t'quantity': qty,\n\t\t\t\t\t\t\t\t\t'amount': amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('quotation_work_title_item')\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar qty = 0\n\t\t\t\t\t\t\tvar amount = 0\n\t\t\t\t\t\t\t$.each(r.message.installation, function (i, d) {\n\t\t\t\t\t\t\t\tqty += d.qty\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\n\t\t\t\t\t\t\t\tvar desc = ''\n\t\t\t\t\t\t\t\tif (d.description) {\n\t\t\t\t\t\t\t\t\tdesc = d.description\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdesc = d.item\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\n\t\t\t\t\t\t\t\t\t'work_title': 'INSTALLATION',\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\n\t\t\t\t\t\t\t\t\t'uom': 'Nos',\n\t\t\t\t\t\t\t\t\t'description': desc,\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tif (qty > 0) {\n\t\t\t\t\t\t\t\tfrm.add_child(\"quotation_work_title_item\", {\n\t\t\t\t\t\t\t\t\t'item_name': 'INSTALLATION',\n\t\t\t\t\t\t\t\t\t'quantity': qty,\n\t\t\t\t\t\t\t\t\t'amount': amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('quotation_work_title_item')\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar qty = 0\n\t\t\t\t\t\t\tvar amount = 0\n\t\t\t\t\t\t\t$.each(r.message.manpower, function (i, d) {\n\t\t\t\t\t\t\t\tqty += d.total_workers\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\n\t\t\t\t\t\t\t\tvar desc = ''\n\t\t\t\t\t\t\t\tif (d.description) {\n\t\t\t\t\t\t\t\t\tdesc = d.description\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdesc = d.worker\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\n\t\t\t\t\t\t\t\t\t'item_code': d.worker,\n\t\t\t\t\t\t\t\t\t'item_name': d.worker,\n\t\t\t\t\t\t\t\t\t'work_title': 'MANPOWER',\n\t\t\t\t\t\t\t\t\t'qty': d.total_workers,\n\t\t\t\t\t\t\t\t\t'uom': 'Nos',\n\t\t\t\t\t\t\t\t\t'description': desc,\n\t\t\t\t\t\t\t\t\t'rate': (d.amount_with_overheads / d.total_workers),\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount': d.amount_with_overheads,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tif (qty > 0) {\n\t\t\t\t\t\t\t\tfrm.add_child(\"quotation_work_title_item\", {\n\t\t\t\t\t\t\t\t\t'item_name': 'MANPOWER',\n\t\t\t\t\t\t\t\t\t'quantity': qty,\n\t\t\t\t\t\t\t\t\t'amount': amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('quotation_work_title_item')\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar qty = 0\n\t\t\t\t\t\t\tvar amount = 0\n\t\t\t\t\t\t\t$.each(r.message.heavy_equipments, function (i, d) {\n\t\t\t\t\t\t\t\tqty += d.qty\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\n\t\t\t\t\t\t\t\tvar desc = ''\n\t\t\t\t\t\t\t\tif (d.description) {\n\t\t\t\t\t\t\t\t\tdesc = d.description\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdesc = d.item\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\n\t\t\t\t\t\t\t\t\t'work_title': 'TOOLS/EQUIPMENTS/TRANSPORT/OTHERS',\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\n\t\t\t\t\t\t\t\t\t'description': desc,\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tif (qty > 0) {\n\t\t\t\t\t\t\t\tfrm.add_child(\"quotation_work_title_item\", {\n\t\t\t\t\t\t\t\t\t'item_name': 'TOOLS/EQUIPMENTS/TRANSPORT/OTHERS',\n\t\t\t\t\t\t\t\t\t'quantity': qty,\n\t\t\t\t\t\t\t\t\t'amount': amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('quotation_work_title_item')\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tvar qty = 0\n\t\t\t\t\t\t\tvar amount = 0\n\t\t\t\t\t\t\t$.each(r.message.manpower_subcontract, function (i, d) {\n\t\t\t\t\t\t\t\tqty += d.qty\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\n\t\t\t\t\t\t\t\tvar desc = ''\n\t\t\t\t\t\t\t\tif (d.description) {\n\t\t\t\t\t\t\t\t\tdesc = d.description\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdesc = d.item\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\n\t\t\t\t\t\t\t\t\t'work_title': 'SUBCONTRACT',\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\n\t\t\t\t\t\t\t\t\t'description': desc,\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\n\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\tif (qty > 0) {\n\t\t\t\t\t\t\t\tfrm.add_child(\"quotation_work_title_item\", {\n\t\t\t\t\t\t\t\t\t'item_name': 'SUBCONTRACT',\n\t\t\t\t\t\t\t\t\t'quantity': qty,\n\t\t\t\t\t\t\t\t\t'amount': amount\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tfrm.refresh_field('quotation_work_title_item')\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// if(frappe.user.has_role('HOD')){\n\t\t\t//     frm.add_custom_button(__(\"Show Valuation Rate\"), function () {\n\t\t\t//         frappe.call({\n\t\t\t// \t        method: 'electra.utils.show_valuation_rate',\n\t\t\t// \t        args:{\n\t\t\t// \t            'items' : frm.doc.items,\n\t\t\t// \t            'company': frm.doc.company\n\t\t\t// \t        },\n\t\t\t// \t        callback(d){\n\t\t\t// \t           if (d.message){\n\t\t\t// \t               frappe.msgprint(d.message)\n\t\t\t// \t           }\n\t\t\t// \t       }\n\t\t\t// \t    })\n\t\t\t//     });\n\t\t\t// }\n\n\n\t\t}\n\n\t},\n\tstop_save(frm){\n\t   if(frm.doc.cost_estimation && frm.doc.total_bidding_price < frm.doc.grand_total){\n            frappe.msgprint(\"Total amount cannot be less than the Estimated amount\")\n\t\t\tfrappe.validated = false;\n        } \n\t},\n// \tcalculate(frm){\n//     \tif (frm.doc.docstatus != 1 ) {\n//             frm.add_custom_button(__('Calculate SP'),\n//             function () {\n// \t\t\t\tvar total_additions = frm.doc.total_bidding_price - frm.doc.grand_total\n// \t\t\t\tconsole.log(total_additions)\n// \t\t\t\t// calculating selling price with Overheads distributed to all items\n// \t\t\t\tvar total_spa = 0\n// \t\t\t\t$.each(frm.doc.items, function (i, d) {\n// \t\t\t\t\ttotal_spa += d.amount\n// \t\t\t\t})\n\n// \t\t\t\t// items\n// \t\t\t\tvar dt_name = frm.doc.items\n// \t\t\t\tvar dt_field = \"items\"\n// \t\t\t\tcalculate_selling_price(frm, dt_name, dt_field, total_additions, total_spa)\n\t\t\t\t\n// \t\t\t});\n\t\t\t\t\n    //         function(){\n    //             console.log(\"HI THIS IS\")\n    //             frappe.call({\n    // \t\t\t\tmethod: \"frappe.client.get\",\n    // \t\t\t\targs: {\n    // \t\t\t\t\tdoctype: \"Cost Estimation\",\n    // \t\t\t\t\tfilters: {\n    // \t\t\t\t\t\t\"name\": frm.doc.cost_estimation\n    // \t\t\t\t\t},\n    // \t\t\t\t},\n    // \t\t\tcallback: function (r) {\n    // \t\t\t    if (r.message) {\n    // \t\t\t        console.log(r.message)\n    // \t\t\t    }\n    // \t\t\t}\n    //             })\n    //         });\n    //     }\n    // },\n    \n\tfetch(frm) {\n\t    frappe.call({\n\t\t\tmethod: 'electra.custom.get_stock_balance',\n\t\t\targs: {\n\t\t\t\t'item_table': frm.doc.items\n\t\t\t},\n\t\t\tcallback(d) {\n\t\t\t\tfrm.clear_table('stock_availability')\n\t\t\t\tif (d.message) {\n\t\t\t\t\t$.each(d.message, function (i, v) {\n\t\t\t\t\t\tfrm.add_child('stock_availability', {\n\t\t\t\t\t\t\t'item_code': v[0],\n\t\t\t\t\t\t\t'item_name': v[1],\n\t\t\t\t\t\t\t'warehouse': v[2],\n\t\t\t\t\t\t\t'qty': v[3],\n\t\t\t\t\t\t\t'uom': v[4],\n\t\t\t\t\t\t\t'value': v[5]\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.refresh_field('stock_availability')\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tfrappe.call({\n\t\t\tmethod: 'electra.custom.get_previous_po',\n\t\t\targs: {\n\t\t\t\t'item_table': frm.doc.items\n\t\t\t},\n\t\t\tcallback(d) {\n\t\t\t\tfrm.clear_table('previous_po')\n\t\t\t\tif (d.message) {\n\t\t\t\t\t$.each(d.message, function (i, v) {\n\t\t\t\t\t\tfrm.add_child('previous_po', {\n\t\t\t\t\t\t\t'item_code': v[0],\n\t\t\t\t\t\t\t'item_name': v[1],\n\t\t\t\t\t\t\t'supplier': v[2],\n\t\t\t\t\t\t\t'qty': v[3],\n\t\t\t\t\t\t\t'po_date': v[4],\n\t\t\t\t\t\t\t'amount': v[5],\n\t\t\t\t\t\t\t'purchase_order': v[6]\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.refresh_field('previous_po')\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tfrappe.call({\n\t\t\tmethod: 'electra.custom.get_out_qty',\n\t\t\targs: {\n\t\t\t\t'item_table': frm.doc.items\n\t\t\t},\n\t\t\tcallback(d) {\n\t\t\t\tfrm.clear_table('stock_out_qty')\n\t\t\t\tif (d.message) {\n\t\t\t\t\t$.each(d.message, function (i, v) {\n\t\t\t\t\t\tfrm.add_child('stock_out_qty', {\n\t\t\t\t\t\t\t'item_code': v[0],\n\t\t\t\t\t\t\t'warehouse': v[1],\n\t\t\t\t\t\t\t'qty': v[2],\n\t\t\t\t\t\t\t'date': v[3],\n\t\t\t\t\t\t\t'out_type': v[4]\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.refresh_field('stock_out_qty')\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t\n\t},\n\n\tadditional_discount_percentage(frm) {\n\t\tif (frm.doc.additional_discount_percentage) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'electra.custom.check_discount_percent',\n\t\t\t\targs: {\n\n\t\t\t\t\t'discount': frm.doc.additional_discount_percentage\n\t\t\t\t},\n\t\t\t\tcallback(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tif (r.message != 'invalid') {\n\t\t\t\t\t\t\tfrappe.msgprint(\"Maximum discount percentage allowed for you is \" + String(r.message) + \"%\")\n\t\t\t\t\t\t\tfrm.set_value('additional_discount_percentage', '')\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tfrappe.msgprint(\"You are not authorised to give discount\")\n\t\t\t\t\t\t\tfrm.set_value('additional_discount_percentage', '')\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\tdiscount_amount(frm) {\n\t\tvar percent = (frm.doc.discount_amount * 100) / frm.doc.total\n\t\tif (percent) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'electra.custom.check_discount_percent',\n\t\t\t\targs: {\n\n\t\t\t\t\t'discount': percent\n\t\t\t\t},\n\t\t\t\tcallback(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tif (r.message != 'invalid') {\n\t\t\t\t\t\t\tfrappe.msgprint(\"Maximum discount percentage allowed for you is \" + String(r.message) + \"%\")\n\t\t\t\t\t\t\tfrm.set_value('additional_discount_percentage', '')\n\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tfrappe.msgprint(\"You are not authorised to give discount\")\n\t\t\t\t\t\t\tfrm.set_value('additional_discount_percentage', '')\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\n\t}\n\n})\n// function calculate_selling_price(frm, dt_name, dt_field, total_additions, total_spa) {\n    \n// \t$.each(dt_name, function (i, d) {\n// \t\tvar qty = d.qty\n// \t\tvar sp = d.unit_price\n// \t\tvar spa = d.amount\n// \t\tconsole.log(\"sp\",sp)\n// \t\tconsole.log(\"total_spa\",total_spa)\n// \t\tvar sp_distribution_percent = spa / total_spa\n// \t\tconsole.log('spa',spa)\n// \t\tconsole.log('sp_distribution_percent',sp_distribution_percent)\n// \t\tvar proportionate_overhead = sp_distribution_percent * total_additions\n// \t\tconsole.log('proportionate_overhead',proportionate_overhead)\n// \t\tconsole.log('total_additions',total_additions)\n// \t\tvar spa_with_overhead = spa + proportionate_overhead\n// \t\tconsole.log('spa_with_overhead',spa_with_overhead)\n// \t\tvar sp_with_overhead = spa_with_overhead / qty\n// \t\tconsole.log('sp_with_overhead',sp_with_overhead)\n\n// \t\td.rate = sp_with_overhead.toFixed(2) \n// \t\td.amount = spa_with_overhead.toFixed(2)\n\t\t\n// \t\tconsole.log('d.amount_with_overheads',d.amount)\n// \t\tconsole.log('d.rate_with_overheads',d.rate)\n\t\t\n    \t\n// \t})\n\t\n// \tfrm.refresh_field(dt_field)\n    \n// }\n\t\nfrappe.ui.form.on('Quotation Scope of Work', {\n\tqty: function (frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\trow.unit_price = row.total_bidding_price / row.qty\n\t\tfrm.refresh_field('scope_of_work')\n\t},\n\tunit_price: function (frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\trow.total_bidding_price = row.unit_price * row.qty\n\t\tfrm.refresh_field('scope_of_work')\n\t},\n\ttotal_bidding_price: function (frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\trow.unit_price = row.total_bidding_price / row.qty\n\t\tfrm.refresh_field('scope_of_work')\n\t},\n\tdetails(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn]\n\t\tfrappe.db.get_value('CE SOW', { 'cost_estimation': frm.doc.cost_estimation, 'msow': child.msow, 'ssow': '' }, 'name')\n\t\t\t.then(r => {\n\t\t\t\tif (r.message && Object.entries(r.message).length === 0) {\n\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\t'cost_estimation': frm.doc.name,\n\t\t\t\t\t\t'msow': child.msow,\n\t\t\t\t\t}\n\t\t\t\t\tfrappe.new_doc('CE SOW')\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tfrappe.route_options = {\n\t\t\t\t\t\t'cost_estimation': frm.doc.name,\n\t\t\t\t\t\t'msow': child.msow,\n\t\t\t\t\t}\n\t\t\t\t\tfrappe.set_route('Form', 'CE SOW', r.message.name)\n\t\t\t\t}\n\t\t\t})\n\n\t}\n})\n\nfrappe.ui.form.on('Quotation Item', {\n    \n\titem_code(frm, cdt, cdn) {\n\t    \n\t\tvar child = locals[cdt][cdn]\n\t\t\n\t\tif (child.item_code) {\n\t\t\tchild.delivery_terms = frm.doc.delivery_terms\n\t\t\tfrm.trigger('product_bundle')\n\t\t\tfrm.trigger('fetch')\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'electra.custom.stock_popup',\n\t\t\t\targs: {\n\t\t\t\t\t'item_code': child.item_code\n\t\t\t\t},\n\t\t\t\tcallback(d) {\n\t\t\t\t\tif (d.message) {\n\t\t\t\t\t\tfrm.get_field(\"items_html\").$wrapper.html(d.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\n\n\t\t}\n\n\t},\n\titems_remove(frm) {\n\t\tfrm.trigger('fetch')\n\t},\n\n\tdiscount_percentage(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn]\n\t\tif (child.discount_percentage) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'electra.custom.check_discount_percent',\n\t\t\t\targs: {\n\t\t\t\t\t'user': frappe.session.user,\n\t\t\t\t\t'discount': child.discount_percentage\n\t\t\t\t},\n\t\t\t\tcallback(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\tif (r.message != 'invalid') {\n\t\t\t\t\t\t\tfrappe.msgprint(\"Maximum discount percentage allowed for you is \" + String(r.message) + \"%\")\n\t\t\t\t\t\t\tchild.discount_percentage = ''\n\t\t\t\t\t\t\tfrm.refresh_field('items')\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tfrappe.msgprint(\"You are not authorised to give discount\")\n\t\t\t\t\t\t\tchild.discount_percentage = ''\n\t\t\t\t\t\t\tfrm.refresh_field('items')\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\t\n\t\n\t\n\n\tdownload(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn]\n\t\tvar f_name = child.item_code\n\t\tvar url = frappe.urllib.get_full_url(\n\t\t\t'https://erp.nordencommunication.com/api/method/norden.utils.download_pdf?'\n\t\t\t+ \"doctype=\" + encodeURIComponent(\"Eyenor Datasheet\")\n\t\t\t+ \"&name=\" + encodeURIComponent(f_name)\n\t\t\t+ \"&trigger_print=1&format=Datasheet%202&no_letterhead=0\"\n\t\t)\n\t\t$.ajax({\n\t\t\turl: url,\n\t\t\ttype: 'GET',\n\t\t\tsuccess: function (result) {\n\t\t\t\tif (jQuery.isEmptyObject(result)) {\n\t\t\t\t\tfrappe.msgprint(__('No Records for these settings.'));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\twindow.location = url;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t},\n\t\n\tcommission(frm,cdt,cdn){\n\t    var child = locals[cdt][cdn]\n\t    if (child.item_code){\n\t        var calculate_percent = child.commission\n\t        var amount = calculate_percent / child.rate * 100\n\t        child.commission_amount = amount\n\t      \n\t    }\n\t}\n\n    \n})\n\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Landed Cost Voucher",
  "enabled": 1,
  "modified": "2022-01-03 11:26:05.091007",
  "name": "Landed Cost Voucher-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Landed Cost Voucher', {\n    setup: function(frm) {\n\tfrm.set_query(\"po_reference\", \"taxes\", function(doc, cdt, cdn) {\n\t\tlet d = locals[cdt][cdn];\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t['Purchase Order', 'supplier', '=', d.supplier]\n\t\t\t]\n\t\t};\n\t});\n\t},\n\trefresh(frm) {\n\tif(frm.doc.company){\n\t\tfrm.trigger(\"set_series\")\n\t    }\n\t},\n\tcompany(frm){\n\t    if(frm.doc.company){\n\t    frm.trigger(\"set_series\")\n\t    }\n\t},\n\tset_series(frm){\n\t    frappe.call({\n    \t\tmethod: \"electra.utils.get_series\",\n    \t\targs: {\n    \t\t\tcompany: frm.doc.company,\n    \t\t\tdoctype: frm.doc.doctype\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    frm.set_value('naming_series',r.message)\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Supplier",
  "enabled": 1,
  "modified": "2021-11-11 14:17:44.245932",
  "name": "Supplier-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Supplier', {\n\trefresh(frm) {\n\t\t// your code here\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Day Plan Timesheet",
  "enabled": 1,
  "modified": "2022-08-01 12:21:21.703544",
  "name": "Day Plan Timesheet-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Day Plan Timesheet', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\t\n\t\n\t\n\tday_plan(frm){\n\t    frappe.call({\n    \t\tmethod: \"frappe.client.get\",\n    \t\targs: {\n    \t\t\tdoctype: \"Day Plan\",\n    \t\t\tfilters: {\n    \t\t\t\t\"name\": frm.doc.day_plan\n    \t\t\t},\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r.message.employee) {\n    \t\t\t    $.each(r.message.employee,function(i,d){\n    \t\t\t        frm.add_child('time_log',{\n\t                        'employee':d.employee\n\t                    })\n\t                    frm.refresh_field('time_log')\n    \t\t\t    })\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t}\n})\n\nfrappe.ui.form.on('Day Plan Time Log', {\n\tactivity: function (frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\tfrappe.db.get_value(\"Task\", {\"name\": row.activity}, \"pending_qty\", (r) => {\n\t\trow.qty= r.pending_qty\n\t\tfrm.refresh_field('time_log')\n\t\t});\n\t\t\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2022-11-13 11:52:44.486450",
  "name": "Sales Order-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Order', {\r\n     delivery_date(frm){\r\n\t\t$.each(frm.doc.items,function(i,d){\r\n\t\t\td.delivery_date = frm.doc.delivery_date\r\n\t\t})  \r\n    },\r\n\tbefore_submit: function (frm, dt, dn) {\r\n\t\tif (frm.doc.order_type == 'Project') {\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: \"frappe.client.get_value\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\tdoctype: \"Project Budget\",\r\n\t\t\t\t\tfilters: { \"sales_order\": frm.doc.name },\r\n\t\t\t\t\tfieldname: \"workflow_state\"\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function (r) {\r\n\t\t\t\t\tif (r.message.workflow_state != 'Approved') {\r\n\t\t\t\t\t\tfrappe.msgprint(\"Project Budget has to be Approved to submit Sales Order\");\r\n\t\t\t\t\t\tfrappe.validated = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\tprint: function (frm) {\r\n\t\tfrm.add_custom_button(__(\"Trading\"), function () {\r\n\t\t\tif (frm.doc.parent_company) {\r\n\t\t\t\tvar letter_head = frm.doc.parent_company\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar letter_head = frm.doc.company\r\n\t\t\t}\r\n\t\t\tvar f_name = frm.doc.name\r\n\t\t\tvar print_format = \"Sales Order Test\";\r\n\t\t\twindow.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\r\n\t\t\t\t+ \"doctype=\" + encodeURIComponent(\"Sales Order\")\r\n\t\t\t\t+ \"&name=\" + encodeURIComponent(f_name)\r\n\t\t\t\t+ \"&trigger_print=1\"\r\n\t\t\t\t+ \"&format=\" + print_format\r\n\t\t\t\t+ \"&no_letterhead=0\"\r\n\t\t\t\t+ \"&letterhead=\" + encodeURIComponent(letter_head)\r\n\t\t\t));\r\n\r\n\r\n\t\t}, __(\"Print SO\"));\r\n\r\n\t\tfrm.add_custom_button(__(\"Projects\"), function () {\r\n\t\t\tif (frm.doc.parent_company) {\r\n\t\t\t\tvar letter_head = frm.doc.parent_company\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar letter_head = frm.doc.company\r\n\t\t\t}\r\n\t\t\tvar f_name = frm.doc.name\r\n\t\t\tvar print_format = \"Project Sales Order\";\r\n\t\t\twindow.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\r\n\t\t\t\t+ \"doctype=\" + encodeURIComponent(\"Sales Order\")\r\n\t\t\t\t+ \"&name=\" + encodeURIComponent(f_name)\r\n\t\t\t\t+ \"&trigger_print=1\"\r\n\t\t\t\t+ \"&format=\" + print_format\r\n\t\t\t\t+ \"&no_letterhead=0\"\r\n\t\t\t\t+ \"&letterhead=\" + encodeURIComponent(letter_head)\r\n\t\t\t));\r\n\r\n\r\n\t\t}, __(\"Print SO\"));\r\n\r\n\t},\r\n\r\n\trefresh(frm) {\r\n\t    frm.trigger('print')\r\n\t    frm.add_custom_button(__(\"Stock Details\"), function () {\r\n            var item_details_list = []\r\n            var item_details = {}\r\n            $.each(frm.doc.items, function (i, d) {\r\n                item_details = {}\r\n                item_details['item_code'] = d.item_code\r\n                item_details['item_name'] = d.item_name\r\n                item_details['qty'] = d.qty\r\n                item_details['rate'] = d.rate\r\n                item_details_list.push(item_details)\r\n            })\r\n            frappe.call({\r\n\t\t    \tmethod: \"electra.utils.get_stock_details\",\r\n\t\t\t    args: {\r\n\t\t\t    \t\"company\": frm.doc.company,\r\n\t\t\t\t    \"item_details\": item_details_list\r\n\t\t    \t},\r\n\t\t    \tcallback (r) {\r\n\t\t    \t\tif (r.message) {\r\n\t\t\t            let d = new frappe.ui.Dialog({\r\n                            size:\"extra-large\",\r\n                            title: 'Stock Details',\r\n                            fields: [\r\n                                {\r\n                                    label: 'Stock Details',\r\n                                    fieldname: 'stock_details',\r\n                                    fieldtype: 'HTML'\r\n                                },\r\n                            ],\r\n                                    \r\n                        });\r\n                        d.fields_dict.stock_details.$wrapper.html(r.message);\r\n                        d.show();\t\r\n\t\t    \t\t}\r\n\t\t    \t}\r\n\t\t    });\r\n                \r\n        });\r\n\t    if(!frm.doc.sales_person_user)\r\n\t    {\r\n\t    frm.clear_table(\"sales_team\")\r\n\t    }\r\n\t   // frm.trigger(\"sales_user\")\r\n\t\tvar input = 'input[data-fieldname=\"item_code\"][data-doctype=\"Sales Order Item\"]';\r\n\t\tvar isFocus = false;\r\n\t\tfrm.fields_dict.items.grid.wrapper.on('click', input, function (e) {\r\n\t\t\tif (!isFocus) {\r\n\t\t\t\tconst item_code = e.currentTarget.value;\r\n\t\t\t\tfrappe.call({\r\n\t\t\t\t\tmethod: 'electra.custom.stock_popup',\r\n\t\t\t\t\targs: {\r\n\t\t\t\t\t\t'item_code': item_code\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcallback(d) {\r\n\t\t\t\t\t\tif (d.message) {\r\n\t\t\t\t\t\t\tfrm.get_field(\"items_html\").$wrapper.html(d.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tisFocus = false;\r\n\t\t});\r\n\t\tif (frm.doc.company) {\r\n\t\t\tfrm.trigger(\"set_series\")\r\n\t\t}\r\n\t\tfrm.add_custom_button(__('Project Budget'),\r\n\t\t\tfunction () {\r\n\t\t\t    frappe.db.get_value('Project Budget', { 'cost_estimation': frm.doc.cost_estimation, 'sales_order': frm.doc.name }, 'name')\r\n\t\t\t.then(r => {\r\n\t\t\t\tif (r.message && Object.entries(r.message).length === 0) {\r\n\t\t\t\t\tfrappe.route_options = {\r\n\t\t\t\t\t\t'cost_estimation': frm.doc.cost_estimation,\r\n\t\t\t\t\t\t\"sales_order\": frm.doc.name\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfrappe.set_route('Form', \"Project Budget\",\"new-project-budget-1\")\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tfrappe.route_options = {\r\n\t\t\t\t\t\t'cost_estimation': frm.doc.cost_estimation,\r\n\t\t\t\t\t\t\"sales_order\": frm.doc.name\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfrappe.set_route('Form', 'Project Budget', r.message.name)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t    \r\n\t\t\t}, __('Create'));\r\n\t},\r\n\tcompany(frm) {\r\n\t\tif (frm.doc.company) {\r\n\t\t\tfrm.trigger(\"set_series\")\r\n\t\t}\r\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\r\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\r\n\t\t}\r\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\r\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\r\n\t\t}\r\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\r\n\t\t\tfrm.set_value('letter_head', \"Electra\")\r\n\t\t}\r\n\r\n\t},\r\n\tset_series(frm) {\r\n\t\tfrappe.call({\r\n\t\t\tmethod: \"electra.utils.get_series\",\r\n\t\t\targs: {\r\n\t\t\t\tcompany: frm.doc.company,\r\n\t\t\t\tdoctype: frm.doc.doctype\r\n\t\t\t},\r\n\t\t\tcallback: function (r) {\r\n\t\t\t\tif (r) {\r\n\t\t\t\t\tfrm.set_value('naming_series', r.message)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\tonload_post_render(frm){\r\n\t    if (frm.doc.quotation) {\r\n\t       // frm.set_value('net_total',0)\r\n\t       // frm.refresh_field('net_total')\r\n\t    }\r\n\t},\r\n\tonload(frm) {\r\n\t    if(frm.doc.__islocal){\r\n\t   // frm.trigger(\"sales_user\")\r\n\t   frm.set_value('prepared_by',frappe.session.user)\r\n\t\tif (frm.doc.quotation) {\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: \"electra.utils.make_sales_order\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\t\"name\": frm.doc.quotation\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function (d) {\r\n\t\t\t\t\tif (d.message) {\r\n\t\t\t\t\t\tfrm.set_value('sales_person_user', d.message.converted_by)\r\n\t\t\t\t// \t\tfrm.set_value('prepared_by', d.message.prepared_by)\r\n\t\t\t\t\t\tfrappe.call({\r\n\t\t\t\t\t\t\tmethod: \"electra.utils.get_user_details\",\r\n\t\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\t\t\"user\": d.message.converted_by\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcallback: function (r) {\r\n\t\t\t\t\t\t\t\tif (r.message) {\r\n\t\t\t\t\t\t\t\t\tfrm.set_value(\"sales_person_user\", frm.doc.sales_person_user)\r\n\t\t\t\t\t\t\t\t\tfrm.set_value(\"sales_person_username\", r.message.employee_name)\r\n\t\t\t\t\t\t\t\t\tfrm.set_value(\"sales_person_designation\", r.message.designation)\r\n\t\t\t\t\t\t\t\t\tfrm.set_value(\"sales_person_mobile\", r.message.cell_number)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\r\n\r\n\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t})\r\n\t\t}\r\n\t\t    \r\n\t\t\r\n\t\t// frm.get_field(\"items_html\").$wrapper.html();\r\n\t\tif (frm.doc.order_type == 'Project') {\r\n\t\t    if(frm.doc.__islocal){\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: \"frappe.client.get\",\r\n\t\t\t\targs: {\r\n\t\t\t\t\tdoctype: \"Quotation\",\r\n\t\t\t\t\tfilters: {\r\n\t\t\t\t\t\t\"name\": frm.doc.quotation\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tcallback: function (r) {\r\n\t\t\t\t\tif (r.message) {\r\n\t\t\t\t\t\t// frm.set_value(\"order_type\", \"Project\")\r\n\t\t\t\t// \t\tconsole.log(frm.doc.order_type)\r\n\t\t\t\t\t\tfrm.clear_table(\"scope_of_work\")\r\n\t\t\t\t\t\t$.each(r.message.scope_of_work, function (i, d) {\r\n\t\t\t\t\t\t\tfrm.add_child(\"scope_of_work\", {\r\n\t\t\t\t\t\t\t\t'msow': d.msow,\r\n\t\t\t\t\t\t\t\t'msow_desc': d.msow_desc,\r\n\t\t\t\t\t\t\t\t'total_cost': d.total_cost,\r\n\t\t\t\t\t\t\t\t'total_overheads': d.total_overheads,\r\n\t\t\t\t\t\t\t\t'total_business_promotion': d.total_business_promotion,\r\n\t\t\t\t\t\t\t\t'total_bidding_price': d.total_bidding_price,\r\n\t\t\t\t\t\t\t\t'bidding_price_company_currency': d.bidding_price_company_currency,\r\n\t\t\t\t\t\t\t\t'qty': d.qty,\r\n\t\t\t\t\t\t\t\t'unit': d.unit,\r\n\t\t\t\t\t\t\t\t'unit_price': d.unit_price,\r\n\t\t\t\t\t\t\t\t'unit_price_company_currency': d.unit_price_company_currency\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tfrm.refresh_field('scope_of_work')\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfrm.clear_table(\"design\")\r\n\t\t\t\t\t\t$.each(r.message.design, function (i, c) {\r\n\t\t\t\t\t\t\tfrm.add_child('design', {\r\n\t\t\t\t\t\t\t\t'msow': c.msow,\r\n\t\t\t\t\t\t\t\t'ssow': c.ssow,\r\n\t\t\t\t\t\t\t\t'item_group': c.item_group,\r\n\t\t\t\t\t\t\t\t'item': c.item,\r\n\t\t\t\t\t\t\t\t'item_name': c.item_name,\r\n\t\t\t\t\t\t\t\t'description': c.description,\r\n\t\t\t\t\t\t\t\t'unit': c.unit,\r\n\t\t\t\t\t\t\t\t'qty': c.qty,\r\n\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\r\n\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount': c.amount\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_field('design')\r\n\t\t\t\t\t\tif(frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\"){\r\n\t\t\t\t\t\t    frm.clear_table(\"materials\")\r\n    \t\t\t\t\t\t$.each(r.message.materials, function (i, c) {\r\n    \t\t\t\t\t\t\tfrm.add_child('materials', {\r\n    \t\t\t\t\t\t\t\t'msow': c.msow,\r\n    \t\t\t\t\t\t\t\t'ssow': c.ssow,\r\n    \t\t\t\t\t\t\t\t'item_group': c.item_group,\r\n    \t\t\t\t\t\t\t\t'item': c.item,\r\n    \t\t\t\t\t\t\t\t'item_name': c.item_name,\r\n    \t\t\t\t\t\t\t\t'description': c.description,\r\n    \t\t\t\t\t\t\t\t'unit': c.unit,\r\n    \t\t\t\t\t\t\t\t'qty': c.qty,\r\n    \t\t\t\t\t\t\t\t'unit_price': c.unit_price,\r\n    \t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\r\n    \t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\r\n    \t\t\t\t\t\t\t\t'amount': c.amount\r\n    \t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t    })\r\n\t\t\t\t\t\t    frm.refresh_field('materials')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t    frm.clear_table(\"materials\")\r\n    \t\t\t\t\t\t$.each(r.message.mep_materials, function (i, c) {\r\n    \t\t\t\t\t\t\tfrm.add_child('materials', {\r\n    \t\t\t\t\t\t\t\t'msow': c.msow,\r\n    \t\t\t\t\t\t\t\t'ssow': c.ssow,\r\n    \t\t\t\t\t\t\t\t'item_group': c.item_group,\r\n    \t\t\t\t\t\t\t\t'item': c.item,\r\n    \t\t\t\t\t\t\t\t'item_name': c.item_name,\r\n    \t\t\t\t\t\t\t\t'description': c.description,\r\n    \t\t\t\t\t\t\t\t'unit': c.unit,\r\n    \t\t\t\t\t\t\t\t'qty': c.qty,\r\n    \t\t\t\t\t\t\t\t'unit_price': c.unit_price,\r\n    \t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\r\n    \t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\r\n    \t\t\t\t\t\t\t\t'amount': c.amount\r\n    \t\t\t\t\t\t\t})\r\n    \t\t\t\t\t\t})\r\n    \t\t\t\t\t\tfrm.refresh_field('materials')\r\n\t\t\t\t\t\t}\r\n                        \r\n\r\n                        frm.clear_table(\"finishing_work\")\r\n\t\t\t\t\t\t$.each(r.message.finishing_work, function (i, c) {\r\n\t\t\t\t\t\t\tfrm.add_child('finishing_work', {\r\n\t\t\t\t\t\t\t\t'msow': c.msow,\r\n\t\t\t\t\t\t\t\t'ssow': c.ssow,\r\n\t\t\t\t\t\t\t\t'item_group': c.item_group,\r\n\t\t\t\t\t\t\t\t'item': c.item,\r\n\t\t\t\t\t\t\t\t'item_name': c.item_name,\r\n\t\t\t\t\t\t\t\t'description': c.description,\r\n\t\t\t\t\t\t\t\t'unit': c.unit,\r\n\t\t\t\t\t\t\t\t'qty': c.qty,\r\n\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\r\n\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount': c.amount\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_field('finishing_work')\r\n\t\t\t\t\t\t\r\n                        frm.clear_table(\"accessories\")\r\n\t\t\t\t\t\t$.each(r.message.accessories, function (i, c) {\r\n\t\t\t\t\t\t\tfrm.add_child('accessories', {\r\n\t\t\t\t\t\t\t\t'msow': c.msow,\r\n\t\t\t\t\t\t\t\t'ssow': c.ssow,\r\n\t\t\t\t\t\t\t\t'item_group': c.item_group,\r\n\t\t\t\t\t\t\t\t'item': c.item,\r\n\t\t\t\t\t\t\t\t'item_name': c.item_name,\r\n\t\t\t\t\t\t\t\t'description': c.description,\r\n\t\t\t\t\t\t\t\t'unit': c.unit,\r\n\t\t\t\t\t\t\t\t'qty': c.qty,\r\n\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\r\n\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount': c.amount\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_field('accessories')\r\n\r\n                        frm.clear_table(\"installation\")\r\n\t\t\t\t\t\t$.each(r.message.installation, function (i, c) {\r\n\t\t\t\t\t\t\tfrm.add_child('installation', {\r\n\t\t\t\t\t\t\t\t'msow': c.msow,\r\n\t\t\t\t\t\t\t\t'ssow': c.ssow,\r\n\t\t\t\t\t\t\t\t'item_group': c.item_group,\r\n\t\t\t\t\t\t\t\t'item': c.item,\r\n\t\t\t\t\t\t\t\t'item_name': c.item_name,\r\n\t\t\t\t\t\t\t\t'description': c.description,\r\n\t\t\t\t\t\t\t\t'unit': c.unit,\r\n\t\t\t\t\t\t\t\t'qty': c.qty,\r\n\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\r\n\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount': c.amount\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_field('installation')\r\n\r\n                        frm.clear_table(\"manpower\")\r\n\t\t\t\t\t\t$.each(r.message.manpower, function (i, c) {\r\n\t\t\t\t\t\t\tfrm.add_child('manpower', {\r\n\t\t\t\t\t\t\t\t'msow': c.msow,\r\n\t\t\t\t\t\t\t\t'ssow': c.ssow,\r\n\t\t\t\t\t\t\t\t'worker': c.worker,\r\n\t\t\t\t\t\t\t\t'total_workers': c.total_workers,\r\n\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\r\n\t\t\t\t\t\t\t\t'working_hours': c.working_hours,\r\n\t\t\t\t\t\t\t\t'days': c.days,\r\n\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount': c.amount\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_field('manpower')\r\n\r\n                        frm.clear_table(\"heavy_equipments\")\r\n\t\t\t\t\t\t$.each(r.message.heavy_equipments, function (i, c) {\r\n\t\t\t\t\t\t\tfrm.add_child('heavy_equipments', {\r\n\t\t\t\t\t\t\t\t'msow': c.msow,\r\n\t\t\t\t\t\t\t\t'ssow': c.ssow,\r\n\t\t\t\t\t\t\t\t'item_group': c.item_group,\r\n\t\t\t\t\t\t\t\t'item': c.item,\r\n\t\t\t\t\t\t\t\t'item_name': c.item_name,\r\n\t\t\t\t\t\t\t\t'description': c.description,\r\n\t\t\t\t\t\t\t\t'unit': c.unit,\r\n\t\t\t\t\t\t\t\t'qty': c.qty,\r\n\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\r\n\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount': c.amount\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_field('heavy_equipments')\r\n\r\n                        frm.clear_table(\"others\")\r\n\t\t\t\t\t\t$.each(r.message.others, function (i, c) {\r\n\t\t\t\t\t\t\tfrm.add_child('others', {\r\n\t\t\t\t\t\t\t\t'msow': c.msow,\r\n\t\t\t\t\t\t\t\t'ssow': c.ssow,\r\n\t\t\t\t\t\t\t\t'item_group': c.item_group,\r\n\t\t\t\t\t\t\t\t'item': c.item,\r\n\t\t\t\t\t\t\t\t'item_name': c.item_name,\r\n\t\t\t\t\t\t\t\t'description': c.description,\r\n\t\t\t\t\t\t\t\t'unit': c.unit,\r\n\t\t\t\t\t\t\t\t'qty': c.qty,\r\n\t\t\t\t\t\t\t\t'unit_price': c.unit_price,\r\n\t\t\t\t\t\t\t\t'rate_with_overheads': c.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount_with_overheads': c.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t'amount': c.amount\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_field('others')\r\n\r\n\t\t\t\t\t\tfrm.clear_table(\"items\")\r\n\t\t\t\t\t\tfrm.clear_table(\"so_work_title_item\")\r\n\t\t\t\t\t\tif (r.message) {\r\n\t\t\t\t\t\t\tfrm.set_value(\"selling_price_list\", \"Cost Estimation\")\r\n\t\t\t\t\t\t\tvar qty = 0\r\n\t\t\t\t\t\t\tvar amount = 0\r\n\t\t\t\t\t\t\t$.each(r.message.design, function (i, d) {\r\n\t\t\t\t\t\t\t\tqty += d.qty\r\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\r\n\t\t\t\t\t\t\t\tvar desc = ''\r\n\t\t\t\t\t\t\t\tif (d.description) {\r\n\t\t\t\t\t\t\t\t\tdesc = d.description\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tdesc = d.item\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\r\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\r\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\r\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\r\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\r\n\t\t\t\t\t\t\t\t\t'work_title': 'DESIGN',\r\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\r\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\r\n\t\t\t\t\t\t\t\t\t'description': desc,\r\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tif (qty > 0) {\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"so_work_title_item\", {\r\n\t\t\t\t\t\t\t\t\t'item_name': 'DESIGN',\r\n\t\t\t\t\t\t\t\t\t'quantity': qty,\r\n\t\t\t\t\t\t\t\t\t'amount': amount\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('so_work_title_item')\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar qty = 0\r\n\t\t\t\t\t\t\tvar amount = 0\r\n\t\t\t\t\t\t\t$.each(r.message.materials, function (i, d) {\r\n\t\t\t\t\t\t\t\tqty += d.qty\r\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\r\n\t\t\t\t\t\t\t\tvar desc = ''\r\n\t\t\t\t\t\t\t\tif (d.description) {\r\n\t\t\t\t\t\t\t\t\tdesc = d.description\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tdesc = d.item\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\r\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\r\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\r\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\r\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\r\n\t\t\t\t\t\t\t\t\t'work_title': 'MATERIALS',\r\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\r\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\r\n\t\t\t\t\t\t\t\t\t'description': desc,\r\n\t\t\t\t\t\t\t\t\t// \t\t'rate': d.unit_price,\r\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tif (qty > 0) {\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"so_work_title_item\", {\r\n\t\t\t\t\t\t\t\t\t'item_name': 'MATERIALS',\r\n\t\t\t\t\t\t\t\t\t'quantity': qty,\r\n\t\t\t\t\t\t\t\t\t'amount': amount\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('so_work_title_item')\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar qty = 0\r\n\t\t\t\t\t\t\tvar amount = 0\r\n\t\t\t\t\t\t\t$.each(r.message.finishing_work, function (i, d) {\r\n\t\t\t\t\t\t\t\tqty += d.qty\r\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\r\n\t\t\t\t\t\t\t\tvar desc = ''\r\n\t\t\t\t\t\t\t\tif (d.description) {\r\n\t\t\t\t\t\t\t\t\tdesc = d.description\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tdesc = d.item\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\r\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\r\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\r\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\r\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\r\n\t\t\t\t\t\t\t\t\t'work_title': 'FINISHING WORK',\r\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\r\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\r\n\t\t\t\t\t\t\t\t\t'description': desc,\r\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\tif (qty > 0) {\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"so_work_title_item\", {\r\n\t\t\t\t\t\t\t\t\t'item_name': 'FINISHING WORK',\r\n\t\t\t\t\t\t\t\t\t'quantity': qty,\r\n\t\t\t\t\t\t\t\t\t'amount': amount\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('so_work_title_item')\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar qty = 0\r\n\t\t\t\t\t\t\tvar amount = 0\r\n\t\t\t\t\t\t\t$.each(r.message.accessories, function (i, d) {\r\n\t\t\t\t\t\t\t\tqty += d.qty\r\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\r\n\t\t\t\t\t\t\t\tvar desc = ''\r\n\t\t\t\t\t\t\t\tif (d.description) {\r\n\t\t\t\t\t\t\t\t\tdesc = d.description\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tdesc = d.item\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\r\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\r\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\r\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\r\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\r\n\t\t\t\t\t\t\t\t\t'work_title': 'ACCESSORIES',\r\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\r\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\r\n\t\t\t\t\t\t\t\t\t'description': desc,\r\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\tif (qty > 0) {\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"so_work_title_item\", {\r\n\t\t\t\t\t\t\t\t\t'item_name': 'ACCESSORIES',\r\n\t\t\t\t\t\t\t\t\t'quantity': qty,\r\n\t\t\t\t\t\t\t\t\t'amount': amount\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('so_work_title_item')\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar qty = 0\r\n\t\t\t\t\t\t\tvar amount = 0\r\n\t\t\t\t\t\t\t$.each(r.message.installation, function (i, d) {\r\n\t\t\t\t\t\t\t\tqty += d.qty\r\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\r\n\t\t\t\t\t\t\t\tvar desc = ''\r\n\t\t\t\t\t\t\t\tif (d.description) {\r\n\t\t\t\t\t\t\t\t\tdesc = d.description\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tdesc = d.item\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\r\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\r\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\r\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\r\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\r\n\t\t\t\t\t\t\t\t\t'work_title': 'INSTALLATION',\r\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\r\n\t\t\t\t\t\t\t\t\t'uom': 'Nos',\r\n\t\t\t\t\t\t\t\t\t'description': desc,\r\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\tif (qty > 0) {\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"so_work_title_item\", {\r\n\t\t\t\t\t\t\t\t\t'item_name': 'INSTALLATION',\r\n\t\t\t\t\t\t\t\t\t'quantity': qty,\r\n\t\t\t\t\t\t\t\t\t'amount': amount\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('so_work_title_item')\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar qty = 0\r\n\t\t\t\t\t\t\tvar amount = 0\r\n\t\t\t\t\t\t\t$.each(r.message.manpower, function (i, d) {\r\n\t\t\t\t\t\t\t\tqty += d.total_workers\r\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\r\n\t\t\t\t\t\t\t\tvar desc = ''\r\n\t\t\t\t\t\t\t\tif (d.description) {\r\n\t\t\t\t\t\t\t\t\tdesc = d.description\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tdesc = d.worker\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\r\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\r\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\r\n\t\t\t\t\t\t\t\t\t'item_code': d.worker,\r\n\t\t\t\t\t\t\t\t\t'item_name': d.worker,\r\n\t\t\t\t\t\t\t\t\t'work_title': 'MANPOWER',\r\n\t\t\t\t\t\t\t\t\t'qty': d.total_workers,\r\n\t\t\t\t\t\t\t\t\t'uom': 'Nos',\r\n\t\t\t\t\t\t\t\t\t'description': desc,\r\n\t\t\t\t\t\t\t\t\t'rate': (d.amount_with_overheads / d.total_workers),\r\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\tif (qty > 0) {\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"so_work_title_item\", {\r\n\t\t\t\t\t\t\t\t\t'item_name': 'MANPOWER',\r\n\t\t\t\t\t\t\t\t\t'quantity': qty,\r\n\t\t\t\t\t\t\t\t\t'amount': amount\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('so_work_title_item')\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tvar qty = 0\r\n\t\t\t\t\t\t\tvar amount = 0\r\n\t\t\t\t\t\t\t$.each(r.message.heavy_equipments, function (i, d) {\r\n\t\t\t\t\t\t\t\tqty += d.qty\r\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\r\n\t\t\t\t\t\t\t\tvar desc = ''\r\n\t\t\t\t\t\t\t\tif (d.description) {\r\n\t\t\t\t\t\t\t\t\tdesc = d.description\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tdesc = d.item\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\r\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\r\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\r\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\r\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\r\n\t\t\t\t\t\t\t\t\t'work_title': 'TOOLS/EQUIPMENTS/TRANSPORT/OTHERS',\r\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\r\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\r\n\t\t\t\t\t\t\t\t\t'description': desc,\r\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\tif (qty > 0) {\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"so_work_title_item\", {\r\n\t\t\t\t\t\t\t\t\t'item_name': 'TOOLS/EQUIPMENTS/TRANSPORT/OTHERS',\r\n\t\t\t\t\t\t\t\t\t'quantity': qty,\r\n\t\t\t\t\t\t\t\t\t'amount': amount\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('so_work_title_item')\r\n\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t\tvar qty = 0\r\n\t\t\t\t\t\t\tvar amount = 0\r\n\t\t\t\t\t\t\t$.each(r.message.others, function (i, d) {\r\n\t\t\t\t\t\t\t\tqty += d.qty\r\n\t\t\t\t\t\t\t\tamount += d.amount_with_overheads\r\n\t\t\t\t\t\t\t\tvar desc = ''\r\n\t\t\t\t\t\t\t\tif (d.description) {\r\n\t\t\t\t\t\t\t\t\tdesc = d.description\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tdesc = d.item\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"items\", {\r\n\t\t\t\t\t\t\t\t\t'msow': d.msow,\r\n\t\t\t\t\t\t\t\t\t'ssow': d.ssow,\r\n\t\t\t\t\t\t\t\t\t'item_code': d.item,\r\n\t\t\t\t\t\t\t\t\t'item_name': d.item,\r\n\t\t\t\t\t\t\t\t\t'work_title': 'SUBCONTRACT',\r\n\t\t\t\t\t\t\t\t\t'qty': d.qty,\r\n\t\t\t\t\t\t\t\t\t'uom': d.unit,\r\n\t\t\t\t\t\t\t\t\t'description': desc,\r\n\t\t\t\t\t\t\t\t\t'rate': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'rate_with_overheads': d.rate_with_overheads,\r\n\t\t\t\t\t\t\t\t\t'amount_with_overheads': d.amount_with_overheads,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('items')\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\tif (qty > 0) {\r\n\t\t\t\t\t\t\t\tfrm.add_child(\"so_work_title_item\", {\r\n\t\t\t\t\t\t\t\t\t'item_name': 'SUBCONTRACT',\r\n\t\t\t\t\t\t\t\t\t'quantity': qty,\r\n\t\t\t\t\t\t\t\t\t'amount': amount\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tfrm.refresh_field('so_work_title_item')\r\n\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t    }\r\n\t\t}\r\n\t    }\r\n\t},\r\n\tprepared_by(frm) {\r\n\t\tfrappe.call({\r\n\t\t\tmethod: \"electra.utils.get_user_details\",\r\n\t\t\targs: {\r\n\t\t\t\t\"user\": frm.doc.prepared_by\r\n\t\t\t},\r\n\t\t\tcallback: function (d) {\r\n\t\t\t\tif (d.message) {\r\n\t\t\t\t\t// frm.set_value(\"user_id\",frm.doc.user_id)\r\n\t\t\t\t\tfrm.set_value(\"prepared_by_username\", d.message.employee_name)\r\n\t\t\t\t\tfrm.set_value(\"prepared_by_designation\", d.message.designation)\r\n\t\t\t\t\tfrm.set_value(\"prepared_by__mobile_number\", d.message.cell_number)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tsales_person_user(frm) {\r\n\t\tfrappe.call({\r\n\t\t\tmethod: \"electra.utils.get_user_details\",\r\n\t\t\targs: {\r\n\t\t\t\t\"user\": frm.doc.sales_person_user\r\n\t\t\t},\r\n\t\t\tcallback: function (d) {\r\n\t\t\t\tif (d.message) {\r\n\t\t\t\t\t// frm.set_value(\"user_id\",frm.doc.user_id)\r\n\t\t\t\t// \tconsole.log(d.message)\r\n\t\t\t\t\tfrm.set_value(\"sales_person_username\", d.message.employee_name)\r\n\t\t\t\t\tfrm.set_value(\"sales_person_designation\", d.message.designation)\r\n\t\t\t\t\tfrm.set_value(\"sales_person_mobile\", d.message.cell_number)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\tsetup(frm) {\r\n\t\tfrm.trigger(\"get_credit_limit\")\r\n\t},\r\n\tcustomer(frm) {\r\n\t\tfrm.trigger(\"get_credit_limit\")\r\n\t},\r\n\tget_credit_limit(frm) {\r\n\t\t$(frm.fields_dict.credit_limit.wrapper).empty();\r\n\t\tif (frm.doc.customer) {\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: 'electra.utils.fetch_credit_limit',\r\n\t\t\t\targs: {\r\n\t\t\t\t\t\"company\": frm.doc.company,\r\n\t\t\t\t\t\"customer\": frm.doc.customer\r\n\t\t\t\t},\r\n\t\t\t\tcallback(d) {\r\n\t\t\t\t\tif (d.message) {\r\n\t\t\t\t\t\t$(frm.fields_dict.credit_limit.wrapper).append(d.message);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\tvalidate(frm) {\r\n\t   \r\n\t    if(frm.doc.percent_total>100){\r\n                frappe.throw(__('Percentage Should not exceed 100%'));\r\n                frappe.validated = false;\r\n            }\r\n\t    frm.trigger(\"sales_user\")\r\n\t    \r\n\t\tfrappe.db.get_value('Quotation', frm.doc.quotation, 'cost_estimation')\r\n\t\t\t.then(r => {\r\n\t\t\t\tif (r.message && Object.entries(r.message).length === 0) {\r\n\t\t\t\t\tfrm.set_value(\"cost_estimation\", r.message.cost_estimation)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\r\n\t},\r\n\tsales_user(frm){\r\n\t    if (frm.doc.sales_person_user) {\r\n\t\t\tfrm.clear_table(\"sales_team\")\r\n\t\t\tfrm.add_child('sales_team', {\r\n\t\t\t\t'sales_person': frm.doc.sales_person_username,\r\n\t\t\t\t'allocated_percentage': 100\r\n\t\t\t})\r\n\t\t\tfrm.refresh_field('sales_team')\r\n\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t},\r\n\tadvance_percentage(frm){\r\n\t\t    var adv = ((frm.doc.advance_percentage / 100) * frm.doc.grand_total);\r\n\t\t    frm.set_value(\"advance_value1\",adv)\r\n\t\t   \r\n\t},\r\n\tnormal_advance_percentage(frm){\r\n\t\t    var adv = ((frm.doc.normal_advance_percentage / 100) * frm.doc.grand_total);\r\n\t\t    frm.set_value(\"normal_advance_value1\",adv)\r\n\t\t   \r\n\t},\r\n\tadvance_value1(frm){\r\n\t\t    var ad = ((frm.doc.advance_value1 / frm.doc.grand_total ) * 100 );\r\n\t\t    frm.set_value(\"advance_percentage\",ad)\r\n\t\t   \r\n\t},\r\n\tnormal_advance_value1(frm){\r\n\t\t    var ad = ((frm.doc.normal_advance_value1 / frm.doc.grand_total ) * 100 );\r\n\t\t    frm.set_value(\"normal_advance_percentage\",ad)\r\n\t},\r\n\tretention_percentage(frm){\r\n\t\t    var adv = ((frm.doc.retention_percentage / 100) * frm.doc.grand_total);\r\n\t\t    frm.set_value(\"retention_value\",adv)\r\n\t\t   \r\n\t},\r\n\tretention_value(frm){\r\n\t\t    var rv = ((frm.doc.retention_value / frm.doc.grand_total ) * 100 );\r\n\t\t    frm.set_value(\"retention_percentage\",rv)\r\n\t\t   \r\n\t},\r\n\twarehouse(frm){\r\n\t     if(frm.doc.order_type == \"Project\" || frm.doc.order_type == \"Sales\"){\r\n\t        frappe.call({\r\n    \t        method: 'electra.custom.get_default_warehouse',\r\n    \t        args:{\r\n    \t            'company':frm.doc.company\r\n    \t        },\r\n    \t        callback(d) {\r\n    \t            if(d.message){\r\n\t                   // console.log(\"HIIIIIIIIIIIIIII\")\r\n    \t                var whouse = d.message\r\n    \t               // console.log(whouse)\r\n    \t                $.each(frm.doc.items, function (i, d) {\r\n\t\t\t\t\t\t\td.warehouse = whouse\r\n    \t                })\r\n    \t            }\r\n    \t        }\r\n    \t    })\r\n\t    }\r\n\t},\r\n\tpo_no(frm){\r\n\t    frm.trigger(\"warehouse\")\r\n\t},\r\n\tfetch(frm) {\r\n\t\tfrappe.call({\r\n\t\t\tmethod: 'electra.custom.get_stock_balance',\r\n\t\t\targs: {\r\n\t\t\t\t'item_table': frm.doc.items\r\n\t\t\t},\r\n\t\t\tcallback(d) {\r\n\t\t\t\tfrm.clear_table('stock_availability')\r\n\t\t\t\tif (d.message) {\r\n\t\t\t\t\t$.each(d.message, function (i, v) {\r\n\t\t\t\t\t\tfrm.add_child('stock_availability', {\r\n\t\t\t\t\t\t\t'item_code': v[0],\r\n\t\t\t\t\t\t\t'item_name': v[1],\r\n\t\t\t\t\t\t\t'warehouse': v[2],\r\n\t\t\t\t\t\t\t'qty': v[3],\r\n\t\t\t\t\t\t\t'uom': v[4],\r\n\t\t\t\t\t\t\t'value': v[5]\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_field('stock_availability')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tfrappe.call({\r\n\t\t\tmethod: 'electra.custom.get_previous_po',\r\n\t\t\targs: {\r\n\t\t\t\t'item_table': frm.doc.items\r\n\t\t\t},\r\n\t\t\tcallback(d) {\r\n\t\t\t\tfrm.clear_table('previous_po')\r\n\t\t\t\tif (d.message) {\r\n\t\t\t\t\t$.each(d.message, function (i, v) {\r\n\t\t\t\t\t\tfrm.add_child('previous_po', {\r\n\t\t\t\t\t\t\t'item_code': v[0],\r\n\t\t\t\t\t\t\t'item_name': v[1],\r\n\t\t\t\t\t\t\t'supplier': v[2],\r\n\t\t\t\t\t\t\t'qty': v[3],\r\n\t\t\t\t\t\t\t'po_date': v[4],\r\n\t\t\t\t\t\t\t'amount': v[5],\r\n\t\t\t\t\t\t\t'purchase_order': v[6]\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_field('previous_po')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tfrappe.call({\r\n\t\t\tmethod: 'electra.custom.get_out_qty',\r\n\t\t\targs: {\r\n\t\t\t\t'item_table': frm.doc.items\r\n\t\t\t},\r\n\t\t\tcallback(d) {\r\n\t\t\t\tfrm.clear_table('stock_out_qty')\r\n\t\t\t\tif (d.message) {\r\n\t\t\t\t\t$.each(d.message, function (i, v) {\r\n\t\t\t\t\t\tfrm.add_child('stock_out_qty', {\r\n\t\t\t\t\t\t\t'item_code': v[0],\r\n\t\t\t\t\t\t\t'warehouse': v[1],\r\n\t\t\t\t\t\t\t'qty': v[2],\r\n\t\t\t\t\t\t\t'date': v[3],\r\n\t\t\t\t\t\t\t'out_type': v[4]\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tfrm.refresh_field('stock_out_qty')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t},\r\n\r\n\r\n})\r\nfrappe.ui.form.on('SO Scope of Work', {\r\n    qty: function (frm, cdt, cdn) {\r\n\t\tvar row = locals[cdt][cdn];\r\n\t\trow.total_bidding_price = row.qty * row.unit_price\r\n\t\tfrm.refresh_field('scope_of_work')\r\n\t},\r\n\tunit_price: function (frm, cdt, cdn) {\r\n\t\tvar row = locals[cdt][cdn];\r\n\t\trow.total_bidding_price = row.qty * row.unit_price\r\n\t\tfrm.refresh_field('scope_of_work')\r\n\t},\r\n\ttotal_bidding_price: function (frm, cdt, cdn) {\r\n\t\tvar row = locals[cdt][cdn];\r\n\t\trow.unit_price = row.total_bidding_price / row.qty\r\n\t\tfrm.refresh_field('scope_of_work')\r\n\t},\r\n    \r\n})\r\nfrappe.ui.form.on('Sales Order Item', {\r\n\titem_code(frm, cdt, cdn) {\r\n\t\tvar child = locals[cdt][cdn]\r\n\t\tif (child.item_code) {\r\n\t\t\tfrm.trigger('fetch')\r\n\t\t\tfrappe.call({\r\n\t\t\t\tmethod: 'electra.custom.stock_popup',\r\n\t\t\t\targs: {\r\n\t\t\t\t\t'item_code': child.item_code\r\n\t\t\t\t},\r\n\t\t\t\tcallback(d) {\r\n\t\t\t\t\tif (d.message) {\r\n\t\t\t\t\t\tfrm.get_field(\"items_html\").$wrapper.html(d.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t}\r\n\t},\r\n\titems_remove(frm) {\r\n\t\tfrm.trigger('fetch')\r\n\t},\r\n})\r\n\r\nfrappe.ui.form.on('Payment Schedule Sales Order', {\r\n    value(frm,cdt,cdn){\r\n        child.value=frm.doc.grand_total\r\n\r\n    },\r\n    percentage(frm,cdt,cdn){\r\n        var child = locals[cdt][cdn]\r\n        var percent = 0 \r\n        if(child.percentage){\r\n            percent=frm.doc.grand_total*child.percentage/100\r\n            child.value=percent\r\n        }\r\n    \r\n        var percent = 0\r\n            $.each(frm.doc.payment_schedule_2s,function(i,d){\r\n            if(d.percentage){\r\n            percent += d.percentage\r\n            frm.set_value(\"percent_total\",percent)\r\n            \r\n            }\r\n        })\r\n    }\r\n    \r\n    \r\n})\r\n\r\n\r\n\r\n \r\n\r\n\r\n\r\n\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Master Record",
  "enabled": 1,
  "modified": "2021-12-10 12:34:35.442376",
  "name": "Employee Master Record-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Employee Master Record', {\n\trefresh(frm) {\n\t\tfrm.disable_save();\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Receipt",
  "enabled": 1,
  "modified": "2022-06-19 08:58:54.849395",
  "name": "Purchase Receipt-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Purchase Receipt', {\n\trefresh(frm) {\n\t    if(frm.doc.company){\n\t\tfrm.trigger(\"set_series\")\n\t    }\n// \t    if(frappe.user.has_role(\"Store Manager\"))\n// \t    {\n// \t\tfrm.set_df_property('supplier', 'read_only', 1);\n// \t    }\n\t   // var df1 = frappe.meta.get_docfield(\"Purchase Receipt Item\",\"items\");\n\t   // df1.read_only = 1\n\t    \n// \t \tvar df = frappe.meta.get_docfield(\"Purchase Receipt Item\",\"item_name\", cur_frm.doc.name);\n// \t \tconsole.log(df.read_only)\n//     df.hidden = 1;\n//         \tconsole.log(df.read_only)\n//         \tfrm.refresh_fields()\n\t},\n\tcompany(frm){\n\t    if(frm.doc.company){\n\t    frm.trigger(\"set_series\")\n\t    }\n\t},\n\tset_series(frm){\n\t    frappe.call({\n    \t\tmethod: \"electra.utils.get_series\",\n    \t\targs: {\n    \t\t\tcompany: frm.doc.company,\n    \t\t\tdoctype: frm.doc.doctype\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    frm.set_value('naming_series',r.message)\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t},\n\tsetup(frm){\n\t    if(frappe.user.has_role(\"Store Manager\")){\n\t    var df = frappe.meta.get_docfield(\"Purchase Receipt Item\",\"rate\",frm.doc.name);\n\t    df.hidden = 1\n\t    var df = frappe.meta.get_docfield(\"Purchase Receipt Item\",\"amount\",frm.doc.name);\n\t    df.hidden = 1\n\t   // df.in_list_view = 0\n\t    }\n\t}\n})\n\n// frappe.ui.form.on(\"Purchase Receipt Item\", \"items_on_form_rendered\", function(doc,grid_row) {\n// \tconsole.log(doc)\n// })\n// cur_frm.get_field(\"items\").grid.docfields[1].read_only = 1\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2021-12-16 13:16:20.983405",
  "name": "Item-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Item', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\t\n\tbrand(frm){\n\t    if(frm.doc.brand){\n\t         frm.set_value('quality_inspection_template',frm.doc.brand)\n\t    }\n\t    \n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Exit Checklist",
  "enabled": 1,
  "modified": "2021-12-17 17:36:21.721676",
  "name": "Exit Checklist-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Exit Checklist', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\t\n\t onload(frm){\n\t     if(!frappe.user.has_role(\"PRO\")){\n\t     hide_field(['exit_confirmation_section'])\n\t     }\n        \n    },\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "BOM",
  "enabled": 1,
  "modified": "2021-12-22 09:34:56.113140",
  "name": "BOM-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('BOM', {\n\trefresh(frm) {\n\t\t// your code here\n\t}\n}),\n\nfrappe.ui.form.on('BOM Item', {\n\trefresh(frm) {\n\t\t\n\t},\n\t\n\titem_code(frm,cdt,cdn) {\n\t    var child = locals[cdt][cdn]\n\t    if(child.item_code){\n\t  frm.trigger('fetch')\n\t  frappe.call({\n\t        method: 'electra.custom.stock_popup',\n\t        args:{\n\t            'item':child.item_code\n\t        },\n\t        callback(d){\n\t           if (d.message){\n\t               frappe.msgprint(d.message)\n\t           }\n\t       }\n\t    })\n\t        \n\t    }\n\t    \n\t}\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2022-10-31 08:53:49.986770",
  "name": "Sales Invoice-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Sales Invoice', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Stock Details\"), function () {\n            var item_details_list = []\n            var item_details = {}\n            $.each(frm.doc.items, function (i, d) {\n                item_details = {}\n                item_details['item_code'] = d.item_code\n                item_details['item_name'] = d.item_name\n                item_details['qty'] = d.qty\n                item_details['rate'] = d.rate\n                item_details_list.push(item_details)\n            })\n            frappe.call({\n\t\t    \tmethod: \"electra.utils.get_stock_details\",\n\t\t\t    args: {\n\t\t\t    \t\"company\": frm.doc.company,\n\t\t\t\t    \"item_details\": item_details_list\n\t\t    \t},\n\t\t    \tcallback (r) {\n\t\t    \t\tif (r.message) {\n\t\t\t            let d = new frappe.ui.Dialog({\n                            size:\"extra-large\",\n                            title: 'Stock Details',\n                            fields: [\n                                {\n                                    label: 'Stock Details',\n                                    fieldname: 'stock_details',\n                                    fieldtype: 'HTML'\n                                },\n                            ],\n                                    \n                        });\n                        d.fields_dict.stock_details.$wrapper.html(r.message);\n                        d.show();\t\n\t\t    \t\t}\n\t\t    \t}\n\t\t    });\n                \n        });\n\t    \n\t    \n\t   // frm.add_custom_button(__(\"Invoice Summary\"), function () {\n    //         // var item_details_list = []\n    //         // var item_details = {}\n    //         // $.each(frm.doc.items, function (i, d) {\n    //         //     item_details = {}\n    //         //     item_details['item_code'] = d.item_code\n    //         //     item_details['item_name'] = d.item_name\n    //         //     item_details['qty'] = d.qty\n    //         //     item_details['rate'] = d.rate\n    //         //     item_details_list.push(item_details)\n    //         // })\n    //         frappe.call({\n    // \t    \tmethod: \"electra.utils.get_invoice_summary\",\n    // \t\t    args: {\n    // \t\t\t    doctype: \"Sales Invoice\",\n    // \t\t\t    filters: {\n    // \t\t\t\t    \"project\": frm.doc.project\n    // \t\t\t},\n\t\t\t\t\n    // \t\t},\n    \t\t\n\t\t  //  \tcallback (r) {\n\t\t  //  \t\tif (r.message) {\n\t\t\t //           let d = new frappe.ui.Dialog({\n    //                         // size:\"extra-large\",\n    //                         title: 'Invoice Summary',\n    //                         fields: [\n    //                             {\n    //                                 label: 'Invoice Summary',\n    //                                 fieldname: 'invoice_summary',\n    //                                 fieldtype: 'HTML'\n    //                             },\n    //                         ],\n                                    \n    //                     });\n    //                     d.fields_dict.invoice_summary.$wrapper.html(r.message);\n    //                     d.show();\t\n\t\t  //  \t\t}\n\t\t  //  \t}\n\t\t  //  });\n                \n    //     });\n\t    if(frm.doc.company){\n\t    \tfrappe.call({\n    \t    \tmethod: \"frappe.client.get\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Company\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"name\": frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tfields: [\"cost_center\"]\n\t\t\t\t},\n\t\t\t\tcallback(r){\n\t\t\t\t    frm.set_value(\"cost_center\",r.message.cost_center)\n\t\t\t\t    \n\t\t\t\t    \n\t\t\t\t}\n    \t})\n\t    }\n\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t    \n\t\tif(frm.doc.company){\n\t\tfrm.trigger(\"set_series\")\n\t\tfrm.trigger(\"set_cost_center\")\n\t\tfrm.trigger(\"set_debit_to\")\n// \t\n\t    }\n\t},\n\t\n\t\n\t\n\t\tprepared_by(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: \"electra.utils.get_user_details\",\n\t\t\targs: {\n\t\t\t\t\"user\": frm.doc.prepared_by\n\t\t\t},\n\t\t\tcallback: function (d) {\n\t\t\t\tif (d.message) {\n\t\t\t\t\t// frm.set_value(\"user_id\",frm.doc.user_id)\n\t\t\t\t\tfrm.set_value(\"prepared_by_username\", d.message.employee_name)\n\t\t\t\t\tfrm.set_value(\"prepared_by_designation\", d.message.designation)\n\t\t\t\t\tfrm.set_value(\"prepared_by__mobile_number\", d.message.cell_number)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tsales_person_user(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: \"electra.utils.get_user_details\",\n\t\t\targs: {\n\t\t\t\t\"user\": frm.doc.sales_person_user\n\t\t\t},\n\t\t\tcallback: function (d) {\n\t\t\t\tif (d.message) {\n\t\t\t\t\t// frm.set_value(\"user_id\",frm.doc.user_id)\n\t\t\t\t\tfrm.set_value(\"sales_person_username\", d.message.employee_name)\n\t\t\t\t\tfrm.set_value(\"sales_person_designation\", d.message.designation)\n\t\t\t\t\tfrm.set_value(\"sales_person_mobile\", d.message.cell_number)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tvalidate(frm){\n\t    frm.trigger(\"calculate_payment_terms\")\n\t    frm.trigger(\"set_debit_to\")\n\t    frm.trigger(\"set_income_account\")\n\t    if(frm.doc.discount_amount && !frm.doc.is_return){\n\t    var discount_percent = (frm.doc.discount_amount / frm.doc.total) * 100\n\t    frm.set_value(\"additional_discount_percentage\",discount_percent)\n\t    }\n\t},\n\tafter_save(frm){\n\t    frappe.call({\n\t        method : \"frappe.client.get_list\",\n\t        args :{\n\t            doctype:'Sales Order',\n\t            filters : {\n\t                \"name\": frm.doc.sales_order,\n\t                \"docstatus\": 1\n\t            },\n\t            fields:['advance_percentage','retention_percentage']\n\t        },\n\t        callback:function(r){\n\t            if(r.message){\n\t                $.each(r.message,function(i,d){\n\t                    var adv_amount = (d.advance_percentage / 100) * frm.doc.net_total\n\t                    var ret_amount = (d.retention_percentage / 100) * frm.doc.net_total\n\t                    var net_total_project = frm.doc.net_total - (adv_amount + ret_amount)\n\t                    frm.set_value(\"net_total_project\",net_total_project)\n\t                })\n\t           \n\t            }\n\t        }\n\t    })\n\t    \n\t},\n\tset_cost_center(frm){\n\t  frappe.db.get_value(\"Company\", {\"name\": frm.doc.company}, \"cost_center\", (r) => {\n\t\t\t $.each(frm.doc.items,function(i,d){\n\t\t\t     d.cost_center = r.cost_center;\n\t\t\t })\n\t\t\t frm.refresh_field(\"items\")\n\t\t});\n\t},\n\tset_income_account(frm){\n\t  frappe.db.get_value(\"Company\", {\"name\": frm.doc.company}, \"default_income_account\", (r) => {\n\t\t\t $.each(frm.doc.items,function(i,d){\n\t\t\t     d.income_account = r.default_income_account;\n\t\t\t })\n\t\t\t frm.refresh_field(\"items\")\n\t\t});\n\t},\n\tset_debit_to(frm){\n\t  frappe.db.get_value(\"Company\", {\"name\": frm.doc.company}, \"default_receivable_account\", (r) => {\n\t      frm.set_value(\"debit_to\",r.default_receivable_account)\n\t\t\t\n\t\t});\n\t},\n\tget_dn_list(frm){\n\t    if(frm.doc.sales_order){\n\t     frappe.call({\n\t        method : \"frappe.client.get_list\",\n\t        args :{\n\t            doctype:'Delivery Note',\n\t            filters : {\n\t                \"sales_order\": frm.doc.sales_order,\n\t                \"docstatus\": 1\n\t            }\n\t        },\n\t        callback:function(r){\n\t            if(r.message && Object.entries(r.message).length > 0){\n\t                var dn_list = []\n\t                $.each(r.message,function(i,d){\n\t                    dn_list.push(d.name)\n\t                   // dn_list.join('\\n')\n\t                    \n\t                   \n\t                })\n\t               frm.set_value(\"delivery_note_list\",dn_list.toString())\n\t           \n\t            }\n\t        }\n\t    })\n\t    }\n\t},\n\tget_ordered_qty(frm){\n\t    let qty_list = []\n\t    frappe.db.get_list('Sales Order Item', {\n            fields: ['*'],\n            filters: {\n                parent: frm.doc.sales_order\n            },\n            order_by: \"idx\",\n        }).then(records => {\n            $.each(records,function(i,d){\n                 $.each(frm.doc.items,function(j,v){\n\t            if(d.item_code == v.item_code){\n\t                v.ordered_qty = d.qty\n\t            }\n\t            frm.refresh_field('items')\n        })\n\t    \n            });\n        })\n        \n\t    \n\t   \n\n\t    \n\n\t    \n\t   \n\t},\n\tcalculate_payment_terms(frm){\n\t    frappe.db.get_list('Payment Schedule Sales Order', {\n            fields: ['*'],\n            filters: {\n                parent: frm.doc.sales_order\n            },\n            order_by: \"idx\",\n        }).then(records => {\n            var psi = Object.entries(frm.doc.previous_sales_invoice).length\n          \n            $.each(records,function(i,d){\n                var index = psi+1;\n                if(d.idx == index){\n                    console.log(d.percentage)\n                    $.each(frm.doc.items,function(j,v){\n                        v.qty = (d.percentage / 100) * v.ordered_qty\n                    })\n                    frm.refresh_field(\"items\")\n               \n                }\n            });\n        })\n\n\t    \n\t},\n\t\n\tonload(frm){\n\t    \n\t    \n\t    \n\t    \n\t    frm.trigger(\"get_ordered_qty\")\n\t    frm.trigger(\"get_previous_si\")\n\t    \n\t    frm.trigger(\"get_dn_list\")\n\t   // frappe.call({\n\t   //     method:\"electra.utils.make_si\",\n\t   //     args:{\n\t   //         name:frm.doc.name\n\t   //     },\n\t   //     callback:function(d){\n\t   //         if(d.message){\n\t   //             frm.set_value('delivery_note',d.message.name)\n\t   //             frm.set_value('sales_order',d.message.sales_order)\n\t   //         }\n\t   //     }\n\t   // })\n\t   \n\t     frm.add_custom_button(__(\"Sales Invoice\"), function () {\n                if(frm.doc.parent_company){\n                    var letter_head = frm.doc.parent_company\n                }\n                else{\n                    var letter_head = frm.doc.company\n                } \n                var f_name = frm.doc.name\n                var print_format =\"Sales Invoice Test\";\n                 window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                    + \"doctype=\" + encodeURIComponent(\"Sales Invoice\")\n                    + \"&name=\" + encodeURIComponent(f_name)\n                    + \"&trigger_print=1\"\n                    + \"&format=\" + print_format\n                    + \"&no_letterhead=0\"\n                    + \"&letterhead=\" + encodeURIComponent(letter_head) \n                   ));\n            \n\n            },__(\"Print Sales Invoice for\"));\n            if(frm.doc.status == \"Return\"){\n            frm.add_custom_button(__(\"Sales Invoice Return\"), function () {\n                        if(frm.doc.parent_company){\n                            var letter_head = frm.doc.parent_company\n                        }\n                        else{\n                            var letter_head = frm.doc.company\n                        } \n                        var f_name = frm.doc.name\n                        var print_format =\"Sales Invoice Return Test\";\n                         window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                            + \"doctype=\" + encodeURIComponent(\"Sales Invoice\")\n                            + \"&name=\" + encodeURIComponent(f_name)\n                            + \"&trigger_print=1\"\n                            + \"&format=\" + print_format\n                            + \"&no_letterhead=0\"\n                            + \"&letterhead=\" + encodeURIComponent(letter_head) \n                           ));\n                    \n        \n                    },__(\"Print Sales Invoice for\"));\n                \n        \t}\n\t    },\n\t\n    \t\n\t  \n\t\n\tget_previous_si(frm){\n\t    if(frm.doc.docstatus != 1){\n    \t    if(frm.doc.sales_order){\n    \t    frappe.call({\n        \t\tmethod: \"frappe.client.get_list\",\n        \t\targs: {\n        \t\t\tdoctype: \"Sales Invoice\",\n        \t\t\tfilters: {\n        \t\t\t\t\"sales_order\": frm.doc.sales_order\n        \t\t\t},\n    \t\t\t\tfields:['name','outstanding_amount','posting_date','grand_total']\n        \t\t},\n    \t\t\tcallback(r){\n    \t            if(r.message){\n    \t\t\t\t\t$.each(r.message,function(i,v){\n    \t\t\t\t\t\tfrm.add_child('previous_sales_invoice',{\n    \t                        'invoice_no':v.name,\n    \t                        'outstanding':v.outstanding_amount,\n    \t                        'invoice_date':v.posting_date,\n    \t                        'value':v.grand_total,\n    \t                        'collected_amount':(v.grand_total)-(v.outstanding_amount)\n    \t                    })\n    \t\t\t\t\t\tfrm.refresh_field('previous_sales_invoice')\n    \t\t\t\t\t})\n    \t\t\t\t}\n    \t\t\t\tif(frm.doc.previous_sales_invoice){\n    \t        var total = 0\n                $.each(frm.doc.previous_sales_invoice,function(i,d){\n                if(d.value){\n                total += d.value\n                }\n                frm.set_value('total_value',total)\n            })\n    \t   var total = 0\n                $.each(frm.doc.previous_sales_invoice,function(i,d){\n                if(d.outstanding){\n                total += d.outstanding\n                }\n                frm.set_value('total_outstanding',total)\n            })\n    \t    var total = 0\n                $.each(frm.doc.previous_sales_invoice,function(i,d){\n                if(d.collected_amount){\n                total += d.collected_amount\n                }\n                frm.set_value('total_collected_amount',total)\n            })    \n    \t    }\n    \t\t\t\t\n    \n    \t\t\t\t\n    \t\t\t}\n    \t\t})\n    \t    }\n\t    }\n\t},\n\t\n\tcompany(frm){\n\t    if(frm.doc.company){\n\t        \n\t    frm.trigger(\"set_series\")\n\t    frm.trigger(\"set_cost_center\")\n\t    frm.trigger(\"set_debit_to\")\n\t    }\n\t\tif (frm.doc.company) {\n\t\t\tfrm.trigger(\"set_series\")\n\t\t}\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\n\t},\n\tset_series(frm){\n\t    frappe.call({\n    \t\tmethod: \"electra.utils.get_series\",\n    \t\targs: {\n    \t\t\tcompany: frm.doc.company,\n    \t\t\tdoctype: frm.doc.doctype\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    if(frm.doc.is_return){\n    \t\t\t        var new_series = r.message\n    \t\t\t        frm.set_value('naming_series',new_series.replace(\"SI\", \"SR\"))\n    \t\t\t    }\n    \t\t\t    else{\n    \t\t\t    frm.set_value('naming_series',r.message)\n    \t\t\t    }\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t},\n\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Delivery Note",
  "enabled": 1,
  "modified": "2022-09-05 15:21:43.879420",
  "name": "Delivery Note-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Delivery Note', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Stock Details\"), function () {\n            var item_details_list = []\n            var item_details = {}\n            $.each(frm.doc.items, function (i, d) {\n                item_details = {}\n                item_details['item_code'] = d.item_code\n                item_details['item_name'] = d.item_name\n                item_details['qty'] = d.qty\n                item_details['rate'] = d.rate\n                item_details_list.push(item_details)\n            })\n            frappe.call({\n\t\t    \tmethod: \"electra.utils.get_stock_details\",\n\t\t\t    args: {\n\t\t\t    \t\"company\": frm.doc.company,\n\t\t\t\t    \"item_details\": item_details_list\n\t\t    \t},\n\t\t    \tcallback (r) {\n\t\t    \t\tif (r.message) {\n\t\t    \t\t    console.log(r.message)\n\t\t\t            let d = new frappe.ui.Dialog({\n                            size:\"extra-large\",\n                            title: 'Stock Details',\n                            fields: [\n                                {\n                                    label: 'Stock Details',\n                                    fieldname: 'stock_details',\n                                    fieldtype: 'HTML'\n                                },\n                            ],\n                                    \n                        });\n                        d.fields_dict.stock_details.$wrapper.html(r.message);\n                        d.show();\t\n\t\t    \t\t}\n\t\t    \t}\n\t\t    });\n                \n        });\n\t    if(frm.doc.company){\n\t\tfrm.trigger(\"set_series\")\n\t    }\n\t    \n\t    frm.add_custom_button(__(\"DN without amount\"), function () {\n                if(frm.doc.parent_company){\n                    var letter_head = frm.doc.parent_company\n                }\n                else{\n                    var letter_head = frm.doc.company\n                } \n                var f_name = frm.doc.name\n                var print_format =\"Delivery Note  W/O Test\";\n                 window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                    + \"doctype=\" + encodeURIComponent(\"Delivery Note\")\n                    + \"&name=\" + encodeURIComponent(f_name)\n                    + \"&trigger_print=1\"\n                    + \"&format=\" + print_format\n                    + \"&no_letterhead=0\"\n                    + \"&letterhead=\" + encodeURIComponent(letter_head) \n                   ));\n            \n\n            },__(\"Print Delivery Note\"));\n        frm.add_custom_button(__(\"DN with amount\"), function () {\n                    if(frm.doc.parent_company){\n                        var letter_head = frm.doc.parent_company\n                    }\n                    else{\n                        var letter_head = frm.doc.company\n                    } \n                    var f_name = frm.doc.name\n                    var print_format =\"Delivery Note Test\";\n                     window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                        + \"doctype=\" + encodeURIComponent(\"Delivery Note\")\n                        + \"&name=\" + encodeURIComponent(f_name)\n                        + \"&trigger_print=1\"\n                        + \"&format=\" + print_format\n                        + \"&no_letterhead=0\"\n                        + \"&letterhead=\" + encodeURIComponent(letter_head) \n                       ));\n                \n    \n                },__(\"Print Delivery Note\"));\n                if(frm.doc.is_return == 1){\n              frm.add_custom_button(__(\"DN Return without amount\"), function () {\n                if(frm.doc.parent_company){\n                    var letter_head = frm.doc.parent_company\n                }\n                else{\n                    var letter_head = frm.doc.company\n                } \n                var f_name = frm.doc.name\n                var print_format =\"Delivery Note Return W/O Test\";\n                 window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                    + \"doctype=\" + encodeURIComponent(\"Delivery Note\")\n                    + \"&name=\" + encodeURIComponent(f_name)\n                    + \"&trigger_print=1\"\n                    + \"&format=\" + print_format\n                    + \"&no_letterhead=0\"\n                    + \"&letterhead=\" + encodeURIComponent(letter_head) \n                   ));\n            \n\n            },__(\"Print Delivery Note\"));\n        frm.add_custom_button(__(\"DN Return with amount\"), function () {\n                    if(frm.doc.parent_company){\n                        var letter_head = frm.doc.parent_company\n                    }\n                    else{\n                        var letter_head = frm.doc.company\n                    } \n                    var f_name = frm.doc.name\n                    var print_format =\"Delivery Note Return Test\";\n                     window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                        + \"doctype=\" + encodeURIComponent(\"Delivery Note\")\n                        + \"&name=\" + encodeURIComponent(f_name)\n                        + \"&trigger_print=1\"\n                        + \"&format=\" + print_format\n                        + \"&no_letterhead=0\"\n                        + \"&letterhead=\" + encodeURIComponent(letter_head) \n                       ));\n                \n    \n                },__(\"Print Delivery Note\"));  \n    \t\n\t    \n\t    \n\t    \n                } \n        \n            \n             \n\t    \n\t},\n\tvalidate(frm){\n\t   if(frm.doc.is_return){\n\t       $.each(frm.doc.return_item, function (i, c) {\n\t        $.each(frm.doc.items, function (i,d){\n\t            if(c.item_code == d.item_code){\n\t                var rq = c.return_quantity\n\t                var qr = -(rq)\n\t                d.qty = qr\n\t            }\n\t        })\n\t\t})\n\t   \n\t    \n\t\t\n\t\t$.each(frm.doc.items,function(i,d){\n\t\t    if(d.qty == 0){\n\t\t              frm.fields_dict.items.grid.get_row(d.idx-1).remove()\n\t\t        }\n\t\t      \n\t\t    \n\t\t})\n\t\t$.each(frm.doc.return_item,function(i,d){\n\t\t    if(d.return_quantity == 0){\n\t\t       \n\t\t            frm.fields_dict.return_item.grid.get_row(d.idx-1).remove()\n\n\t\t        }\n\t\t})\n\t   }\n\t},\n\t\n\tonload(frm){\n\t   \n\t    frappe.call({\n\t        method:\"electra.utils.make_dn\",\n\t        args:{\n\t           name:frm.doc.name \n\t        },\n\t        callback:function(d){\n\t            if(d.message){\n\t                frm.set_value('sales_order',d.message)\n\t            }\n\t        }\n\t    })\n\t    if(frm.doc.docstatus!=1){\n\t        frm.clear_table('return_item')\n\t            $.each(frm.doc.items, function (i, c) {\n    \t                var act = -(c.qty)\n    \t\t\t        var ac = act\n    \t            frm.add_child('return_item', {\n    \t\t\t\t\t'item_code': c.item_code,\n    \t\t\t\t\t'item_name': c.item_name,\n    \t\t\t\t\t'description': c.description,\n    \t\t\t\t\t'unit': c.unit,\n    \t\t\t\t\t'qty': ac,\n    \t\t\t\t\t'uom':c.uom,\n    \t\t\t\t\t'unit_price': c.unit_price,\n    \t\t\t\t\t'amount': c.amount,\n    \t\t\t\t\t'rate':c.rate\n    \t\t\t\t})\n    \t                \n    \t           frm.refresh_field('return_item')\n    \t           \n    \t\t})\n    \t\t\n\t    }\n\t\n// \t    if(frm.doc.__islocal){\n// \t        frappe.call({\n// \t\t\tmethod: \"frappe.client.get_list\",\n// \t\t\targs: {\n// \t\t\t\t'doctype': 'Delivery Note',\n// \t\t\t\tfilters: {\n// \t\t\t\t\t'name': frm.doc.name,\n// \t\t\t\t},\n// \t\t\t},\n// \t\t\tcallback(r) {\n// \t\t\t\t$.each(r.message, function (i, d) {\n// \t\t\t\t\tfrappe.call({\n// \t\t\t\t\t\tmethod: \"frappe.client.get\",\n// \t\t\t\t\t\targs: {\n// \t\t\t\t\t\t\t'doctype': 'Delivery Note',\n// \t\t\t\t\t\t\tfilters: {\n// \t\t\t\t\t\t\t\t'name': d.name,\n// \t\t\t\t\t\t\t},\n// \t\t\t\t\t\t},\n// \t\t\tcallback(r){\n// \t\t\t    console.log(r.message.items)\n// \t\t\t    $.each(r.message.items, function (i, c) {\n// \t\t\t        var act = -(c.qty)\n// \t\t\t        var ac = act\n\t\t\t        \n// \t\t\t\tfrm.add_child('return_item', {\n// \t\t\t\t\t'item_code': c.item_code,\n// \t\t\t\t\t'item_name': c.item_name,\n// \t\t\t\t\t'description': c.description,\n// \t\t\t\t\t'unit': c.unit,\n// \t\t\t\t\t'qty': ac,\n// \t\t\t\t\t'uom':c.uom,\n// \t\t\t\t\t'unit_price': c.unit_price,\n// \t\t\t\t\t'amount': c.amount,\n// \t\t\t\t\t'rate':c.rate\n// \t\t\t\t})\n// \t\t\t})\n// \t\t\t}\n// \t\t})\n// \t    })\n// \t}\n\t\n// \t}) \n// \t    }\n\t    \t   \n\t    \n\t   \n\t    \n\t},\n\tsales_person_username(frm){\n        console.log(frm.doc.sales_person_username)\n        if(frm.doc.sales_person_username){\n            frm.add_child('sales_team',{\n                'sales_person':frm.doc.sales_person_username,\n                'allocated_percentage':\"100\"\n            })\n            frm.refresh_field('sales_team')\n        }\n        \n        \n    },\n    \n    \tprepared_by(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: \"electra.utils.get_user_details\",\n\t\t\targs: {\n\t\t\t\t\"user\": frm.doc.prepared_by\n\t\t\t},\n\t\t\tcallback: function (d) {\n\t\t\t\tif (d.message) {\n\t\t\t\t\t// frm.set_value(\"user_id\",frm.doc.user_id)\n\t\t\t\t\tfrm.set_value(\"prepared_by_username\", d.message.employee_name)\n\t\t\t\t\tfrm.set_value(\"prepared_by_designation\", d.message.designation)\n\t\t\t\t\tfrm.set_value(\"prepared_by__mobile_number\", d.message.cell_number)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\t\n\tsales_person_user(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: \"electra.utils.get_user_details\",\n\t\t\targs: {\n\t\t\t\t\"user\": frm.doc.sales_person_user\n\t\t\t},\n\t\t\tcallback: function (d) {\n\t\t\t\tif (d.message) {\n\t\t\t\t\t// frm.set_value(\"user_id\",frm.doc.user_id)\n\t\t\t\t\tfrm.set_value(\"sales_person_username\", d.message.employee_name)\n\t\t\t\t\tfrm.set_value(\"sales_person_designation\", d.message.designation)\n\t\t\t\t\tfrm.set_value(\"sales_person_mobile\", d.message.cell_number)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tcompany(frm){\n\t    if(frm.doc.company){\n\t   // frm.trigger(\"set_series\")\n\t    frm.trigger(\"set_cost_center\")\n\t    }\n\t},\n\tset_cost_center(frm){\n\t  frappe.db.get_value(\"Company\", {\"name\": frm.doc.company}, \"cost_center\", (r) => {\n\t\t\t $.each(frm.doc.items,function(i,d){\n\t\t\t     d.cost_center = r.cost_center;\n\t\t\t })\n\t\t\t frm.refresh_field(\"items\")\n\t\t});\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company) {\n\t\t\tfrm.trigger(\"set_series\")\n\t\t}\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t\t// \t\tif (frm.doc.company == \"Electra\"){\n\t\t// \t\t    frm.set_value('letter_head',\"Electra\")\n\t\t// \t\t}\n\n\t},\n\t\n\t\n\tset_series(frm){\n\t    frappe.call({\n    \t\tmethod: \"electra.utils.get_series\",\n    \t\targs: {\n    \t\t\tcompany: frm.doc.company,\n    \t\t\tdoctype: frm.doc.doctype\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    if(frm.doc.is_return){\n    \t\t\t        var new_series = r.message\n    \t\t\t        frm.set_value('naming_series',new_series.replace(\"DN\", \"DNR\"))\n    \t\t\t    }\n    \t\t\t    else{\n    \t\t\t    frm.set_value('naming_series',r.message)\n    \t\t\t    }\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t},\n\t\n\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Invoice",
  "enabled": 1,
  "modified": "2022-11-01 18:11:08.986829",
  "name": "Purchase Invoice-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Purchase Invoice', {\n\trefresh(frm) {\n\t    if(frm.doc.company){\n\t\tfrm.trigger(\"set_series\")\n\t    }\n\n\t},\n\tcompany(frm){\n\t    if(frm.doc.company){\n\t    frm.trigger(\"set_series\")\n\t    frm.trigger(\"set_cost_center\")\n\t    }\n\t},\n\tset_cost_center(frm){\n\t  frappe.db.get_value(\"Company\", {\"name\": frm.doc.company}, \"cost_center\", (r) => {\n\t\t\t $.each(frm.doc.items,function(i,d){\n\t\t\t     d.cost_center = r.cost_center;\n\t\t\t })\n\t\t\t frm.refresh_field(\"items\")\n\t\t});\n\t},\n\tset_series(frm){\n\t    frappe.call({\n    \t\tmethod: \"electra.utils.get_series\",\n    \t\targs: {\n    \t\t\tcompany: frm.doc.company,\n    \t\t\tdoctype: frm.doc.doctype\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    if(frm.doc.is_return){\n    \t\t\t        var new_series = r.message\n    \t\t\t        frm.set_value('naming_series',new_series.replace(\"PI\", \"PRT\"))\n    \t\t\t    }\n    \t\t\t    else{\n    \t\t\t        frm.set_value('naming_series',r.message)\n    \t\t\t    }\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2022-01-02 07:37:50.286845",
  "name": "Stock Entry-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Stock Entry', {\n\trefresh(frm) {\n\t\tif(frm.doc.company){\n\t    frm.trigger(\"set_series\")\n\t    }\n\t},\n\tcompany(frm){\n\t    if(frm.doc.company){\n\t    frm.trigger(\"set_series\")\n\t    }\n\t},\n\tset_series(frm){\n\t    frappe.call({\n    \t\tmethod: \"electra.utils.get_series\",\n    \t\targs: {\n    \t\t\tcompany: frm.doc.company,\n    \t\t\tdoctype: frm.doc.doctype\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    frm.set_value('naming_series',r.message)\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Bulk Attendance Upload",
  "enabled": 0,
  "modified": "2022-01-07 14:15:59.264267",
  "name": "Bulk Attendance Upload-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Bulk Attendance Upload', {\n\trefresh(frm) {\n\t\t\n\t},\n\t\n\t upload(frm){\n\t     if(frm.doc.upload == false){\n\t         frm.disable_save()\n\t     }\n\t }\n\t\n\t\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Journal Entry",
  "enabled": 1,
  "modified": "2022-01-27 10:38:17.808798",
  "name": "Journal Entry-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Journal Entry', {\n\trefresh(frm) {\n\t\tif(frm.doc.company){\n\t\tfrm.trigger(\"set_series\")\n\t    }\n\t    \n\t},\n\tcompany(frm){\n\t    if(frm.doc.company){\n\t    frm.trigger(\"set_series\")\n\t    }\n\t},\n\tset_series(frm){\n\t    frappe.call({\n    \t\tmethod: \"electra.utils.get_series\",\n    \t\targs: {\n    \t\t\tcompany: frm.doc.company,\n    \t\t\tdoctype: frm.doc.doctype\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    frm.set_value('naming_series',r.message)\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2022-07-25 16:27:25.688426",
  "name": "Project-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Project', {\n\trefresh(frm) {\n\t\tif(frm.doc.company){\n\t\tfrm.trigger(\"set_series\")\n\t    }\n\t    if(frm.doc.status == \"Propose Completion\"){\n    \t\t frm.add_custom_button(__(\"Print\"), function () {\n    \t\t\t\n    \t\t\tvar f_name = frm.doc.name\n    \t\t\tvar print_format = \"Project Completion Certificate\";\n    \t\t\twindow.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n    \t\t\t\t+ \"doctype=\" + encodeURIComponent(\"Project\")\n    \t\t\t\t+ \"&name=\" + encodeURIComponent(f_name)\n    \t\t\t\t+ \"&trigger_print=1\"\n    \t\t\t\t+ \"&format=\" + print_format\n    \t\t\t\t+ \"&no_letterhead=0\"\n    \t\t\t\t// + \"&letterhead=\" + encodeURIComponent(letter_head)\n    \t\t\t))\n\t\t});   \n\t    }\n\t    \n\n\t},\n\tcompany(frm){\n\t    if(frm.doc.company){\n\t    frm.trigger(\"set_series\")\n\t    }\n\t},\n\tset_series(frm){\n\t    frappe.call({\n    \t\tmethod: \"electra.utils.get_series\",\n    \t\targs: {\n    \t\t\tcompany: frm.doc.company,\n    \t\t\tdoctype: frm.doc.doctype\n    \t\t},\n    \t\tcallback: function (r) {\n    \t\t\tif (r) {\n    \t\t\t    frm.set_value('naming_series',r.message)\n    \t\t\t}\n    \t\t}\n\t\t\t});\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Update Selling Price",
  "enabled": 0,
  "modified": "2022-04-15 15:39:37.920589",
  "name": "Update Selling Price-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Update Selling Price', {\n\trefresh(frm) {\n\t    if(frm.doc.item){\n\t        \n\t    }\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Payment Entry",
  "enabled": 1,
  "modified": "2022-04-18 14:32:33.082428",
  "name": "Payment Entry-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Payment Entry', {\n\trefresh(frm) {\n\t    if(frm.doc.payment_type == \"Receive\")\n\t    {\n\t\tif(!frm.doc.__islocal){\n\t\t\t    frm.add_custom_button(__(\"PRINT\"), function () {\n                var f_name = frm.doc.name\n                var print_format =\"voucher\";\n                 window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                    + \"doctype=\" + encodeURIComponent(\"Payment Entry\")\n                    + \"&name=\" + encodeURIComponent(f_name)\n                    + \"&trigger_print=1\"\n                    + \"&format=\" + print_format\n                    + \"&no_letterhead=0\"\n                    + \"&letterhead=\" + encodeURIComponent(\"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\")\n                   ));\n            \n\n            });\n\t}\n\t    }\n\t    else{\n\t        \tif(!frm.doc.__islocal){\n\t\t\t    frm.add_custom_button(__(\"PRINT\"), function () {\n                var f_name = frm.doc.name\n                var print_format =\"PAYMENT VOUCHER\";\n                 window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                    + \"doctype=\" + encodeURIComponent(\"Payment Entry\")\n                    + \"&name=\" + encodeURIComponent(f_name)\n                    + \"&trigger_print=1\"\n                    + \"&format=\" + print_format\n                    + \"&no_letterhead=0\"\n                    + \"&letterhead=\" + encodeURIComponent(\"No Letterhead\")\n                   ));\n            \n\n            });\n\t        \t}\n\t    }\n\t    \n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Day Schedule",
  "enabled": 1,
  "modified": "2022-08-01 10:05:38.984736",
  "name": "Day Schedule-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Day Schedule', {\n    schedule_date(frm){\n        $.each(frm.doc.schedule,function(j,v){\n            v.schedule_date = frm.doc.schedule_date\n\t    })\n\t    frm.refresh_field(\"schedule\")\n\t},\n\trefresh(frm) {\n\t    if(frm.doc.docstatus == 1){\n\t    frm.add_custom_button(__('Create Day Plan'), function() {\n\t    frappe.route_options = {'Day Schedule':frm.doc.name}\n\t    frappe.set_route('Form','Day Plan',{'day_schedule':frm.doc.name})\n\t             \n\t        \n\t    })\n\t    }\n\t\n\t\n\t},\n// \tonload(frm){\n// \t    frm.trigger('schedule_date')\n// \t},\n\t\n\tcompany(frm){\n\t    if(frm.doc.company){\n\t        frappe.call({\n            \tmethod: \"frappe.client.get\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Project\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tfields: [\"name\",\"project_name\",\"customer\"]\n\t\t\t\t},\n\t\t\t\t\tcallback: function (r){\n\t\t\t\t\t    if(r.message){\n\t\t\t\t\t        console.log(r.message.project_name)\n\t\t\t\t\t        frm.clear_table(\"schedule\")\n\t\t\t\t\t\t\tfrm.add_child(\"schedule\", {\n\t\t\t\t\t\t\t\t\t'project': r.message.name,\n\t\t\t\t\t\t\t\t\t'customer': r.message.customer,\n\t\t\t\t\t\t\t\t\t'project_name': r.message.project_name\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tfrm.refresh_field('schedule')\n\t\t\t\t\t\t\n\t\t\t\t\t        \n\t\t\t\t\t    }\n\t\t\t\t\t}\n\t        })\n\t    }\n\t}\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Day Plan",
  "enabled": 1,
  "modified": "2022-09-17 15:40:44.602785",
  "name": "Day Plan-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Day Plan', {\n\trefresh(frm) {\n\t    \n\t},\n\t\n\tvalidate(frm){\n\t    if(frm.doc.employee_multiselect){\n\t        console.log(frm.doc.employee_multiselect)\n\t    }\n\t   \n\t   \n\t},\n\tplanned_date(frm){\n\t        frm.trigger(\"get_day_schedule\")\n\t},\n\tproject(frm){\n\t        frm.trigger(\"get_day_schedule\")\n\t},\n\t\n    get_day_schedule(frm){\n        if(frm.doc.planned_date && frm.doc.project){\n        frappe.db.get_list('Employee Schedule', {\n            fields: ['*'],\n            filters: {\n                project: frm.doc.project,\n                schedule_date: frm.doc.schedule_date\n            },\n        }).then(records => {\n            $.each(records,function(i,v){\n               console.log(records)\n        \t        frm.set_value('day_schedule',v.parent)\n        \t        frm.set_value('staff',v.staff)\n        \t        frm.set_value('supervisor',v.supervisor)\n        \t        frm.set_value('worker',v.worker)\n            });\n        })\n        }\n    // \tfrappe.db.get_list('Employee Schedule',{\n    // \t        fields: ['*'],\n    // \t        filters: {\n    //                 project: frm.doc.project,\n    //                 schedule_date: frm.doc.schedule_date\n                    \n    //             },\n    // \t    })\n        \t   // $.each(frm.doc.schedule,function(i,v){\n        \t       // frm.set_value('day_schedule',v.name)\n        \t       // frm.set_value('staff',v.staff)\n        \t       // frm.set_value('supervisor',v.supervisor)\n        \t       // frm.set_value('worker',v.worker)\n    //     \t    })\n            \n}\n})\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "POS Invoice",
  "enabled": 1,
  "modified": "2022-09-30 16:02:06.941969",
  "name": "POS Invoice-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('POS Invoice', {\n    onload(frm){\n        frm.set_value('update_stock',1)\n        \n    },\n\trefresh(frm) {\n\t\tif (frm.doc.company) {\n\t\t\tfrm.trigger(\"set_series\")\n\t\t}\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company) {\n\t\t\tfrm.trigger(\"set_series\")\n\t\t}\n\t},\n\tset_series(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: \"electra.utils.get_series\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\tdoctype: frm.doc.doctype\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (r) {\n\t\t\t\t\tfrm.set_value('naming_series', r.message)\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\t\n\n\tvalidate(frm){\n\t  frm.clear_table('payments')\n\t  frm.add_child('payments', {\n\t      'mode_of_payment':'Cash',\n\t    'amount':frm.doc.rounded_total\n\t\t\t\t\t\t\t\t})\n\t  frm.refresh_field('payments')\n\t\t\n\t},\n\tfetch(frm) {\n\t\tfrappe.call({\n\t\t\tmethod: 'electra.custom.get_stock_balance',\n\t\t\targs: {\n\t\t\t\t'item_table': frm.doc.items\n\t\t\t},\n\t\t\tcallback(d) {\n\t\t\t\tfrm.clear_table('stock_availability')\n\t\t\t\tif (d.message) {\n\t\t\t\t\t$.each(d.message, function (i, v) {\n\t\t\t\t\t\tfrm.add_child('stock_availability', {\n\t\t\t\t\t\t\t'item_code': v[0],\n\t\t\t\t\t\t\t'item_name': v[1],\n\t\t\t\t\t\t\t'warehouse': v[2],\n\t\t\t\t\t\t\t'qty': v[3],\n\t\t\t\t\t\t\t'uom': v[4],\n\t\t\t\t\t\t\t'value': v[5]\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.refresh_field('stock_availability')\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tfrappe.call({\n\t\t\tmethod: 'electra.custom.get_previous_po',\n\t\t\targs: {\n\t\t\t\t'item_table': frm.doc.items\n\t\t\t},\n\t\t\tcallback(d) {\n\t\t\t\tfrm.clear_table('previous_po')\n\t\t\t\tif (d.message) {\n\t\t\t\t\t$.each(d.message, function (i, v) {\n\t\t\t\t\t\tfrm.add_child('previous_po', {\n\t\t\t\t\t\t\t'item_code': v[0],\n\t\t\t\t\t\t\t'item_name': v[1],\n\t\t\t\t\t\t\t'supplier': v[2],\n\t\t\t\t\t\t\t'qty': v[3],\n\t\t\t\t\t\t\t'po_date': v[4],\n\t\t\t\t\t\t\t'amount': v[5],\n\t\t\t\t\t\t\t'purchase_order': v[6]\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.refresh_field('previous_po')\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tfrappe.call({\n\t\t\tmethod: 'electra.custom.get_out_qty',\n\t\t\targs: {\n\t\t\t\t'item_table': frm.doc.items\n\t\t\t},\n\t\t\tcallback(d) {\n\t\t\t\tfrm.clear_table('stock_out_qty')\n\t\t\t\tif (d.message) {\n\t\t\t\t\t$.each(d.message, function (i, v) {\n\t\t\t\t\t\tfrm.add_child('stock_out_qty', {\n\t\t\t\t\t\t\t'item_code': v[0],\n\t\t\t\t\t\t\t'warehouse': v[1],\n\t\t\t\t\t\t\t'qty': v[2],\n\t\t\t\t\t\t\t'date': v[3],\n\t\t\t\t\t\t\t'out_type': v[4]\n\t\t\t\t\t\t})\n\t\t\t\t\t\tfrm.refresh_field('stock_out_qty')\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n})\n\nfrappe.ui.form.on('POS Invoice Item', {\n\titem_code(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn]\n\t\tif (child.item_code) {\n\t\t  //  console.log(item_code)\n\t\t\tfrm.trigger('fetch')\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'electra.custom.stock_popup',\n\t\t\t\targs: {\n\t\t\t\t\t'item_code': child.item_code\n\t\t\t\t},\n\t\t\t\tcallback(d) {\n\t\t\t\t\tif (d.message) {\n\t\t\t\t\t\tfrm.get_field(\"items_html\").$wrapper.html(d.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\n\t\t}\n\t},\n\titems_remove(frm) {\n\t\tfrm.trigger('fetch')\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Internal Payment Request",
  "enabled": 0,
  "modified": "2022-06-22 09:48:05.309224",
  "name": "Internal Payment Request-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Internal Payment Request', {\n\trefresh(frm) {\n\t\t// your code here\n\t}\n})\n\nfrappe.ui.form.on('Internal Payment', {\n    setup(frm) {\n\t\tfrm.set_query(\"purchase_invoice\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\t'document_type': frm.doc.purchase_invoice\n\t\t\t\t}\n\t\t\t};\n\t\t});\n    \t\t\n    \t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Transfer",
  "enabled": 1,
  "modified": "2022-08-24 07:48:22.818536",
  "name": "Stock Transfer-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Stock Transfer', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\tonload(frm){\n\t    if(frm.doc.docstatus != 1){\n\t        frm.set_value(\"transferred_by\",frappe.session.user)   \n\t    }\n\t},\n\tprint: function (frm) {\n\t\t\n\t\tfrm.add_custom_button(__(\"Print\"), function () {\n\t\t\tif (frm.doc.parent_company) {\n\t\t\t\tvar letter_head = frm.doc.parent_company\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar letter_head = frm.doc.company\n\t\t\t}\n\t\t\tvar f_name = frm.doc.name\n\t\t\tvar print_format = \"Stock Transfer Test\";\n\t\t\twindow.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n\t\t\t\t+ \"doctype=\" + encodeURIComponent(\"Stock Transfer\")\n\t\t\t\t+ \"&name=\" + encodeURIComponent(f_name)\n\t\t\t\t+ \"&trigger_print=1\"\n\t\t\t\t+ \"&format=\" + print_format\n\t\t\t\t+ \"&no_letterhead=0\"\n\t\t\t\t+ \"&letterhead=\" + encodeURIComponent(letter_head)\n\t\t\t));\n\n\n\t\t});\n\t},\n\tcompany(frm){\n\t    if (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.source_company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.source_company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.source_company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.source_company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.source_company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.source_company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t}\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Confirmation",
  "enabled": 1,
  "modified": "2022-07-03 13:24:12.230788",
  "name": "Stock Confirmation-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Stock Confirmation', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\tonload(frm){\n\t    if (frm.doc.__islocal){\n\t     frm.set_value(\"transferred_by\",frappe.session.user)   \n\t    }\n\t  \n\t},\n\ttarget_company(frm){\n\t    if (frm.doc.target_company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.target_company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.target_company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.source_target_company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.target_company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.target_company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.target_company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.target_company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.target_company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.target_company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.target_company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.target_company == \"MEP DIVISION - ELECTRA\" || frm.doc.target_company == \"STEEL DIVISION - ELECTRA\" || frm.doc.target_company == \"TRADING DIVISION - ELECTRA\" || frm.doc.target_company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.target_company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t}\n\t},\n\tprint: function (frm) {\n\t\tfrm.add_custom_button(__(\"Print\"), function () {\n\t\t\tif (frm.doc.parent_company) {\n\t\t\t\tvar letter_head = frm.doc.parent_company\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar letter_head = frm.doc.company\n\t\t\t}\n\t\t\tvar f_name = frm.doc.name\n\t\t\tvar print_format = \"Stock Confirmation\";\n\t\t\twindow.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n\t\t\t\t+ \"doctype=\" + encodeURIComponent(\"Stock Confirmation\")\n\t\t\t\t+ \"&name=\" + encodeURIComponent(f_name)\n\t\t\t\t+ \"&trigger_print=1\"\n\t\t\t\t+ \"&format=\" + print_format\n\t\t\t\t+ \"&no_letterhead=0\"\n\t\t\t\t+ \"&letterhead=\" + encodeURIComponent(letter_head)\n\t\t\t));\n\n\n\t\t});\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Request",
  "enabled": 1,
  "modified": "2022-07-05 13:55:07.671498",
  "name": "Stock Request-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Stock Request', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\tcompany(frm){\n\t    if (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t}\n\t},\n\tonload(frm){\n\t    frm.set_query(\"sales_order\", function() {\n\t\t\treturn {\n\t\t\t\t\"filters\": {\n\t\t\t\t\t\"company\": frm.doc.company,\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Cost Estimation",
  "enabled": 1,
  "modified": "2022-11-08 12:24:08.551423",
  "name": "Cost Estimation-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Cost Estimation', {\n    before_cancel(frm){\n        let dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Cancellation Remarks'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Cancellation Remarks',\n\t\t\t\t\tfieldtype: 'Small Text',\n\t\t\t\t\tfieldname: 'remarks',\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action_label: __('Add'),\n\t\t\tprimary_action: () => {\n\t\t\t\tlet values = dialog.get_values();\n\t\t\t\tif (values) {\n\t\t\t\t\tvar remarks = values['remarks']\n\t\t\t\t\tconsole.log(remarks)\n\t\t\t\t\tfrm.set_value('remarks',remarks)\n\t\t\t\t}\n\t\t\t\tdialog.hide();\n\t\t\t},\n\t\t});\n\t\tdialog.show();\n    },\n    validate(frm) {\n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.materials,function(i,d){\n            qty += d.qty\n            cost_price += d.amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"material_qty_total\", qty)\n        frm.set_value(\"material_cost_price\", cost_price)\n        frm.set_value(\"material_selling_price\", selling_price)\n        refresh_field(\"material_qty_total\")\n        refresh_field(\"material_cost_price\")\n        refresh_field(\"material_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.design_calculation,function(i,d){\n            qty += d.qty\n            cost_price += d.amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"design_qty_total\", qty)\n        frm.set_value(\"design_cost_price\", cost_price)\n        frm.set_value(\"design_selling_price\", selling_price)\n        refresh_field(\"design_qty_total\")\n        refresh_field(\"design_cost_price\")\n        refresh_field(\"design_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.manpower,function(i,d){\n            qty += d.qty\n            cost_price += d.amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"manpower_qty_total\", qty)\n        frm.set_value(\"manpower_cost_price\", cost_price)\n        frm.set_value(\"manpower_selling_price\", selling_price)\n        refresh_field(\"manpower_qty_total\")\n        refresh_field(\"manpower_cost_price\")\n        refresh_field(\"manpower_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.finishing_work,function(i,d){\n            qty += d.qty\n            cost_price += d.amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"finishing_qty_total\", qty)\n        frm.set_value(\"finishing_cost_price\", cost_price)\n        frm.set_value(\"finishing_selling_price\", selling_price)\n        refresh_field(\"finishing_qty_total\")\n        refresh_field(\"finishing_cost_price\")\n        refresh_field(\"finishing_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.bolts_accessories,function(i,d){\n            qty += d.qty\n            cost_price += d.amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"accessories_qty_total\", qty)\n        frm.set_value(\"accessories_cost_price\", cost_price)\n        frm.set_value(\"accessories_selling_price\", selling_price)\n        refresh_field(\"accessories_qty_total\")\n        refresh_field(\"accessories_cost_price\")\n        refresh_field(\"accessories_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.installation,function(i,d){\n            qty += d.qty\n            cost_price += d.amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"installation_qty_total\", qty)\n        frm.set_value(\"installation_cost_price\", cost_price)\n        frm.set_value(\"installation_selling_price\", selling_price)\n        refresh_field(\"installation_qty_total\")\n        refresh_field(\"installation_cost_price\")\n        refresh_field(\"installation_selling_price\")\n        \n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.heavy_equipments,function(i,d){\n            qty += d.qty\n            cost_price += d.amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"heavy_equipments_qty_total\", qty)\n        frm.set_value(\"heavy_equipments_cost_price\", cost_price)\n        frm.set_value(\"heavy_equipments_selling_price\", selling_price)\n        refresh_field(\"heavy_equipments_qty_total\")\n        refresh_field(\"heavy_equipments_cost_price\")\n        refresh_field(\"heavy_equipments_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.manpower_subcontract,function(i,d){\n            qty += d.qty\n            cost_price += d.amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"subcontract_qty_total\", qty)\n        frm.set_value(\"subcontract_cost_price\", cost_price)\n        frm.set_value(\"subcontract_selling_price\", selling_price)\n        refresh_field(\"subcontract_qty_total\")\n        refresh_field(\"subcontract_cost_price\")\n        refresh_field(\"subcontract_selling_price\")\n\t},\n\t\n\trefresh(frm){\n\t    if(frm.doc.docstatus == 1){\n\t    frm.add_custom_button(__(\"Print\"), function () {\n                if(frm.doc.parent_company){\n                    var letter_head = frm.doc.parent_company\n                }\n                else{\n                    var letter_head = frm.doc.company\n                } \n                var f_name = frm.doc.name\n                var print_format =\"Cost Estimation\";\n                 window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                    + \"doctype=\" + encodeURIComponent(\"Cost Estimation\")\n                    + \"&name=\" + encodeURIComponent(f_name)\n                    + \"&trigger_print=1\"\n                    + \"&format=\" + print_format\n                    + \"&no_letterhead=0\"\n                    + \"&letterhead=\" + encodeURIComponent(letter_head) \n                   ));\n            \n\n            });\n\t    }\n\t}\n\t\n\n\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project Budget",
  "enabled": 1,
  "modified": "2022-10-10 17:34:38.081686",
  "name": "Project Budget-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Project Budget', {\n    \n    onload(frm){\n        if(frm.doc.docstatus == 0){\n           frm.set_value(\"date_of_budget\", new Date())\n        }\n    },\n\t\tvalidate(frm) {\n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.materials,function(i,d){\n            qty += d.qty\n            cost_price += d.cost_amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"material_qty_total_\", qty)\n        frm.set_value(\"material_cost_price_\", cost_price)\n        frm.set_value(\"material_selling_price_\", selling_price)\n        refresh_field(\"material_qty_total_\")\n        refresh_field(\"material_cost_price_\")\n        refresh_field(\"material_selling_price_\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.design,function(i,d){\n            qty += d.qty\n            cost_price += d.cost_amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"design_qty_total\", qty)\n        frm.set_value(\"design_cost_price\", cost_price)\n        frm.set_value(\"design_selling_price\", selling_price)\n        refresh_field(\"design_qty_total\")\n        refresh_field(\"design_cost_price\")\n        refresh_field(\"design_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.manpower,function(i,d){\n            qty += d.total_workers\n            cost_price += d.cost_amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"manpower_qty_total\", qty)\n        frm.set_value(\"manpower_cost_price\", cost_price)\n        frm.set_value(\"manpower_selling_price\", selling_price)\n        refresh_field(\"manpower_qty_total\")\n        refresh_field(\"manpower_cost_price\")\n        refresh_field(\"manpower_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.finishing_work,function(i,d){\n            qty += d.qty\n            cost_price += d.cost_amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"finishing_qty_total\", qty)\n        frm.set_value(\"finishing_cost_price\", cost_price)\n        frm.set_value(\"finishing_selling_price\", selling_price)\n        refresh_field(\"finishing_qty_total\")\n        refresh_field(\"finishing_cost_price\")\n        refresh_field(\"finishing_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.bolts_accessories,function(i,d){\n            qty += d.qty\n            cost_price += d.cost_amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"accessories_qty_total\", qty)\n        frm.set_value(\"accessories_cost_price\", cost_price)\n        frm.set_value(\"accessories_selling_price\", selling_price)\n        refresh_field(\"accessories_qty_total\")\n        refresh_field(\"accessories_cost_price\")\n        refresh_field(\"accessories_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.installation,function(i,d){\n            qty += d.qty\n            cost_price += d.cost_amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"installation_qty_total\", qty)\n        frm.set_value(\"installation_cost_price\", cost_price)\n        frm.set_value(\"installation_selling_price\", selling_price)\n        refresh_field(\"installation_qty_total\")\n        refresh_field(\"installation_cost_price\")\n        refresh_field(\"installation_selling_price\")\n        \n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.heavy_equipments,function(i,d){\n            qty += d.qty\n            cost_price += d.cost_amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"heavy_equipments_qty_total\", qty)\n        frm.set_value(\"heavy_equipments_cost_price\", cost_price)\n        frm.set_value(\"heavy_equipments_selling_price\", selling_price)\n        refresh_field(\"heavy_equipments_qty_total\")\n        refresh_field(\"heavy_equipments_cost_price\")\n        refresh_field(\"heavy_equipments_selling_price\")\n        \n        var qty = 0;\n        var cost_price = 0;\n        var selling_price = 0;\n        $.each(frm.doc.others,function(i,d){\n            qty += d.qty\n            cost_price += d.cost_amount\n            selling_price += d.amount_with_overheads\n        })\n        frm.set_value(\"subcontract_qty_total\", qty)\n        frm.set_value(\"subcontract_cost_price\", cost_price)\n        frm.set_value(\"subcontract_selling_price\", selling_price)\n        refresh_field(\"subcontract_qty_total\")\n        refresh_field(\"subcontract_cost_price\")\n        refresh_field(\"subcontract_selling_price\")\n\t}\n\n\n})\n\n\n\nfrappe.ui.form.on('PB Items', {\n\titem_code(frm,cdt,cdn){\n\t    var child = locals [cdt][cdn]\n\t    if (child.item_code){\n\t        var quantity = child.cost_amount - child.amount\n\t        child.difference = quantity\n\t        \n\t        \n\t    }\n},\n})\n\n    ",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "PB SOW",
  "enabled": 0,
  "modified": "2022-09-07 09:13:01.591023",
  "name": "PB SOW-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('PB SOW', {\n\tvalidate(frm){\n\t    var eba = frm.doc.lpo_amount - frm.doc.bidding_amount\n\t    frm.set_value(\"bidding_amount_difference\",eba)\n\t    var bba = frm.doc.lpo_amount - frm.doc.pb_bidding_amount\n\t    frm.set_value(\"budgeted_bidding_amount_difference\",bba)\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Transfer",
  "enabled": 1,
  "modified": "2022-08-23 08:30:53.733921",
  "name": "Employee Transfer-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Employee Transfer', {\n    employee(frm){\n        if(frm.doc.employee){\n            frappe.db.get_value(\"Employee\",frm.doc.employee,['company'], (r) => {\n\t\t\tif (r){\n\t\t\t\tconsole.log(r)\n\t\t\t\tfrm.set_value('company',r.company)\n\t\t\t}\n\t\t})\n        }\n         \n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Resignation Form",
  "enabled": 1,
  "modified": "2022-09-12 11:05:47.488328",
  "name": "Resignation Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Resignation Form', {\n\trefresh(frm) {\n\t    if(frm.doc.workflow_state ==\"Exit\"){\n\t     frm.add_custom_button(__('F & F Statement'), function() {\n\t        frappe.db.get_value('Full and Final Settlement',{'employee': frm.doc.employee },'name')\n\t    .then(r => {\n        if(r.message && Object.entries(r.message).length === 0){\n            console.log('hello')\n             frappe.route_options = { 'employee':frm.doc.employee,'employee_name': frm.doc.employee_name}\n            frappe.set_route('Form','Full and Final Settlement','new-full-and-final-settlement-1')\n            \n        }   \n        else{\n           frappe.set_route('Form','Full and Final Settlement',r.message.name)\n           console.log(\"hiii\")\n        }\n        \n    })\n\t\t\t\n                 });\n\t\t   }\n\t        if(frm.doc.workflow_state == \"Approved\"){\n    \t\t frm.add_custom_button(__(\"Experience Certificate\"), function () {\n    \t\t\t\n    \t\t\tvar f_name = frm.doc.name\n    \t\t\tvar print_format = \"Experience Certificate\";\n    \t\t\twindow.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n    \t\t\t\t+ \"doctype=\" + encodeURIComponent(\"Resignation Form\")\n    \t\t\t\t+ \"&name=\" + encodeURIComponent(f_name)\n    \t\t\t\t+ \"&trigger_print=1\"\n    \t\t\t\t+ \"&format=\" + print_format\n    \t\t\t\t+ \"&no_letterhead=0\"\n    \t\t\t\t// + \"&letterhead=\" + encodeURIComponent(letter_head)\n    \t\t\t))\n\t\t});   \n\t        }\t\n\t},\n\tvalidate(frm){\n\t    if(frm.doc.employee_name){\n\t        frm.set_value('session_user',frappe.session.user)\n\t        frm.set_value('date_of_change',new Date())\n      }\n\t            \n\t},\n\tonload(frm){\n\t    if(frm.doc.workflow_state == 'Pending for HOD'){\n\t    frm.set_value('hods_relieving_date',frappe.datetime.get_today())\n\t}\n\tif(frm.doc.workflow_state == 'Pending for HR'){\n\t    frm.set_value('approved_relieving_date',frappe.datetime.get_today())\n\t}\n\t}\n\t\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Full and Final Settlement",
  "enabled": 1,
  "modified": "2022-09-21 09:11:52.241758",
  "name": "Full and Final Settlement-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Full and Final Settlement', {\n    refresh(frm){\n\t\t if(frm.doc.workflow_state == \"Approved\"){\n    \t\t frm.add_custom_button(__(\"Print F & F\"), function () {\n    \t\t\t\n    \t\t\tvar f_name = frm.doc.name\n    \t\t\tvar print_format = \"Full and Final Settlement\";\n    \t\t\twindow.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n    \t\t\t\t+ \"doctype=\" + encodeURIComponent(\"Full and Final Settlement\")\n    \t\t\t\t+ \"&name=\" + encodeURIComponent(f_name)\n    \t\t\t\t+ \"&trigger_print=1\"\n    \t\t\t\t+ \"&format=\" + print_format\n    \t\t\t\t+ \"&no_letterhead=0\"\n    \t\t\t))\n\t\t});   \n\t        }\n    },\n\tvalidate(frm) {\n\t    \n\t\tif (frm.doc.employee){\n\t\t   \n\t        frappe.call({\n\t            method:'electra.utils.get_gratuity',\n\t            args:{\n\t                employee : frm.doc.employee\n\t            },\n\t            callback:function(r){\n\t                console.log(r.message)\n\t                 console.log('hi')\n\t                 frm.set_value('gratuity_amount',r.message)\n\t            }\n\t        })\n\t    }\n\t    if(frm.doc.employee){\n            var fa = 300\n            console.log(fa)\n\t        var cal = fa/30 * frm.doc.no_of_days_worked\n\t        console.log(cal)\n\t        console.log('food')\n\t        frm.set_value('food_allowance_',cal)\n        }\n        if(frm.doc.employee){\n            var basic = frm.doc.basic_salary \n            var dow = frm.doc.no_of_days_worked \n\t        var cal = (((basic/dow)/8)*1.25) * frm.doc.normal_over_time\n\t        console.log(cal)\n\t        frm.set_value('ot_amount',cal)\n        }\n        if(frm.doc.employee){\n            var ot = frm.doc.amount \n            var wot = frm.doc.wot_amount \n            var hot = frm.doc.hot_amount \n\t        var cal = ot + wot+ hot\n\t        console.log(cal)\n\t        if(cal){\n\t        frm.set_value('total_ot',cal.toFixed(2))\n        }\n        }\n        \n        if(frm.doc.employee){\n            var leave_pay = frm.doc.leave_pay \n            var gra_amount = frm.doc.gratuity_amount \n\t        var leave_grat = leave_pay + gra_amount\n\t        console.log(leave_grat)\n\t        if(leave_grat){\n\t        frm.set_value('leave_paygratuity_total',leave_grat.toFixed(2))\n        }\n        }\n        \n        if(frm.doc.employee){\n            var basic = frm.doc.basic_salary \n            var dow = frm.doc.no_of_days_worked \n\t        var cal = (((basic/dow)/8)*1.75) * frm.doc.holiday_over_time\n\t        console.log(cal)\n\t        if(cal){\n\t        frm.set_value('hot_amount',cal.toFixed(2))\n        }\n        }\n        if(frm.doc.employee){\n            var basic = frm.doc.basic_salary \n            var dow = frm.doc.no_of_days_worked \n\t        var cal = (((basic/dow)/8) *2.0)* frm.doc.friday_over_time\n\t        console.log(cal)\n\t        if(cal){\n\t        frm.set_value('wot_amount',cal.toFixed(2))\n        }\n        }\n        if(frm.doc.employee){\n            var basic = frm.doc.basic_salary \n            var dow = frm.doc.total_working_days \n\t        var cal = ((basic/dow)*frm.doc.no_of_days_worked)\n\t        console.log(cal)\n\t        if(cal){\n\t        frm.set_value('total_salary',cal.toFixed(2))\n        }\n        }\n\t   \n\t},\n\t\n\tonload(frm){\n\t    frappe.call({\n\t        method:\"electra.utils.get_reg_form\",\n\t        args:{\n\t           'employee':frm.doc.employee \n\t        },\n\t        callback:function(d){\n\t            if(d.message){\n\t                console.log(d.message)\n\t                frm.set_value('resignation_form',d.message[0])\n\t                frm.set_value('pay_start_date',d.message[1])\n\t                frm.set_value('pay_end_date',d.message[2])\n\n\t            }\n\t        }\n\t    })\n\t   // frappe.call({\n\t   //     method:\"electra.utils.get_loan_detail\",\n\t   //     args:{\n\t   //        'employee':frm.doc.employee \n\t   //     },\n\t   //     callback:function(d){\n\t   //         if(d.message){\n\t                \n\t   //             console.log(d.message)\n\t                \n\t   //             frm.set_value('loan_other_deduction',d.message[-1])\n\t               \n\t   //         }\n\t   //     }\n\t   // })\n\t     frappe.call({\n\t        method:\"electra.utils.calculate_attendance\",\n\t        args:{\n\t           'employee':frm.doc.employee,\n\t           \n\t        },\n\t        callback:function(d){\n\t            console.log(d.message[0].count)\n\t            if(d.message){\n\t                frm.set_value('no_of_days_worked',d.message[0].count)\n\t               // frm.set_value('normal_over_time',d.message[0].ot)\n\t               // frm.set_value('friday_over_time',d.message[0].wot)\n\t               // frm.set_value('holiday_over_time',d.message[0].hot)\n\t            }\n\t        }\n\t    })\n\t     frappe.call({\n\t        method:\"electra.utils.get_current_month_date\",\n\t        args:{\n\t           'employee':frm.doc.employee,\n\t           \n\t        },\n\t        callback:function(d){\n\t            console.log(d.message)\n\t            if(d.message){\n\t                frm.set_value('total_working_days',d.message)\n\t               // frm.set_value('normal_over_time',d.message[0].ot)\n\t               // frm.set_value('friday_over_time',d.message[0].wot)\n\t               // frm.set_value('holiday_over_time',d.message[0].hot)\n\t            }\n\t        }\n\t    })\n\t     \n\t     \n\n\t   \n\t    \n\t},\n    \n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project Day Plan",
  "enabled": 1,
  "modified": "2022-11-09 14:53:07.057131",
  "name": "Project Day Plan-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Project Day Plan', {\n    on_submit(frm){\n        frm.trigger('calculation')\n    },\n    validate(frm){\n        frm.trigger('calculation')\n    },\n    calculation(frm){\n        $.each(frm.doc.project_day_plan_employee,function(i,d){\n        var to_time = d.to_time\n\t\tvar from_time =d.from_time\n\t\tvar lunch_break=d.lunch_break\n\t\t\n\t\tvar time1= from_time.split(':')\n\t\tvar time2= to_time.split(':')\n\t\tvar time3= lunch_break.split(':')\n\t\tvar hourInMinOfEntry=time1[0] * 60;\n    \tvar hourInMinOfExit = time2[0] * 60;\n    \tvar lunch = time3[0] * 60;\n    \t\n    \tvar secondInMinOfEntry = time1[0] / 60;\n    \tvar secondInMinOfExit = time2[0] / 60;\n    \tvar lunch_time = time3[0] / 60;\n    \tvar totalMinsOfEntry=hourInMinOfEntry+parseInt(time1[1]) + secondInMinOfEntry;\n    \tvar totalMinsOfExit=hourInMinOfExit+parseInt(time2[1]) + secondInMinOfExit;\n    \tvar break_for_lunch=lunch+parseInt(time3[1]) + lunch_time;\n    \tvar dif = totalMinsOfExit-totalMinsOfEntry-break_for_lunch\n        var num = dif;\n        // console.log(num);\n        var hours = (num / 60);\n        var rhours = Math.floor(hours);\n        var minutes = (hours - rhours) * 60;\n        var rminutes = Math.round(minutes);\n        // console.log(rhours +\":\"+ rminutes +\":\"+'00');\n        d.total_working_hours = rhours +\":\"+ rminutes +\":\"+'00'\n        if(num > 480.1333333333333){\n            var ghours = rhours - 8\n            var gminutes = rminutes - 0 \n            var ot_hours = ghours +\":\"+ gminutes +':00'\n            d.ot = ot_hours \n        }\n        else{\n            d.ot = \"00:00:00\"\n        }\n    })\n    \n    },\n\tonload(frm) {\n\t\tif (frm.doc.__islocal) {\n\t\t    frm.set_value(\"plan_date\",new Date())\n\t\t}\n\t\t\n\t    \n    },\n    company(frm){\n        frm.clear_table(\"project_day_plan_list\")\n        var company = frm.doc.company\n\t\tfrappe.db.get_list('Project', {\n\t\t\tfields:['project_name','name'],\n\t\t\tfilters: {\n\t\t\t\tstatus: 'Open',\n\t\t\t\tcompany\n\t\t\t},\n\t\t    }).then(records => {\n\t\t\t$.each(records, function (i, r) {\n\t\t\t\tfrm.add_child(\"project_day_plan_list\", {\n\t\t\t\t\t'project': r.name,\n\t\t\t\t\t'project_name':r.project_name\n\t\t\t\t})\n\t\t\t\tfrm.refresh_field(\"project_day_plan_list\")\n\t\t})\n\t\t})\n    }\n})\nfrappe.ui.form.on('Project Day Plan List', {\n\tadd_employee: function (frm, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn]\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Select Employees'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Project Name',\n\t\t\t\t\tfieldtype: 'Link',\n\t\t\t\t\toptions: 'Project',\n\t\t\t\t\tdefault: row.project,\n\t\t\t\t\tfieldname: 'project',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Employee List',\n\t\t\t\t\tfieldtype: 'Table MultiSelect',\n\t\t\t\t\tignore_user_permissions: 1,\n\t\t\t\t\toptions: 'Project Day Plan Employee',\n\t\t\t\t\tfieldname: 'employee',\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Add'),\n\t\t\tprimary_action: () => {\n\t\t\t\tlet values = dialog.get_values();\n\t\t\t\tif (values) {\n\t\t\t\t\tvar project = values['project']\n\t\t\t        $.each(values['employee'], function (i, k) {\n\t\t\t\t\tfrm.add_child(\"project_day_plan_employee\", {\n\t\t\t\t\t\t'employee': k.employee,\n\t\t\t\t\t\t'project': project,\n\t\t\t\t\t\t'lunch_break':'1:00'\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\tfrm.refresh_field(\"project_day_plan_employee\")\n\t\t\t\t}\n\t\t        dialog.hide();\n\t\t\t},\n\t\t});\n\t\tdialog.show();\n\n\t},\n})\nfrappe.ui.form.on('Project Day Plan Employee', {\n    employee:function(frm,cdt,cdn){\n        var row = locals[cdt][cdn]\n        row.employee(ignore_permissions=True)\n    },\n    from_time: function(frm,cdt,cdn){\n\t\tvar row = locals[cdt][cdn]\n\t\tvar from_time = row.from_time\n\t\tvar time2= from_time.split(':')\n    \tvar hourInMinOfExit = time2[0] * 60;\n    \tvar secondInMinOfExit = time2[0] / 60;\n    \tvar totalMinsOfExit=hourInMinOfExit+parseInt(time2[1]) + secondInMinOfExit;\n        var num = totalMinsOfExit\n        var hours = (num / 60);\n        var rhours = Math.floor(hours);\n        var minutes = (hours - rhours) * 60;\n        var rminutes = Math.round(minutes);\n        var ghours = rhours + 9\n        var gminutes = rminutes + 0 \n        var totime = ghours +\":\"+ gminutes +':00'\n        console.log(totime)\n        row.to_time = totime \n        frm.trigger('to_time')\n        frm.refresh_field(\"project_day_plan_employee\")\n\t\t\n    },\n\tto_time: function(frm,cdt,cdn){\n\t\tvar row = locals[cdt][cdn]\n\t\tvar to_time = row.to_time\n\t\tvar from_time =row.from_time\n\t\tvar lunch_break=row.lunch_break\n\t\t\n\t\tvar time1= from_time.split(':')\n\t\tvar time2= to_time.split(':')\n\t\tvar time3= lunch_break.split(':')\n\t\tvar hourInMinOfEntry=time1[0] * 60;\n    \tvar hourInMinOfExit = time2[0] * 60;\n    \tvar lunch = time3[0] * 60;\n    \t\n    \tvar secondInMinOfEntry = time1[0] / 60;\n    \tvar secondInMinOfExit = time2[0] / 60;\n    \tvar lunch_time = time3[0] / 60;\n    \tvar totalMinsOfEntry=hourInMinOfEntry+parseInt(time1[1]) + secondInMinOfEntry;\n    \tvar totalMinsOfExit=hourInMinOfExit+parseInt(time2[1]) + secondInMinOfExit;\n    \tvar break_for_lunch=lunch+parseInt(time3[1]) + lunch_time;\n    \tvar dif = totalMinsOfExit-totalMinsOfEntry-break_for_lunch\n        var num = dif;\n        // console.log(num);\n        var hours = (num / 60);\n        var rhours = Math.floor(hours);\n        var minutes = (hours - rhours) * 60;\n        var rminutes = Math.round(minutes);\n        // console.log(rhours +\":\"+ rminutes +\":\"+'00');\n        row.total_working_hours = rhours +\":\"+ rminutes +\":\"+'00'\n        if(num > 480.1333333333333){\n            var ghours = rhours - 8\n            var gminutes = rminutes - 0 \n            var ot_hours = ghours +\":\"+ gminutes +':00'\n            row.ot = ot_hours \n        }\n        else{\n            row.ot = \"00:00:00\"\n        }\n        frm.refresh_field(\"project_day_plan_employee\")\n\t},\n\tlunch_break: function(frm,cdt,cdn){\n\t\tvar row = locals[cdt][cdn]\n\t\tvar to_time = row.to_time\n\t\tvar from_time =row.from_time\n\t\tvar lunch_break=row.lunch_break\n\t\t\n\t\tvar time1= from_time.split(':')\n\t\tvar time2= to_time.split(':')\n\t\tvar time3= lunch_break.split(':')\n\t\tvar hourInMinOfEntry=time1[0] * 60;\n    \tvar hourInMinOfExit = time2[0] * 60;\n    \tvar lunch = time3[0] * 60;\n    \t\n    \tvar secondInMinOfEntry = time1[0] / 60;\n    \tvar secondInMinOfExit = time2[0] / 60;\n    \tvar lunch_time = time3[0] / 60;\n    \tvar totalMinsOfEntry=hourInMinOfEntry+parseInt(time1[1]) + secondInMinOfEntry;\n    \tvar totalMinsOfExit=hourInMinOfExit+parseInt(time2[1]) + secondInMinOfExit;\n    \tvar break_for_lunch=lunch+parseInt(time3[1]) + lunch_time;\n    \tvar dif = totalMinsOfExit-totalMinsOfEntry-break_for_lunch\n        var num = dif;\n        // console.log(num);\n        var hours = (num / 60);\n        var rhours = Math.floor(hours);\n        var minutes = (hours - rhours) * 60;\n        var rminutes = Math.round(minutes);\n        // console.log(rhours +\":\"+ rminutes +\":\"+'00');\n        row.total_working_hours = rhours +\":\"+ rminutes +\":\"+'00'\n        if(num > 480.1333333333333){\n            var ghours = rhours - 8\n            var gminutes = rminutes - 0 \n            var ot_hours = ghours +\":\"+ gminutes +':00'\n            row.ot = ot_hours \n        }\n        else{\n            row.ot = \"00:00:00\"\n        }\n        frm.refresh_field(\"project_day_plan_employee\")\n\t}\n\t\n})\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Applicant",
  "enabled": 1,
  "modified": "2022-10-28 13:01:56.564141",
  "name": "Job Applicant-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Job Applicant', {\n\tvalidate(frm){\n\t    var tot = 0\n\t    var total_ = 0\n\t\t$.each(frm.doc.table, function (i, d) {\n\t\t    tot += (parseInt(d.interviewer) + parseInt(d.interviewer_hod))/2\n// \t\t\ttotal += parseInt(d.interviewer)\n// \t\t\ttotal_ += parseInt(d.interviewer_hod)\n\t\t})\n\t\t\tfrm.set_value(\"total_score\",tot)\n\t},\n\tcompany(frm){\n\t    if (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t}\n})\n\nfrappe.ui.form.on('Child Table Iv', {\n\tinterviewer: function(frm,cdt,cdn){\n\t    var row = locals[cdt][cdn]\n\t    console.log(row.idx)\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Staff Probation Evaluation Form",
  "enabled": 1,
  "modified": "2022-11-14 07:43:52.856930",
  "name": "Staff Probation Evaluation Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Staff Probation Evaluation Form', {\n    validate:function(frm){\n        console.log('hi')\n        var total = 0 \n        $.each(frm.doc.child,function(i,d){\n            if(d.rating){\n            total += d.rating\n            }\n        })\n        console.log(total)\n        frm.set_value('total_score',total)\n    },\n    refresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Staff Probation Evaluation Form\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Staff Probation Evaluation Form\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Vacation Final Exit Form",
  "enabled": 1,
  "modified": "2022-11-14 09:10:00.180881",
  "name": "Vacation Final Exit Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Vacation Final Exit Form', {\n\tcompany(frm){\n\t    if (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Vacation and Final Exit\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Vacation Final Exit Form\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Accident Declaration Form",
  "enabled": 1,
  "modified": "2022-10-31 13:26:04.551479",
  "name": "Accident Declaration Form-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Accident Declaration Form', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Accident Declaration\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Accident Declaration Form\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Driving License Declaration",
  "enabled": 1,
  "modified": "2022-10-31 14:15:55.189602",
  "name": "Employee Driving License Declaration-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Employee Driving License Declaration', {\n\trefresh(frm) {\n\t    frm.add_custom_button(__(\"Print\"), function () {\n            if(frm.doc.parent_company){\n                var letter_head = frm.doc.parent_company\n            }\n            else{\n                var letter_head = frm.doc.company\n            } \n            var f_name = frm.doc.name\n            var print_format =\"Driving License Declaration\";\n             window.open(frappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n                + \"doctype=\" + encodeURIComponent(\"Employee Driving License Declaration\")\n                + \"&name=\" + encodeURIComponent(f_name)\n                + \"&trigger_print=1\"\n                + \"&format=\" + print_format\n                + \"&no_letterhead=0\"\n                + \"&letterhead=\" + encodeURIComponent(letter_head) \n               ));\n        });\n\t},\n\tcompany(frm) {\n\t\tif (frm.doc.company == \"MARAZEEM SECURITY SERVICES\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - SHOWROOM\" || frm.doc.company == \"MARAZEEM SECURITY SERVICES - HO\") {\n\t\t\tfrm.set_value('letter_head', \"MARAZEEM SECURITY SERVICES\")\n\t\t}\n\t\tif (frm.doc.company == \"KINGFISHER TRADING AND CONTRACTING COMPANY\" || frm.doc.company == \"KINGFISHER - TRANSPORTATION\" || frm.doc.company == \"KINGFISHER - SHOWROOM\") {\n\t\t\tfrm.set_value('letter_head', \"KINGFISHER TRADING AND CONTRACTING COMPANY\")\n\t\t}\n\t\tif (frm.doc.company == \"Al - Shaghairi Trading and Contracting Company W.L.L (ELECTRA)\" || frm.doc.company == \"ELECTRA - BARWA SHOWROOM\" || frm.doc.company == \"ELECTRA - BINOMRAN SHOWROOM\" || frm.doc.company == \"ELECTRA  - NAJMA SHOWROOM\" || frm.doc.company == \"ELECTRICAL DIVISION - ELECTRA\" || frm.doc.company == \"MEP DIVISION - ELECTRA\" || frm.doc.company == \"STEEL DIVISION - ELECTRA\" || frm.doc.company == \"TRADING DIVISION - ELECTRA\" || frm.doc.company == \"INTERIOR DIVISION - ELECTRA\" || frm.doc.company == \"ENGINEERING DIVISION - ELECTRA\") {\n\t\t\tfrm.set_value('letter_head', \"Electra\")\n\t\t}\n\t},\n\tonload(frm){\n\t    if(frm.doc.__islocal){\n\t        frm.set_value('date',new Date)\n\t    }\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Vehicle",
  "enabled": 1,
  "modified": "2022-11-01 12:42:12.590719",
  "name": "Vehicle-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Vehicle', {\n\tonload(frm) {\n\t    frappe.call({\n    \t\tmethod: 'electra.custom.record',\n    \t\targs: {\n    \t\t\tname:frm.doc.name,\n    \t\t},\n    \t\tcallback: function(r) {\n\t\t        if (r.message[0]) {\n    \t\t\t    var main = r.message[0]\n    \t\t\t    var acc = r.message[1]\n    \t\t\t\tfrm.clear_table('record')\n\t\t\t\t    frm.add_child('record', {\n\t\t\t\t\t\t'employee':main.employee_id,\n\t\t\t\t\t\t'date': main.vehicle_handover_date,\n\t\t\t\t\t\t'type': \"Maintenance\",\n\t\t\t\t\t\t'remarks': main.complaint\n    \t\t\t\t})\n    \t\t\t\tif(r.message[1]){\n    \t\t\t\t    frm.add_child('record', {\n\t\t\t\t\t\t'employee':acc.emp_id,\n\t\t\t\t\t\t'date': acc.date_of_accident,\n\t\t\t\t\t\t'type': \"Accident\",\n\t\t\t\t\t\t'remarks': acc.remarks\n    \t\t\t\t})\n    \t\t\t\t}\n    \t\t\t\t\n    \t\t\t\tfrm.refresh_field('record')\n\n    \t\t\t}\n      \t\t}\n    \t});\n\t}\n})",
  "view": "Form"
 }
]